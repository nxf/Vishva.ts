var org;!function(t){!function(t){!function(t){!function(t){var i,s=BABYLON.Axis,e=BABYLON.Color3,n=BABYLON.Mesh,h=BABYLON.MeshBuilder,a=BABYLON.Path2,r=BABYLON.Quaternion,o=BABYLON.Space,l=BABYLON.StandardMaterial,c=BABYLON.Vector3;!function(t){t[t.TRANS=0]="TRANS",t[t.ROT=1]="ROT",t[t.SCALE=2]="SCALE"}(i||(i={}));var p=function(){function t(t,i,s,e,h){var a=this;this.local=!0,this.snapT=!1,this.snapR=!1,this.transSnap=1,this.rotSnap=Math.PI/18,this.axesLen=.4,this.axesScale=1,this.visibility=.7,this.distFromCamera=2,this.toParent=new c(0,0,0),this.cameraNormal=new c(0,0,0),this.actionListener=null,this.actionStartListener=null,this.actionEndListener=null,this.pDown=!1,this.pointerIsOver=!1,this.editing=!1,this.snapRX=0,this.snapRY=0,this.snapRZ=0,this.snapTV=new c(0,0,0),this.transBy=new c(0,0,0),this.snapS=!1,this.snapSX=0,this.snapSY=0,this.snapSZ=0,this.snapSA=0,this.snapSV=new c(0,0,0),this.scaleSnap=.25,this.scale=new c(0,0,0),this.eulerian=!1,this.snapRA=0,this.cN=new c(0,0,0),this.transEnabled=!1,this.rotEnabled=!1,this.scaleEnabled=!1,this.guideSize=90,this.localX=new c(0,0,0),this.localY=new c(0,0,0),this.localZ=new c(0,0,0),this.mesh=t,this.canvas=s,this.axesScale=e,this.eulerian=null!==h&&h,this.checkQuaternion(),this.scene=t.getScene(),this.mainCamera=i,this.actHist=new d(t,10),t.computeWorldMatrix(!0),this.boundingDimesion=this.getBoundingDimension(t),this.theParent=new n("EditControl",this.scene),this.theParent.rotationQuaternion=r.Identity(),this.theParent.visibility=0,this.theParent.isPickable=!1,this.createMaterials(this.scene),this.createGuideAxes(),this.guideCtl.parent=this.theParent,this.createPickPlanes(),this.pickPlanes.parent=this.theParent,this.pointerdown=function(t){return a.onPointerDown(t)},this.pointerup=function(t){return a.onPointerUp(t)},this.pointermove=function(t){return a.onPointerMove(t)},s.addEventListener("pointerdown",this.pointerdown,!1),s.addEventListener("pointerup",this.pointerup,!1),s.addEventListener("pointermove",this.pointermove,!1),this.setLocalAxes(t),this.renderer=function(){return a.renderLoopProcess()},this.scene.registerBeforeRender(this.renderer)}return t.prototype.checkQuaternion=function(){if(!this.eulerian&&(null==this.mesh.rotationQuaternion||void 0==this.mesh.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},t.prototype.setAxesScale=function(){this.theParent.position.subtractToRef(this.mainCamera.position,this.toParent),c.FromFloatArrayToRef(this.mainCamera.getWorldMatrix().asArray(),8,this.cameraNormal);var t=c.Dot(this.toParent,this.cameraNormal)/this.cameraNormal.length(),i=Math.abs(t/this.distFromCamera);c.FromFloatsToRef(i,i,i,this.theParent.scaling),c.FromFloatsToRef(i,i,i,this.pALL.scaling)},t.prototype.setAxesRotation=function(){if(this.local)if(this.eulerian){var t=this.mesh.rotation;this.theParent.rotationQuaternion.copyFrom(BABYLON.Quaternion.RotationYawPitchRoll(t.y,t.x,t.z))}else this.theParent.rotationQuaternion=this.mesh.rotationQuaternion},t.prototype.renderLoopProcess=function(){this.theParent.position=this.mesh.getAbsolutePivotPoint(),this.setAxesScale(),this.setAxesRotation(),this.onPointerOver()},t.prototype.switchTo=function(t,i){t.computeWorldMatrix(!0),this.mesh=t,null!=i&&(this.eulerian=i),this.checkQuaternion(),this.setLocalAxes(t),this.actHist=new d(t,10)},t.prototype.setUndoCount=function(t){this.actHist.setCapacity(t)},t.prototype.undo=function(){var t=this.actHist.undo();this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh),this.callActionStartListener(t),this.callActionListener(t),this.callActionEndListener(t)},t.prototype.redo=function(){var t=this.actHist.redo();this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh),this.callActionStartListener(t),this.callActionListener(t),this.callActionEndListener(t)},t.prototype.detach=function(){this.canvas.removeEventListener("pointerdown",this.pointerdown,!1),this.canvas.removeEventListener("pointerup",this.pointerup,!1),this.canvas.removeEventListener("pointermove",this.pointermove,!1),this.scene.unregisterBeforeRender(this.renderer),this.removeAllActionListeners(),this.disposeAll()},t.prototype.disposeAll=function(){this.theParent.dispose(),this.disposeMaterials(),this.actHist=null},t.prototype.addActionListener=function(t){this.actionListener=t},t.prototype.removeActionListener=function(){this.actionListener=null},t.prototype.addActionStartListener=function(t){this.actionStartListener=t},t.prototype.removeActionStartListener=function(){this.actionStartListener=null},t.prototype.addActionEndListener=function(t){this.actionEndListener=t},t.prototype.removeActionEndListener=function(){this.actionEndListener=null},t.prototype.removeAllActionListeners=function(){this.actionListener=null,this.actionStartListener=null,this.actionEndListener=null},t.prototype.onPointerDown=function(t){var i=this;if(t.preventDefault(),this.pDown=!0,0==t.button){var s=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){if(i.transEnabled){if(t==i.tX||t==i.tY||t==i.tZ||t==i.tXZ||t==i.tZY||t==i.tYX||t==i.tAll)return!0}else if(i.rotEnabled){if(t==i.rX||t==i.rY||t==i.rZ||t==i.rAll)return!0}else if(i.scaleEnabled&&(t==i.sX||t==i.sY||t==i.sZ||t==i.sXZ||t==i.sZY||t==i.sYX||t==i.sAll))return!0;return!1},null,this.mainCamera);if(s.hit){this.setAxesVisiblity(0),this.axisPicked=s.pickedMesh;var e=this.axisPicked.getChildren();e.length>0?e[0].visibility=this.visibility:this.axisPicked.visibility=this.visibility;var n=this.axisPicked.name;"X"==n?this.bXaxis.visibility=1:"Y"==n?this.bYaxis.visibility=1:"Z"==n?this.bZaxis.visibility=1:"XZ"==n?(this.bXaxis.visibility=1,this.bZaxis.visibility=1):"ZY"==n?(this.bZaxis.visibility=1,this.bYaxis.visibility=1):"YX"==n?(this.bYaxis.visibility=1,this.bXaxis.visibility=1):"ALL"==n&&(this.bXaxis.visibility=1,this.bYaxis.visibility=1,this.bZaxis.visibility=1),this.setEditing(!0),this.pickPlane=this.getPickPlane(this.axisPicked),this.prevPos=this.getPosOnPickPlane(),window.setTimeout(function(t,s){return i.detachControl(t,s)},0,this.mainCamera,this.canvas)}}},t.prototype.setEditing=function(t){this.editing=t,t?(this.setActionType(),this.callActionStartListener(this.actionType)):this.callActionEndListener(this.actionType)},t.prototype.isEditing=function(){return this.editing},t.prototype.detachControl=function(t,i){var s=t,e=i;s.detachControl(e)},t.prototype.isPointerOver=function(){return this.pointerIsOver},t.prototype.onPointerOver=function(){var t=this;if(!this.pDown){var i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){if(t.transEnabled){if(i==t.tX||i==t.tY||i==t.tZ||i==t.tXZ||i==t.tZY||i==t.tYX||i==t.tAll)return!0}else if(t.rotEnabled){if(i==t.rX||i==t.rY||i==t.rZ||i==t.rAll)return!0}else if(t.scaleEnabled&&(i==t.sX||i==t.sY||i==t.sZ||i==t.sXZ||i==t.sZY||i==t.sYX||i==t.sAll))return!0;return!1},null,this.mainCamera);if(i.hit){if(i.pickedMesh!=this.prevOverMesh){if(this.pointerIsOver=!0,this.clearPrevOverMesh(),this.prevOverMesh=i.pickedMesh,this.rotEnabled)this.savedCol=this.prevOverMesh.getChildren()[0].color,this.prevOverMesh.getChildren()[0].color=e.White();else{var s=this.prevOverMesh.getChildren();s.length>0?(this.savedMat=s[0].material,s[0].material=this.whiteMat):(this.savedMat=this.prevOverMesh.material,this.prevOverMesh.material=this.whiteMat)}"X"==this.prevOverMesh.name?this.xaxis.color=e.White():"Y"==this.prevOverMesh.name?this.yaxis.color=e.White():"Z"==this.prevOverMesh.name&&(this.zaxis.color=e.White())}}else this.pointerIsOver=!1,null!=this.prevOverMesh&&(this.restoreColor(this.prevOverMesh),this.prevOverMesh=null)}},t.prototype.clearPrevOverMesh=function(){null!=this.prevOverMesh&&(this.prevOverMesh.visibility=0,this.restoreColor(this.prevOverMesh))},t.prototype.restoreColor=function(t){switch(t.name){case"X":this.xaxis.color=e.Red();break;case"Y":this.yaxis.color=e.Green();break;case"Z":this.zaxis.color=e.Blue()}if(this.rotEnabled)t.getChildren()[0].color=this.savedCol;else{var i=t.getChildren();i.length>0?i[0].material=this.savedMat:t.material=this.savedMat}},t.prototype.onPointerUp=function(t){this.pDown=!1,this.editing&&(this.mainCamera.attachControl(this.canvas),this.setEditing(!1),this.setAxesVisiblity(1),this.hideBaxis(),this.restoreColor(this.prevOverMesh),this.prevOverMesh=null,this.actHist.add(this.actionType))},t.prototype.setActionType=function(){this.transEnabled?this.actionType=i.TRANS:this.rotEnabled?this.actionType=i.ROT:this.scaleEnabled&&(this.actionType=i.SCALE)},t.prototype.callActionListener=function(t){null!=this.actionListener&&window.setTimeout(this.actionListener,0,t)},t.prototype.callActionStartListener=function(t){null!=this.actionStartListener&&window.setTimeout(this.actionStartListener,0,t)},t.prototype.callActionEndListener=function(t){null!=this.actionEndListener&&window.setTimeout(this.actionEndListener,0,t)},t.prototype.onPointerMove=function(t){if(this.pDown&&this.editing&&null!=this.prevPos){this.pickPlane=this.getPickPlane(this.axisPicked);var i=this.getPosOnPickPlane();if(null!=i){if(this.rotEnabled)this.doRotation(this.mesh,this.axisPicked,i,this.prevPos);else{var s=i.subtract(this.prevPos);if(0==s.x&&0==s.y&&0==s.z)return;this.transEnabled?this.doTranslation(s):this.scaleEnabled&&this.local&&this.doScaling(s)}this.prevPos=i,this.callActionListener(this.actionType)}}},t.prototype.getPickPlane=function(t){var i=t.name;if(this.transEnabled||this.scaleEnabled){if("XZ"==i)return this.pXZ;if("ZY"==i)return this.pZY;if("YX"==i)return this.pYX;if("ALL"==i)return this.pALL;var s=this.mesh.getWorldMatrix().clone().invert(),e=c.TransformCoordinates(this.mainCamera.position,s),n=this.mesh.scaling;if("X"===i)return Math.abs(e.y*n.y)>Math.abs(e.z*n.z)?this.pXZ:this.pYX;if("Z"===i)return Math.abs(e.y*n.y)>Math.abs(e.x*n.x)?this.pXZ:this.pZY;if("Y"===i)return Math.abs(e.z*n.z)>Math.abs(e.x*n.x)?this.pYX:this.pZY}else{if(!this.rotEnabled)return null;switch(i){case"X":return this.pZY;case"Y":return this.pXZ;case"Z":return this.pYX;default:return this.pALL}}},t.prototype.doTranslation=function(t){this.transBy.x=0,this.transBy.y=0,this.transBy.z=0;var i=this.axisPicked.name;"X"!=i&&"XZ"!=i&&"YX"!=i&&"ALL"!=i||(this.local?this.transBy.x=c.Dot(t,this.localX)/(this.localX.length()*this.mesh.scaling.x):this.transBy.x=t.x),"Y"!=i&&"ZY"!=i&&"YX"!=i&&"ALL"!=i||(this.local?this.transBy.y=c.Dot(t,this.localY)/(this.localY.length()*this.mesh.scaling.y):this.transBy.y=t.y),"Z"!=i&&"XZ"!=i&&"ZY"!=i&&"ALL"!=i||(this.local?this.transBy.z=c.Dot(t,this.localZ)/(this.localZ.length()*this.mesh.scaling.z):this.transBy.z=t.z),this.transWithSnap(this.mesh,this.transBy,this.local),this.transBoundsMin&&(this.mesh.position.x=Math.max(this.mesh.position.x,this.transBoundsMin.x),this.mesh.position.y=Math.max(this.mesh.position.y,this.transBoundsMin.y),this.mesh.position.z=Math.max(this.mesh.position.z,this.transBoundsMin.z)),this.transBoundsMax&&(this.mesh.position.x=Math.min(this.mesh.position.x,this.transBoundsMax.x),this.mesh.position.y=Math.min(this.mesh.position.y,this.transBoundsMax.y),this.mesh.position.z=Math.min(this.mesh.position.z,this.transBoundsMax.z)),this.mesh.computeWorldMatrix(!0)},t.prototype.transWithSnap=function(t,i,e){if(this.snapT){var n=!1;if(this.snapTV.addInPlace(i),Math.abs(this.snapTV.x)>this.tSnap.x/t.scaling.x&&(this.snapTV.x>0?i.x=this.tSnap.x:i.x=-this.tSnap.x,i.x=i.x/t.scaling.x,n=!0),Math.abs(this.snapTV.y)>this.tSnap.y/t.scaling.y&&(this.snapTV.y>0?i.y=this.tSnap.y:i.y=-this.tSnap.y,i.y=i.y/t.scaling.y,n=!0),Math.abs(this.snapTV.z)>this.tSnap.z/t.scaling.z&&(this.snapTV.z>0?i.z=this.tSnap.z:i.z=-this.tSnap.z,i.z=i.z/t.scaling.z,n=!0),!n)return;Math.abs(i.x)!==this.tSnap.x/t.scaling.x&&(i.x=0),Math.abs(i.y)!==this.tSnap.y/t.scaling.y&&(i.y=0),Math.abs(i.z)!==this.tSnap.z/t.scaling.z&&(i.z=0),c.FromFloatsToRef(0,0,0,this.snapTV),n=!1}e?(this.mesh.translate(s.X,i.x,o.LOCAL),this.mesh.translate(s.Y,i.y,o.LOCAL),this.mesh.translate(s.Z,i.z,o.LOCAL)):this.mesh.position.addInPlace(i)},t.prototype.doScaling=function(t){this.scale.x=0,this.scale.y=0,this.scale.z=0;var i=this.axisPicked.name;"X"!=i&&"XZ"!=i&&"YX"!=i||(this.scale.x=c.Dot(t,this.localX)/this.localX.length()),"Y"!=i&&"ZY"!=i&&"YX"!=i||(this.scale.y=c.Dot(t,this.localY)/this.localY.length()),"Z"!=i&&"XZ"!=i&&"ZY"!=i||(this.scale.z=c.Dot(t,this.localZ)/this.localZ.length());var s=this.boundingDimesion;if(this.scale.x=this.scale.x/s.x,this.scale.y=this.scale.y/s.y,this.scale.z=this.scale.z/s.z,"ALL"==i){var e=c.Dot(t,this.mainCamera.upVector);e/=Math.max(s.x,s.y,s.z),this.scale.copyFromFloats(e,e,e)}else"XZ"==i?Math.abs(this.scale.x)>Math.abs(this.scale.z)?this.scale.z=this.scale.x:this.scale.x=this.scale.z:"ZY"==i?Math.abs(this.scale.z)>Math.abs(this.scale.y)?this.scale.y=this.scale.z:this.scale.z=this.scale.y:"YX"==i&&(Math.abs(this.scale.y)>Math.abs(this.scale.x)?this.scale.x=this.scale.y:this.scale.y=this.scale.x);this.scaleWithSnap(this.mesh,this.scale),this.scaleBoundsMin&&(this.mesh.scaling.x=Math.max(this.mesh.scaling.x,this.scaleBoundsMin.x),this.mesh.scaling.y=Math.max(this.mesh.scaling.y,this.scaleBoundsMin.y),this.mesh.scaling.z=Math.max(this.mesh.scaling.z,this.scaleBoundsMin.z)),this.scaleBoundsMax&&(this.mesh.scaling.x=Math.min(this.mesh.scaling.x,this.scaleBoundsMax.x),this.mesh.scaling.y=Math.min(this.mesh.scaling.y,this.scaleBoundsMax.y),this.mesh.scaling.z=Math.min(this.mesh.scaling.z,this.scaleBoundsMax.z))},t.prototype.scaleWithSnap=function(t,i){if(this.snapS){var s=!1;if(this.snapSV.addInPlace(i),Math.abs(this.snapSV.x)>this.scaleSnap&&(i.x>0?i.x=this.scaleSnap:i.x=-this.scaleSnap,s=!0),Math.abs(this.snapSV.y)>this.scaleSnap&&(i.y>0?i.y=this.scaleSnap:i.y=-this.scaleSnap,s=!0),Math.abs(this.snapSV.z)>this.scaleSnap&&(i.z>0?i.z=this.scaleSnap:i.z=-this.scaleSnap,s=!0),!s)return;Math.abs(i.x)!==this.scaleSnap&&0!==i.x&&(i.x=0),Math.abs(i.y)!==this.scaleSnap&&0!==i.y&&(i.y=0),Math.abs(i.z)!==this.scaleSnap&&0!==i.z&&(i.z=0),c.FromFloatsToRef(0,0,0,this.snapSV),s=!1}t.scaling.addInPlace(i)},t.prototype.getBoundingDimension=function(t){var i=this.mesh.getBoundingInfo().boundingBox,s=i.maximum.subtract(i.minimum);return 0==s.x&&(s.x=1),0==s.y&&(s.y=1),0==s.z&&(s.z=1),s},t.prototype.refreshBoundingInfo=function(){this.boundingDimesion=this.getBoundingDimension(this.mesh)},t.prototype.doRotation=function(i,e,n,h){var a=this.cN;c.TransformNormalToRef(s.Z,this.mainCamera.getWorldMatrix(),a);var r=t.getAngle(h,n,i.getAbsolutePivotPoint(),a);e==this.rX?(this.snapR&&(this.snapRX+=r,r=0,Math.abs(this.snapRX)>=this.rotSnap&&(r=this.snapRX>0?this.rotSnap:-this.rotSnap,this.snapRX=0)),0!==r&&(this.local?(c.Dot(this.localX,a)<0&&(r*=-1),i.rotate(s.X,r,o.LOCAL)):i.rotate(new c(a.x,0,0),r,o.WORLD))):e==this.rY?(this.snapR&&(this.snapRY+=r,r=0,Math.abs(this.snapRY)>=this.rotSnap&&(r=this.snapRY>0?this.rotSnap:-this.rotSnap,this.snapRY=0)),0!==r&&(this.local?(c.Dot(this.localY,a)<0&&(r*=-1),i.rotate(s.Y,r,o.LOCAL)):i.rotate(new c(0,a.y,0),r,o.WORLD))):e==this.rZ?(this.snapR&&(this.snapRZ+=r,r=0,Math.abs(this.snapRZ)>=this.rotSnap&&(r=this.snapRZ>0?this.rotSnap:-this.rotSnap,this.snapRZ=0)),0!==r&&(this.local?(c.Dot(this.localZ,a)<0&&(r*=-1),i.rotate(s.Z,r,o.LOCAL)):i.rotate(new c(0,0,a.z),r,o.WORLD))):e==this.rAll&&(this.snapR&&(this.snapRA+=r,r=0,Math.abs(this.snapRA)>=this.rotSnap&&(r=this.snapRA>0?this.rotSnap:-this.rotSnap,this.snapRA=0)),0!==r&&(this.scene.useRightHandedSystem&&(r=-r),i.rotate(i.position.subtract(this.mainCamera.position),r,o.WORLD))),this.setLocalAxes(this.mesh),this.eulerian&&0!=r&&(i.rotation=i.rotationQuaternion.toEulerAngles(),i.rotationQuaternion=null)},t.prototype.getPosOnPickPlane=function(){var t=this,i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){return i==t.pickPlane},null,this.mainCamera);return i.hit?i.pickedPoint:null},t.prototype.hideBaxis=function(){this.bXaxis.visibility=0,this.bYaxis.visibility=0,this.bZaxis.visibility=0},t.prototype.setAxesVisiblity=function(t){this.transEnabled&&(this.tEndX.visibility=t,this.tEndY.visibility=t,this.tEndZ.visibility=t,this.tEndXZ.visibility=t,this.tEndZY.visibility=t,this.tEndYX.visibility=t,this.tEndAll.visibility=t),this.rotEnabled&&(this.rEndX.visibility=t,this.rEndY.visibility=t,this.rEndZ.visibility=t,this.rEndAll.visibility=t),this.scaleEnabled&&(this.sEndX.visibility=t,this.sEndY.visibility=t,this.sEndZ.visibility=t,this.sEndXZ.visibility=t,this.sEndZY.visibility=t,this.sEndYX.visibility=t,this.sEndAll.visibility=t)},t.prototype.isTranslationEnabled=function(){return this.transEnabled},t.prototype.enableTranslation=function(){null==this.tX&&(this.createTransAxes(),this.tCtl.parent=this.theParent),this.clearPrevOverMesh(),this.transEnabled||(this.tEndX.visibility=this.visibility,this.tEndY.visibility=this.visibility,this.tEndZ.visibility=this.visibility,this.tEndXZ.visibility=this.visibility,this.tEndZY.visibility=this.visibility,this.tEndYX.visibility=this.visibility,this.tEndAll.visibility=this.visibility,this.transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this.transEnabled&&(this.tEndX.visibility=0,this.tEndY.visibility=0,this.tEndZ.visibility=0,this.tEndXZ.visibility=0,this.tEndZY.visibility=0,this.tEndYX.visibility=0,this.tEndAll.visibility=0,this.transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this.rotEnabled},t.prototype.returnEuler=function(t){this.eulerian=t},t.prototype.enableRotation=function(){null==this.rCtl&&(this.createRotAxes(),this.rCtl.parent=this.theParent),this.clearPrevOverMesh(),this.rotEnabled||(this.rEndX.visibility=this.visibility,this.rEndY.visibility=this.visibility,this.rEndZ.visibility=this.visibility,this.rEndAll.visibility=this.visibility,this.rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this.rotEnabled&&(this.rEndX.visibility=0,this.rEndY.visibility=0,this.rEndZ.visibility=0,this.rEndAll.visibility=0,this.rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this.scaleEnabled},t.prototype.enableScaling=function(){null==this.sX&&(this.createScaleAxes(),this.sCtl.parent=this.theParent),this.clearPrevOverMesh(),this.scaleEnabled||(this.sEndX.visibility=this.visibility,this.sEndY.visibility=this.visibility,this.sEndZ.visibility=this.visibility,this.sEndXZ.visibility=this.visibility,this.sEndZY.visibility=this.visibility,this.sEndYX.visibility=this.visibility,this.sEndAll.visibility=this.visibility,this.scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this.scaleEnabled&&(this.sEndX.visibility=0,this.sEndY.visibility=0,this.sEndZ.visibility=0,this.sEndXZ.visibility=0,this.sEndZY.visibility=0,this.sEndYX.visibility=0,this.sEndAll.visibility=0,this.scaleEnabled=!1)},t.prototype.setScaleBounds=function(t,i){this.scaleBoundsMin=t||null,this.scaleBoundsMax=i||null,null!=this.scaleBoundsMin&&(0==this.scaleBoundsMin.x&&(this.scaleBoundsMin.x=1e-8),0==this.scaleBoundsMin.y&&(this.scaleBoundsMin.y=1e-8),0==this.scaleBoundsMin.z&&(this.scaleBoundsMin.z=1e-8))},t.prototype.removeScaleBounds=function(){this.scaleBoundsMin=null,this.scaleBoundsMax=null},t.prototype.setTransBounds=function(t,i){this.transBoundsMin=t||null,this.transBoundsMax=i||null},t.prototype.removeTransBounds=function(){this.transBoundsMin=null,this.transBoundsMax=null},t.prototype.setRotBounds=function(t,i){this.rotBoundsMin=t||null,this.rotBoundsMax=i||null},t.prototype.removeRotBounds=function(){this.rotBoundsMin=null,this.rotBoundsMax=null},t.prototype.createGuideAxes=function(){this.guideCtl=new n("guideCtl",this.scene),this.bXaxis=n.CreateLines("bxAxis",[new c(-100,0,0),new c(100,0,0)],this.scene),this.bYaxis=n.CreateLines("byAxis",[new c(0,-100,0),new c(0,100,0)],this.scene),this.bZaxis=n.CreateLines("bzAxis",[new c(0,0,-100),new c(0,0,100)],this.scene),this.bXaxis.isPickable=!1,this.bYaxis.isPickable=!1,this.bZaxis.isPickable=!1,this.bXaxis.parent=this.guideCtl,this.bYaxis.parent=this.guideCtl,this.bZaxis.parent=this.guideCtl,this.bXaxis.color=e.Red(),this.bYaxis.color=e.Green(),this.bZaxis.color=e.Blue(),this.hideBaxis();var t=this.axesLen*this.axesScale;this.xaxis=n.CreateLines("xAxis",[new c(0,0,0),new c(t,0,0)],this.scene),this.yaxis=n.CreateLines("yAxis",[new c(0,0,0),new c(0,t,0)],this.scene),this.zaxis=n.CreateLines("zAxis",[new c(0,0,0),new c(0,0,t)],this.scene),this.xaxis.isPickable=!1,this.yaxis.isPickable=!1,this.zaxis.isPickable=!1,this.xaxis.parent=this.guideCtl,this.yaxis.parent=this.guideCtl,this.zaxis.parent=this.guideCtl,this.xaxis.color=e.Red(),this.yaxis.color=e.Green(),this.zaxis.color=e.Blue(),this.xaxis.renderingGroupId=1,this.yaxis.renderingGroupId=1,this.zaxis.renderingGroupId=1},t.prototype.createPickPlanes=function(){this.pALL=n.CreatePlane("pALL",5,this.scene),this.pXZ=n.CreatePlane("pXZ",5,this.scene),this.pZY=n.CreatePlane("pZY",5,this.scene),this.pYX=n.CreatePlane("pYX",5,this.scene),this.pALL.isPickable=!1,this.pXZ.isPickable=!1,this.pZY.isPickable=!1,this.pYX.isPickable=!1,this.pALL.visibility=0,this.pXZ.visibility=0,this.pZY.visibility=0,this.pYX.visibility=0,this.pALL.renderingGroupId=1,this.pXZ.renderingGroupId=1,this.pZY.renderingGroupId=1,this.pYX.renderingGroupId=1,this.pALL.billboardMode=n.BILLBOARDMODE_ALL,this.pXZ.rotate(s.X,1.57),this.pZY.rotate(s.Y,1.57),this.pickPlanes=new n("pickPlanes",this.scene),this.pALL.parent=this.theParent,this.pXZ.parent=this.pickPlanes,this.pZY.parent=this.pickPlanes,this.pYX.parent=this.pickPlanes},t.prototype.createTransAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.tCtl=new n("tarnsCtl",this.scene),this.tX=this.extrudeBox(t/2,i),this.tX.name="X",this.tY=this.tX.clone("Y"),this.tZ=this.tX.clone("Z"),this.tXZ=h.CreatePlane("XZ",{size:2*t},this.scene),this.tZY=this.tXZ.clone("ZY"),this.tYX=this.tXZ.clone("YX"),this.tXZ.rotation.x=1.57,this.tZY.rotation.y=-1.57,this.tXZ.position.x=t,this.tXZ.position.z=t,this.tZY.position.z=t,this.tZY.position.y=t,this.tYX.position.y=t,this.tYX.position.x=t,this.tAll=n.CreateBox("ALL",2*t,this.scene),this.tX.parent=this.tCtl,this.tY.parent=this.tCtl,this.tZ.parent=this.tCtl,this.tXZ.parent=this.tCtl,this.tZY.parent=this.tCtl,this.tYX.parent=this.tCtl,this.tAll.parent=this.tCtl,this.tX.rotation.y=1.57,this.tY.rotation.x-=1.57,this.tX.visibility=0,this.tY.visibility=0,this.tZ.visibility=0,this.tXZ.visibility=0,this.tZY.visibility=0,this.tYX.visibility=0,this.tAll.visibility=0,this.tX.isPickable=!1,this.tY.isPickable=!1,this.tZ.isPickable=!1,this.tXZ.isPickable=!1,this.tZY.isPickable=!1,this.tYX.isPickable=!1,this.tAll.isPickable=!1;var s=i/5,e=t;this.tEndX=n.CreateCylinder("tEndX",s,0,e,6,1,this.scene),this.tEndY=this.tEndX.clone("tEndY"),this.tEndZ=this.tEndX.clone("tEndZ"),this.tEndXZ=this.createTriangle("XZ",1.75*e,this.scene),this.tEndZY=this.tEndXZ.clone("ZY"),this.tEndYX=this.tEndXZ.clone("YX"),this.tEndAll=h.CreatePolyhedron("tEndAll",{type:1,size:e/2},this.scene),this.tEndX.rotation.x=1.57,this.tEndY.rotation.x=1.57,this.tEndZ.rotation.x=1.57,this.tEndXZ.rotation.x=-1.57,this.tEndZY.rotation.x=-1.57,this.tEndYX.rotation.x=-1.57,this.tEndX.parent=this.tX,this.tEndY.parent=this.tY,this.tEndZ.parent=this.tZ,this.tEndXZ.parent=this.tXZ,this.tEndZY.parent=this.tZY,this.tEndYX.parent=this.tYX,this.tEndAll.parent=this.tAll,this.tEndX.position.z=i-s/2,this.tEndY.position.z=i-s/2,this.tEndZ.position.z=i-s/2,this.tEndX.material=this.redMat,this.tEndY.material=this.greenMat,this.tEndZ.material=this.blueMat,this.tEndXZ.material=this.redMat,this.tEndZY.material=this.blueMat,this.tEndYX.material=this.greenMat,this.tEndAll.material=this.yellowMat,this.tEndX.renderingGroupId=2,this.tEndY.renderingGroupId=2,this.tEndZ.renderingGroupId=2,this.tEndXZ.renderingGroupId=2,this.tEndZY.renderingGroupId=2,this.tEndYX.renderingGroupId=2,this.tEndAll.renderingGroupId=2,this.tEndX.isPickable=!1,this.tEndY.isPickable=!1,this.tEndZ.isPickable=!1,this.tEndXZ.isPickable=!1,this.tEndZY.isPickable=!1,this.tEndYX.isPickable=!1,this.tEndAll.isPickable=!1},t.prototype.createTriangle=function(t,i,s){var e=new a(i/2,-i/2).addLineTo(i/2,i/2).addLineTo(-i/2,i/2).addLineTo(i/2,-i/2);return new BABYLON.PolygonMeshBuilder(t,e,s).build()},t.prototype.setRotGuideFull=function(t){this.guideSize=t?360:90,null!=this.rCtl&&(this.rCtl.dispose(),this.rCtl=null,this.enableRotation())},t.prototype.createRotAxes=function(){var t=this.axesLen*this.axesScale*2;this.rCtl=new n("rotCtl",this.scene),this.rX=this.createTube(t/2,this.guideSize),this.rX.name="X",this.rY=this.rX.clone("Y"),this.rZ=this.rX.clone("Z"),this.rAll=this.createTube(t/1.75,360),this.rAll.name="ALL",this.rX.parent=this.rCtl,this.rY.parent=this.rCtl,this.rZ.parent=this.rCtl,this.rAll.parent=this.pALL,this.rX.rotation.z=1.57,this.rZ.rotation.x=-1.57,this.rAll.rotation.x=1.57,this.rX.visibility=0,this.rY.visibility=0,this.rZ.visibility=0,this.rAll.visibility=0,this.rX.isPickable=!1,this.rY.isPickable=!1,this.rZ.isPickable=!1,this.rAll.isPickable=!1;var i=t;this.rEndX=this.createCircle(i/2,this.guideSize,!1),this.rEndY=this.rEndX.clone(""),this.rEndZ=this.rEndX.clone(""),this.rEndAll=this.createCircle(i/1.75,360,!1),this.rEndX.parent=this.rX,this.rEndY.parent=this.rY,this.rEndZ.parent=this.rZ,this.rEndAll.parent=this.rAll,this.rEndX.color=e.Red(),this.rEndY.color=e.Green(),this.rEndZ.color=e.Blue(),this.rEndAll.color=e.Yellow(),this.rEndX.renderingGroupId=2,this.rEndY.renderingGroupId=2,this.rEndZ.renderingGroupId=2,this.rEndAll.renderingGroupId=2,this.rEndX.isPickable=!1,this.rEndY.isPickable=!1,this.rEndZ.isPickable=!1,this.rEndAll.isPickable=!1},t.prototype.extrudeBox=function(t,i){var s=[new c(t,t,0),new c(-t,t,0),new c(-t,-t,0),new c(t,-t,0),new c(t,t,0)],e=[new c(0,0,0),new c(0,0,i)];return n.ExtrudeShape("",s,e,1,0,2,this.scene)},t.prototype.createCircle=function(t,i,s){null===i&&(i=360);for(var e,h,a=[],r=3.14/180,o=0,l=0;l<=i;l+=10)e=t*Math.cos(l*r),h=90==l?t:270==l?-t:t*Math.sin(l*r),a[o]=new c(e,0,h),o++;if(s){t-=.04;for(var l=0;l<=i;l+=10)e=t*Math.cos(l*r),h=90==l?t:270==l?-t:t*Math.sin(l*r),a[o]=new c(e,0,h),o++}return n.CreateLines("",a,this.scene)},t.prototype.createTube=function(t,i){null===i&&(i=360);for(var s,e,h=[],a=3.14/180,r=0,o=0;o<=i;o+=30)s=t*Math.cos(o*a),e=90==o?t:270==o?-t:t*Math.sin(o*a),h[r]=new c(s,0,e),r++;return n.CreateTube("",h,.02,3,null,BABYLON.Mesh.NO_CAP,this.scene)},t.prototype.createScaleAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.sCtl=new n("sCtl",this.scene),this.sX=this.extrudeBox(t/2,i),this.sX.name="X",this.sY=this.sX.clone("Y"),this.sZ=this.sX.clone("Z"),this.sXZ=h.CreatePlane("XZ",{size:2*t},this.scene),this.sZY=this.sXZ.clone("ZY"),this.sYX=this.sXZ.clone("YX"),this.sXZ.rotation.x=1.57,this.sZY.rotation.y=-1.57,this.sXZ.position.x=t,this.sXZ.position.z=t,this.sZY.position.z=t,this.sZY.position.y=t,this.sYX.position.y=t,this.sYX.position.x=t,this.sAll=n.CreateBox("ALL",2*t,this.scene),this.sX.material=this.redMat,this.sY.material=this.greenMat,this.sZ.material=this.blueMat,this.sAll.material=this.yellowMat,this.sX.parent=this.sCtl,this.sY.parent=this.sCtl,this.sZ.parent=this.sCtl,this.sAll.parent=this.sCtl,this.sXZ.parent=this.sCtl,this.sZY.parent=this.sCtl,this.sYX.parent=this.sCtl,this.sX.rotation.y=1.57,this.sY.rotation.x-=1.57,this.sX.visibility=0,this.sY.visibility=0,this.sZ.visibility=0,this.sXZ.visibility=0,this.sZY.visibility=0,this.sYX.visibility=0,this.sAll.visibility=0,this.sX.isPickable=!1,this.sY.isPickable=!1,this.sZ.isPickable=!1,this.sXZ.isPickable=!1,this.sZY.isPickable=!1,this.sYX.isPickable=!1,this.sAll.isPickable=!1;var s=t;this.sEndX=n.CreateBox("",s,this.scene),this.sEndY=this.sEndX.clone(""),this.sEndZ=this.sEndX.clone(""),this.sEndAll=h.CreatePolyhedron("sEndAll",{type:1,size:s/2},this.scene),this.sEndXZ=this.createTriangle("XZ",1.75*s,this.scene),this.sEndZY=this.sEndXZ.clone("ZY"),this.sEndYX=this.sEndXZ.clone("YX"),this.sEndXZ.rotation.x=-1.57,this.sEndZY.rotation.x=-1.57,this.sEndYX.rotation.x=-1.57,this.sEndX.parent=this.sX,this.sEndY.parent=this.sY,this.sEndZ.parent=this.sZ,this.sEndXZ.parent=this.sXZ,this.sEndZY.parent=this.sZY,this.sEndYX.parent=this.sYX,this.sEndAll.parent=this.sAll,this.sEndX.position.z=i-s/2,this.sEndY.position.z=i-s/2,this.sEndZ.position.z=i-s/2,this.sEndX.material=this.redMat,this.sEndY.material=this.greenMat,this.sEndZ.material=this.blueMat,this.sEndXZ.material=this.redMat,this.sEndZY.material=this.blueMat,this.sEndYX.material=this.greenMat,this.sEndAll.material=this.yellowMat,this.sEndX.renderingGroupId=2,this.sEndY.renderingGroupId=2,this.sEndZ.renderingGroupId=2,this.sEndXZ.renderingGroupId=2,this.sEndZY.renderingGroupId=2,this.sEndYX.renderingGroupId=2,this.sEndAll.renderingGroupId=2,this.sEndX.isPickable=!1,this.sEndY.isPickable=!1,this.sEndZ.isPickable=!1,this.sEndXZ.isPickable=!1,this.sEndZY.isPickable=!1,this.sEndYX.isPickable=!1,this.sEndAll.isPickable=!1},t.prototype.setLocalAxes=function(t){var i=t.getWorldMatrix();c.FromFloatArrayToRef(i.asArray(),0,this.localX),c.FromFloatArrayToRef(i.asArray(),4,this.localY),c.FromFloatArrayToRef(i.asArray(),8,this.localZ)},t.prototype.setLocal=function(t){this.local!=t&&(this.local=t,t||(this.theParent.rotationQuaternion=r.Identity()))},t.prototype.isLocal=function(){return this.local},t.prototype.setTransSnap=function(t){this.snapT=t},t.prototype.setRotSnap=function(t){this.snapR=t},t.prototype.setScaleSnap=function(t){this.snapS=t},t.prototype.setTransSnapValue=function(t){this.tSnap=new c(t,t,t),this.transSnap=t},t.prototype.setRotSnapValue=function(t){this.rotSnap=t},t.prototype.setScaleSnapValue=function(t){this.scaleSnap=t},t.getAngle=function(t,i,s,e){var n=t.subtract(s),h=i.subtract(s),a=c.Cross(n,h),r=Math.asin(a.length()/(n.length()*h.length()));return c.Dot(a,e)<0&&(r*=-1),r},t.prototype.createMaterials=function(i){this.redMat=t.getStandardMaterial("redMat",e.Red(),i),this.greenMat=t.getStandardMaterial("greenMat",e.Green(),i),this.blueMat=t.getStandardMaterial("blueMat",e.Blue(),i),this.whiteMat=t.getStandardMaterial("whiteMat",e.White(),i),this.yellowMat=t.getStandardMaterial("whiteMat",e.Yellow(),i)},t.prototype.disposeMaterials=function(){this.redMat.dispose(),this.greenMat.dispose(),this.blueMat.dispose(),this.whiteMat.dispose(),this.yellowMat.dispose()},t.getStandardMaterial=function(t,i,s){var n=new l(t,s);return n.emissiveColor=i,n.diffuseColor=e.Black(),n.specularColor=e.Black(),n.backFaceCulling=!1,n},t}();t.EditControl=p;var d=function(){function t(t,i){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=i-1,this.add()}return t.prototype.setCapacity=function(t){if(0==t)return void console.error("capacity should be more than zero");this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()},t.prototype.add=function(t){void 0===t&&(t=null);var i=new u(this.mesh,t);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(i)):(this.acts.push(i),this.last++,this.current++)},t.prototype.undo=function(){if(this.current>0){var t=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),t}},t.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},t}();t.ActHist=d;var u=function(){function t(t,i){this.p=t.position.clone(),null==t.rotationQuaternion?(this.rQ=null,this.rE=t.rotation.clone()):(this.rQ=t.rotationQuaternion.clone(),this.rE=null),this.s=t.scaling.clone(),this.at=i}return t.prototype.getActionType=function(){return this.at},t.prototype.perform=function(t){t.position.copyFrom(this.p),
null==t.rotationQuaternion?null!=this.rE?t.rotation.copyFrom(this.rE):t.rotation.copyFrom(this.rQ.toEulerAngles()):null!=this.rQ?t.rotationQuaternion.copyFrom(this.rQ):t.rotationQuaternion.copyFrom(r.RotationYawPitchRoll(this.rE.y,this.rE.x,this.rE.z)),t.scaling.copyFrom(this.s)},t}();t.Act=u}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));