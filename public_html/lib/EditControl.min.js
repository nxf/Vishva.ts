var org;!function(t){!function(t){!function(t){!function(t){var i=BABYLON.Axis,s=BABYLON.Color3,e=BABYLON.Mesh,n=BABYLON.MeshBuilder,h=BABYLON.Path2,a=BABYLON.Quaternion,r=BABYLON.Space,o=BABYLON.StandardMaterial,l=BABYLON.Vector3,p=function(){function t(t,i,s,n,h){var r=this;this.local=!0,this.snapT=!1,this.snapR=!1,this.transSnap=1,this.rotSnap=Math.PI/18,this.axesLen=.4,this.axesScale=1,this.visibility=.7,this.distFromCamera=2,this.toParent=new l(0,0,0),this.cameraNormal=new l(0,0,0),this.pDown=!1,this.pointerIsOver=!1,this.editing=!1,this.snapRX=0,this.snapRY=0,this.snapRZ=0,this.snapTV=new l(0,0,0),this.transBy=new l(0,0,0),this.snapS=!1,this.snapSX=0,this.snapSY=0,this.snapSZ=0,this.snapSA=0,this.snapSV=new l(0,0,0),this.scaleSnap=.25,this.scale=new l(0,0,0),this.eulerian=!1,this.snapRA=0,this.cN=new l(0,0,0),this.transEnabled=!1,this.rotEnabled=!1,this.scaleEnabled=!1,this.localX=new l(0,0,0),this.localY=new l(0,0,0),this.localZ=new l(0,0,0),this.mesh=t,this.canvas=s,this.axesScale=n,this.eulerian=null!==h&&h,this.scene=t.getScene(),this.mainCamera=i,this.actHist=new c(t,10),t.computeWorldMatrix(!0),this.theParent=new e("EditControl",this.scene),this.theParent.rotationQuaternion=a.Identity(),this.theParent.visibility=0,this.theParent.isPickable=!1,this.createMaterials(this.scene),this.createGuideAxes(),this.guideCtl.parent=this.theParent,this.createPickPlanes(),this.pickPlanes.parent=this.theParent,this.pointerdown=function(t){return r.onPointerDown(t)},this.pointerup=function(t){return r.onPointerUp(t)},this.pointermove=function(t){return r.onPointerMove(t)},s.addEventListener("pointerdown",this.pointerdown,!1),s.addEventListener("pointerup",this.pointerup,!1),s.addEventListener("pointermove",this.pointermove,!1),this.setLocalAxes(t),this.renderer=function(){return r.renderLoopProcess()},this.scene.registerBeforeRender(this.renderer)}return t.prototype.setAxesScale=function(){this.theParent.position.subtractToRef(this.mainCamera.position,this.toParent),l.FromFloatArrayToRef(this.mainCamera.getWorldMatrix().asArray(),8,this.cameraNormal);var t=l.Dot(this.toParent,this.cameraNormal)/this.cameraNormal.length(),i=t/this.distFromCamera;l.FromFloatsToRef(i,i,i,this.theParent.scaling),l.FromFloatsToRef(i,i,i,this.pALL.scaling)},t.prototype.setAxesRotation=function(){if(this.local)if(this.eulerian){var t=this.mesh.rotation;this.theParent.rotationQuaternion.copyFrom(BABYLON.Quaternion.RotationYawPitchRoll(t.y,t.x,t.z))}else this.theParent.rotationQuaternion=this.mesh.rotationQuaternion},t.prototype.renderLoopProcess=function(){this.setAxesScale(),this.setAxesRotation(),this.theParent.position=this.mesh.getAbsolutePivotPoint(),this.onPointerOver()},t.prototype.switchTo=function(t,i){t.computeWorldMatrix(!0),this.mesh=t,null!=i&&(this.eulerian=i),this.setLocalAxes(t),this.actHist=new c(t,10)},t.prototype.setUndoCount=function(t){this.actHist.setCapacity(t)},t.prototype.undo=function(){this.actHist.undo(),this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh)},t.prototype.redo=function(){this.actHist.redo(),this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh)},t.prototype.detach=function(){this.canvas.removeEventListener("pointerdown",this.pointerdown,!1),this.canvas.removeEventListener("pointerup",this.pointerup,!1),this.canvas.removeEventListener("pointermove",this.pointermove,!1),this.scene.unregisterBeforeRender(this.renderer),this.disposeAll()},t.prototype.disposeAll=function(){this.theParent.dispose(),this.disposeMaterials(),this.actHist=null},t.prototype.onPointerDown=function(t){var i=this;if(t.preventDefault(),this.pDown=!0,0==t.button){var s=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){if(i.transEnabled){if(t==i.tX||t==i.tY||t==i.tZ||t==i.tXZ||t==i.tZY||t==i.tYX||t==i.tAll)return!0}else if(i.rotEnabled){if(t==i.rX||t==i.rY||t==i.rZ||t==i.rAll)return!0}else if(i.scaleEnabled&&(t==i.sX||t==i.sY||t==i.sZ||t==i.sXZ||t==i.sZY||t==i.sYX||t==i.sAll))return!0;return!1},null,this.mainCamera);if(s.hit){this.axisPicked=s.pickedMesh;var e=this.axisPicked.getChildren();e.length>0?e[0].visibility=this.visibility:this.axisPicked.visibility=this.visibility;var n=this.axisPicked.name;"X"==n?this.bXaxis.visibility=1:"Y"==n?this.bYaxis.visibility=1:"Z"==n?this.bZaxis.visibility=1:"XZ"==n?(this.bXaxis.visibility=1,this.bZaxis.visibility=1):"ZY"==n?(this.bZaxis.visibility=1,this.bYaxis.visibility=1):"YX"==n?(this.bYaxis.visibility=1,this.bXaxis.visibility=1):"ALL"==n&&(this.bXaxis.visibility=1,this.bYaxis.visibility=1,this.bZaxis.visibility=1),this.editing=!0,this.pickPlane=this.getPickPlane(this.axisPicked),this.prevPos=this.getPosOnPickPlane(),window.setTimeout(function(t,s){return i.detachControl(t,s)},0,this.mainCamera,this.canvas)}}},t.prototype.isEditing=function(){return this.editing},t.prototype.detachControl=function(t,i){var s=t,e=i;s.detachControl(e)},t.prototype.isPointerOver=function(){return this.pointerIsOver},t.prototype.onPointerOver=function(){var t=this;if(!this.pDown){var i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){if(t.transEnabled){if(i==t.tX||i==t.tY||i==t.tZ||i==t.tXZ||i==t.tZY||i==t.tYX||i==t.tAll)return!0}else if(t.rotEnabled){if(i==t.rX||i==t.rY||i==t.rZ||i==t.rAll)return!0}else if(t.scaleEnabled&&(i==t.sX||i==t.sY||i==t.sZ||i==t.sXZ||i==t.sZY||i==t.sYX||i==t.sAll))return!0;return!1},null,this.mainCamera);if(i.hit){if(i.pickedMesh!=this.prevOverMesh){if(this.pointerIsOver=!0,null!=this.prevOverMesh&&(this.prevOverMesh.visibility=0,this.restoreColor(this.prevOverMesh)),this.prevOverMesh=i.pickedMesh,this.rotEnabled)this.savedCol=this.prevOverMesh.getChildren()[0].color,this.prevOverMesh.getChildren()[0].color=s.White();else{var e=this.prevOverMesh.getChildren();e.length>0?(this.savedMat=e[0].material,e[0].material=this.whiteMat):(this.savedMat=this.prevOverMesh.material,this.prevOverMesh.material=this.whiteMat)}"X"==this.prevOverMesh.name?this.xaxis.color=s.White():"Y"==this.prevOverMesh.name?this.yaxis.color=s.White():"Z"==this.prevOverMesh.name&&(this.zaxis.color=s.White())}}else this.pointerIsOver=!1,null!=this.prevOverMesh&&(this.restoreColor(this.prevOverMesh),this.prevOverMesh=null)}},t.prototype.restoreColor=function(t){switch(t.name){case"X":this.xaxis.color=s.Red();break;case"Y":this.yaxis.color=s.Green();break;case"Z":this.zaxis.color=s.Blue()}if(this.rotEnabled)t.getChildren()[0].color=this.savedCol;else{var i=t.getChildren();i.length>0?i[0].material=this.savedMat:t.material=this.savedMat}},t.prototype.onPointerUp=function(t){this.pDown=!1,this.editing&&(this.mainCamera.attachControl(this.canvas),this.editing=!1,this.hideBaxis(),this.restoreColor(this.prevOverMesh),this.prevOverMesh=null,this.actHist.add())},t.prototype.onPointerMove=function(t){if(this.pDown&&this.editing){this.pickPlane=this.getPickPlane(this.axisPicked);var i=this.getPosOnPickPlane();if(null!=i){var s=i.subtract(this.prevPos);0==s.x&&0==s.y&&0==s.z||(this.transEnabled&&this.doTranslation(s),this.scaleEnabled&&this.local&&this.doScaling(s),this.rotEnabled&&this.doRotation(this.mesh,this.axisPicked,i),this.prevPos=i)}}},t.prototype.getPickPlane=function(t){var i=t.name;if(this.transEnabled||this.scaleEnabled){if("XZ"==i)return this.pXZ;if("ZY"==i)return this.pZY;if("YX"==i)return this.pYX;if("ALL"==i)return this.pALL;var s=this.mesh.getWorldMatrix().clone().invert(),e=l.TransformCoordinates(this.mainCamera.position,s),n=this.mesh.scaling;if("X"===i)return Math.abs(e.y*n.y)>Math.abs(e.z*n.z)?this.pXZ:this.pYX;if("Z"===i)return Math.abs(e.y*n.y)>Math.abs(e.x*n.x)?this.pXZ:this.pZY;if("Y"===i)return Math.abs(e.z*n.z)>Math.abs(e.x*n.x)?this.pYX:this.pZY}else{if(!this.rotEnabled)return null;switch(i){case"X":return this.pZY;case"Y":return this.pXZ;case"Z":return this.pYX;default:return this.pALL}}},t.prototype.doTranslation=function(t){this.transBy.x=0,this.transBy.y=0,this.transBy.z=0;var i=this.axisPicked.name;"X"!=i&&"XZ"!=i&&"YX"!=i&&"ALL"!=i||(this.local?this.transBy.x=l.Dot(t,this.localX)/(this.localX.length()*this.mesh.scaling.x):this.transBy.x=t.x),"Y"!=i&&"ZY"!=i&&"YX"!=i&&"ALL"!=i||(this.local?this.transBy.y=l.Dot(t,this.localY)/(this.localY.length()*this.mesh.scaling.y):this.transBy.y=t.y),"Z"!=i&&"XZ"!=i&&"ZY"!=i&&"ALL"!=i||(this.local?this.transBy.z=l.Dot(t,this.localZ)/(this.localZ.length()*this.mesh.scaling.z):this.transBy.z=t.z),this.transWithSnap(this.mesh,this.transBy,this.local),this.mesh.computeWorldMatrix(!0)},t.prototype.transWithSnap=function(t,s,e){if(this.snapT){var n=!1;if(this.snapTV.addInPlace(s),Math.abs(this.snapTV.x)>this.tSnap.x/t.scaling.x&&(this.snapTV.x>0?s.x=this.tSnap.x:s.x=-this.tSnap.x,s.x=s.x/t.scaling.x,n=!0),Math.abs(this.snapTV.y)>this.tSnap.y/t.scaling.y&&(this.snapTV.y>0?s.y=this.tSnap.y:s.y=-this.tSnap.y,s.y=s.y/t.scaling.y,n=!0),Math.abs(this.snapTV.z)>this.tSnap.z/t.scaling.z&&(this.snapTV.z>0?s.z=this.tSnap.z:s.z=-this.tSnap.z,s.z=s.z/t.scaling.z,n=!0),!n)return;Math.abs(s.x)!==this.tSnap.x/t.scaling.x&&(s.x=0),Math.abs(s.y)!==this.tSnap.y/t.scaling.y&&(s.y=0),Math.abs(s.z)!==this.tSnap.z/t.scaling.z&&(s.z=0),l.FromFloatsToRef(0,0,0,this.snapTV),n=!1}e?(this.mesh.translate(i.X,s.x,r.LOCAL),this.mesh.translate(i.Y,s.y,r.LOCAL),this.mesh.translate(i.Z,s.z,r.LOCAL)):this.mesh.position.addInPlace(s)},t.prototype.doScaling=function(t){this.scale.x=0,this.scale.y=0,this.scale.z=0;var i=this.axisPicked.name;"X"!=i&&"XZ"!=i&&"YX"!=i&&"ALL"!=i||(this.scale.x=l.Dot(t,this.localX)/this.localX.length()),"Y"!=i&&"ZY"!=i&&"YX"!=i&&"ALL"!=i||(this.scale.y=l.Dot(t,this.localY)/this.localY.length()),"Z"!=i&&"XZ"!=i&&"ZY"!=i&&"ALL"!=i||(this.scale.z=l.Dot(t,this.localZ)/this.localZ.length()),"ALL"==i&&this.scale.copyFromFloats(this.scale.y,this.scale.y,this.scale.y),this.scaleWithSnap(this.mesh,this.scale)},t.prototype.scaleWithSnap=function(t,i){if(this.snapS){var s=!1;if(this.snapSV.addInPlace(i),Math.abs(this.snapSV.x)>this.scaleSnap&&(i.x>0?i.x=this.scaleSnap:i.x=-this.scaleSnap,s=!0),Math.abs(this.snapSV.y)>this.scaleSnap&&(i.y>0?i.y=this.scaleSnap:i.y=-this.scaleSnap,s=!0),Math.abs(this.snapSV.z)>this.scaleSnap&&(i.z>0?i.z=this.scaleSnap:i.z=-this.scaleSnap,s=!0),!s)return;Math.abs(i.x)!==this.scaleSnap&&0!==i.x&&(i.x=0),Math.abs(i.y)!==this.scaleSnap&&0!==i.y&&(i.y=0),Math.abs(i.z)!==this.scaleSnap&&0!==i.z&&(i.z=0),l.FromFloatsToRef(0,0,0,this.snapSV),s=!1}t.scaling.addInPlace(i)},t.prototype.doRotation=function(s,e,n){var h=this.cN;l.TransformNormalToRef(i.Z,this.mainCamera.getWorldMatrix(),h);var a=t.getAngle(this.prevPos,n,s.getAbsolutePivotPoint(),h);e==this.rX?(this.snapR&&(this.snapRX+=a,a=0,Math.abs(this.snapRX)>=this.rotSnap&&(a=this.snapRX>0?this.rotSnap:-this.rotSnap,this.snapRX=0)),0!==a&&(this.local?(l.Dot(this.localX,h)<0&&(a*=-1),s.rotate(i.X,a,r.LOCAL)):s.rotate(new l(h.x,0,0),a,r.WORLD))):e==this.rY?(this.snapR&&(this.snapRY+=a,a=0,Math.abs(this.snapRY)>=this.rotSnap&&(a=this.snapRY>0?this.rotSnap:-this.rotSnap,this.snapRY=0)),0!==a&&(this.local?(l.Dot(this.localY,h)<0&&(a*=-1),s.rotate(i.Y,a,r.LOCAL)):s.rotate(new l(0,h.y,0),a,r.WORLD))):e==this.rZ?(this.snapR&&(this.snapRZ+=a,a=0,Math.abs(this.snapRZ)>=this.rotSnap&&(a=this.snapRZ>0?this.rotSnap:-this.rotSnap,this.snapRZ=0)),0!==a&&(this.local?(l.Dot(this.localZ,h)<0&&(a*=-1),s.rotate(i.Z,a,r.LOCAL)):s.rotate(new l(0,0,h.z),a,r.WORLD))):e==this.rAll&&(this.snapR&&(this.snapRA+=a,a=0,Math.abs(this.snapRA)>=this.rotSnap&&(a=this.snapRA>0?this.rotSnap:-this.rotSnap,this.snapRA=0)),0!==a&&s.rotate(s.position.subtract(this.mainCamera.position),a,r.WORLD)),this.setLocalAxes(this.mesh),this.eulerian&&(s.rotation=s.rotationQuaternion.toEulerAngles(),s.rotationQuaternion=null)},t.prototype.getPosOnPickPlane=function(){var t=this,i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){return i==t.pickPlane},null,this.mainCamera);return i.hit?i.pickedPoint:null},t.prototype.hideBaxis=function(){this.bXaxis.visibility=0,this.bYaxis.visibility=0,this.bZaxis.visibility=0},t.prototype.isTranslationEnabled=function(){return this.transEnabled},t.prototype.enableTranslation=function(){null==this.tX&&(this.createTransAxes(),this.tCtl.parent=this.theParent),this.transEnabled||(this.tEndX.visibility=this.visibility,this.tEndY.visibility=this.visibility,this.tEndZ.visibility=this.visibility,this.tEndXZ.visibility=this.visibility,this.tEndZY.visibility=this.visibility,this.tEndYX.visibility=this.visibility,this.tEndAll.visibility=this.visibility,this.transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this.transEnabled&&(this.tEndX.visibility=0,this.tEndY.visibility=0,this.tEndZ.visibility=0,this.tEndXZ.visibility=0,this.tEndZY.visibility=0,this.tEndYX.visibility=0,this.tEndAll.visibility=0,this.transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this.rotEnabled},t.prototype.returnEuler=function(t){this.eulerian=t},t.prototype.enableRotation=function(){null==this.rX&&(this.createRotAxes(),this.rCtl.parent=this.theParent),this.rotEnabled||(this.rEndX.visibility=this.visibility,this.rEndY.visibility=this.visibility,this.rEndZ.visibility=this.visibility,this.rEndAll.visibility=this.visibility,this.rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this.rotEnabled&&(this.rEndX.visibility=0,this.rEndY.visibility=0,this.rEndZ.visibility=0,this.rEndAll.visibility=0,this.rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this.scaleEnabled},t.prototype.enableScaling=function(){null==this.sX&&(this.createScaleAxes(),this.sCtl.parent=this.theParent),this.scaleEnabled||(this.sEndX.visibility=this.visibility,this.sEndY.visibility=this.visibility,this.sEndZ.visibility=this.visibility,this.sEndXZ.visibility=this.visibility,this.sEndZY.visibility=this.visibility,this.sEndYX.visibility=this.visibility,this.sEndAll.visibility=this.visibility,this.scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this.scaleEnabled&&(this.sEndX.visibility=0,this.sEndY.visibility=0,this.sEndZ.visibility=0,this.sEndXZ.visibility=0,this.sEndZY.visibility=0,this.sEndYX.visibility=0,this.sEndAll.visibility=0,this.scaleEnabled=!1)},t.prototype.createGuideAxes=function(){this.guideCtl=new e("guideCtl",this.scene),this.bXaxis=e.CreateLines("bxAxis",[new l(-100,0,0),new l(100,0,0)],this.scene),this.bYaxis=e.CreateLines("byAxis",[new l(0,-100,0),new l(0,100,0)],this.scene),this.bZaxis=e.CreateLines("bzAxis",[new l(0,0,-100),new l(0,0,100)],this.scene),this.bXaxis.isPickable=!1,this.bYaxis.isPickable=!1,this.bZaxis.isPickable=!1,this.bXaxis.parent=this.guideCtl,this.bYaxis.parent=this.guideCtl,this.bZaxis.parent=this.guideCtl,this.bXaxis.color=s.Red(),this.bYaxis.color=s.Green(),this.bZaxis.color=s.Blue(),this.hideBaxis();var t=this.axesLen*this.axesScale;this.xaxis=e.CreateLines("xAxis",[new l(0,0,0),new l(t,0,0)],this.scene),this.yaxis=e.CreateLines("yAxis",[new l(0,0,0),new l(0,t,0)],this.scene),this.zaxis=e.CreateLines("zAxis",[new l(0,0,0),new l(0,0,t)],this.scene),this.xaxis.isPickable=!1,this.yaxis.isPickable=!1,this.zaxis.isPickable=!1,this.xaxis.parent=this.guideCtl,this.yaxis.parent=this.guideCtl,this.zaxis.parent=this.guideCtl,this.xaxis.color=s.Red(),this.yaxis.color=s.Green(),this.zaxis.color=s.Blue(),this.xaxis.renderingGroupId=2,this.yaxis.renderingGroupId=2,this.zaxis.renderingGroupId=2},t.prototype.createPickPlanes=function(){this.pALL=e.CreatePlane("pALL",5,this.scene),this.pXZ=e.CreatePlane("pXZ",5,this.scene),this.pZY=e.CreatePlane("pZY",5,this.scene),this.pYX=e.CreatePlane("pYX",5,this.scene),this.pALL.isPickable=!1,this.pXZ.isPickable=!1,this.pZY.isPickable=!1,this.pYX.isPickable=!1,this.pALL.visibility=0,this.pXZ.visibility=0,this.pZY.visibility=0,this.pYX.visibility=0,this.pALL.renderingGroupId=1,this.pXZ.renderingGroupId=1,this.pZY.renderingGroupId=1,this.pYX.renderingGroupId=1,this.pALL.billboardMode=e.BILLBOARDMODE_ALL,this.pXZ.rotate(i.X,1.57),this.pZY.rotate(i.Y,1.57),this.pickPlanes=new e("pickPlanes",this.scene),this.pALL.parent=this.theParent,this.pXZ.parent=this.pickPlanes,this.pZY.parent=this.pickPlanes,this.pYX.parent=this.pickPlanes},t.prototype.createTransAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.tCtl=new e("tarnsCtl",this.scene),this.tX=this.extrudeBox(t/2,i),this.tX.name="X",this.tY=this.tX.clone("Y"),this.tZ=this.tX.clone("Z"),this.tXZ=n.CreatePlane("XZ",{size:2*t},this.scene),this.tZY=this.tXZ.clone("ZY"),this.tYX=this.tXZ.clone("YX"),this.tXZ.rotation.x=1.57,this.tZY.rotation.y=-1.57,this.tXZ.position.x=t,this.tXZ.position.z=t,this.tZY.position.z=t,this.tZY.position.y=t,this.tYX.position.y=t,this.tYX.position.x=t,this.tAll=e.CreateBox("ALL",2*t,this.scene),this.tX.parent=this.tCtl,this.tY.parent=this.tCtl,this.tZ.parent=this.tCtl,this.tXZ.parent=this.tCtl,this.tZY.parent=this.tCtl,this.tYX.parent=this.tCtl,this.tAll.parent=this.tCtl,this.tX.rotation.y=1.57,this.tY.rotation.x-=1.57,this.tX.visibility=0,this.tY.visibility=0,this.tZ.visibility=0,this.tXZ.visibility=0,this.tZY.visibility=0,this.tYX.visibility=0,this.tAll.visibility=0,this.tX.renderingGroupId=1,this.tY.renderingGroupId=1,this.tZ.renderingGroupId=1,this.tXZ.renderingGroupId=1,this.tZY.renderingGroupId=1,this.tYX.renderingGroupId=1,this.tAll.renderingGroupId=1,this.tX.isPickable=!1,this.tY.isPickable=!1,this.tZ.isPickable=!1,this.tXZ.isPickable=!1,this.tZY.isPickable=!1,this.tYX.isPickable=!1,this.tAll.isPickable=!1;var s=i/5,h=t;this.tEndX=e.CreateCylinder("tEndX",s,0,h,6,1,this.scene),this.tEndY=this.tEndX.clone("tEndY"),this.tEndZ=this.tEndX.clone("tEndZ"),this.tEndXZ=this.createTriangle("XZ",1.75*h,this.scene),this.tEndZY=this.tEndXZ.clone("ZY"),this.tEndYX=this.tEndXZ.clone("YX"),this.tEndAll=n.CreatePolyhedron("tEndAll",{type:1,size:h/2},this.scene),this.tEndX.rotation.x=1.57,this.tEndY.rotation.x=1.57,this.tEndZ.rotation.x=1.57,this.tEndXZ.rotation.x=-1.57,this.tEndZY.rotation.x=-1.57,this.tEndYX.rotation.x=-1.57,this.tEndX.parent=this.tX,this.tEndY.parent=this.tY,this.tEndZ.parent=this.tZ,this.tEndXZ.parent=this.tXZ,this.tEndZY.parent=this.tZY,this.tEndYX.parent=this.tYX,this.tEndAll.parent=this.tAll,this.tEndX.position.z=i-s/2,this.tEndY.position.z=i-s/2,this.tEndZ.position.z=i-s/2,this.tEndX.material=this.redMat,this.tEndY.material=this.greenMat,this.tEndZ.material=this.blueMat,this.tEndXZ.material=this.redMat,this.tEndZY.material=this.blueMat,this.tEndYX.material=this.greenMat,this.tEndAll.material=this.yellowMat,this.tEndX.renderingGroupId=1,this.tEndY.renderingGroupId=1,this.tEndZ.renderingGroupId=1,this.tEndXZ.renderingGroupId=1,this.tEndZY.renderingGroupId=1,this.tEndYX.renderingGroupId=1,this.tEndAll.renderingGroupId=1,this.tEndX.isPickable=!1,this.tEndY.isPickable=!1,this.tEndZ.isPickable=!1,this.tEndXZ.isPickable=!1,this.tEndZY.isPickable=!1,this.tEndYX.isPickable=!1,this.tEndAll.isPickable=!1},t.prototype.createTriangle=function(t,i,s){var e=new h(i/2,-i/2).addLineTo(i/2,i/2).addLineTo(-i/2,i/2).addLineTo(i/2,-i/2);return new BABYLON.PolygonMeshBuilder(t,e,s).build()},t.prototype.createRotAxes=function(){var t=this.axesLen*this.axesScale*2;this.rCtl=new e("rotCtl",this.scene),this.rX=this.createTube(t/2,90),this.rX.name="X",this.rY=this.rX.clone("Y"),this.rZ=this.rX.clone("Z"),this.rAll=this.createTube(t/1.75,360),this.rAll.name="ALL",this.rX.parent=this.rCtl,this.rY.parent=this.rCtl,this.rZ.parent=this.rCtl,this.rAll.parent=this.pALL,this.rX.rotation.z=1.57,this.rZ.rotation.x=-1.57,this.rAll.rotation.x=1.57,this.rX.visibility=0,this.rY.visibility=0,this.rZ.visibility=0,this.rAll.visibility=0,this.rX.renderingGroupId=1,this.rY.renderingGroupId=1,this.rZ.renderingGroupId=1,this.rAll.renderingGroupId=1,this.rX.isPickable=!1,this.rY.isPickable=!1,this.rZ.isPickable=!1,this.rAll.isPickable=!1;var i=t;this.rEndX=this.createCircle(i/2,90),this.rEndY=this.rEndX.clone(""),this.rEndZ=this.rEndX.clone(""),this.rEndAll=this.createCircle(i/1.75,360),this.rEndX.parent=this.rX,this.rEndY.parent=this.rY,this.rEndZ.parent=this.rZ,this.rEndAll.parent=this.rAll,this.rEndX.color=s.Red(),this.rEndY.color=s.Green(),this.rEndZ.color=s.Blue(),this.rEndAll.color=s.Yellow(),this.rEndX.renderingGroupId=1,this.rEndY.renderingGroupId=1,this.rEndZ.renderingGroupId=1,this.rEndAll.renderingGroupId=1,this.rEndX.isPickable=!1,this.rEndY.isPickable=!1,this.rEndZ.isPickable=!1,this.rEndAll.isPickable=!1},t.prototype.extrudeBox=function(t,i){var s=[new l(t,t,0),new l(-t,t,0),new l(-t,-t,0),new l(t,-t,0),new l(t,t,0)],n=[new l(0,0,0),new l(0,0,i)];return e.ExtrudeShape("",s,n,1,0,2,this.scene)},t.prototype.createCircle=function(t,i){null===i&&(i=360);for(var s,n,h=[],a=3.14/180,r=0,o=0;o<=i;o+=10)s=t*Math.cos(o*a),n=90==o?t:270==o?-t:t*Math.sin(o*a),h[r]=new l(s,0,n),r++;return e.CreateLines("",h,this.scene)},t.prototype.createTube=function(t,i){null===i&&(i=360);for(var s,n,h=[],a=3.14/180,r=0,o=0;o<=i;o+=30)s=t*Math.cos(o*a),n=90==o?t:270==o?-t:t*Math.sin(o*a),h[r]=new l(s,0,n),r++;return e.CreateTube("",h,.02,3,null,BABYLON.Mesh.NO_CAP,this.scene)},t.prototype.createScaleAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.sCtl=new e("sCtl",this.scene),this.sX=this.extrudeBox(t/2,i),this.sX.name="X",this.sY=this.sX.clone("Y"),this.sZ=this.sX.clone("Z"),this.sXZ=n.CreatePlane("XZ",{size:2*t},this.scene),this.sZY=this.sXZ.clone("ZY"),this.sYX=this.sXZ.clone("YX"),this.sXZ.rotation.x=1.57,this.sZY.rotation.y=-1.57,this.sXZ.position.x=t,this.sXZ.position.z=t,this.sZY.position.z=t,this.sZY.position.y=t,this.sYX.position.y=t,this.sYX.position.x=t,this.sAll=e.CreateBox("ALL",2*t,this.scene),this.sX.material=this.redMat,this.sY.material=this.greenMat,this.sZ.material=this.blueMat,this.sAll.material=this.yellowMat,this.sX.parent=this.sCtl,this.sY.parent=this.sCtl,this.sZ.parent=this.sCtl,this.sAll.parent=this.sCtl,this.sXZ.parent=this.sCtl,this.sZY.parent=this.sCtl,this.sYX.parent=this.sCtl,this.sX.rotation.y=1.57,this.sY.rotation.x-=1.57,this.sX.visibility=0,this.sY.visibility=0,this.sZ.visibility=0,this.sXZ.visibility=0,this.sZY.visibility=0,this.sYX.visibility=0,this.sAll.visibility=0,this.sX.renderingGroupId=1,this.sY.renderingGroupId=1,this.sZ.renderingGroupId=1,this.sXZ.renderingGroupId=1,this.sZY.renderingGroupId=1,this.sYX.renderingGroupId=1,this.sAll.renderingGroupId=1,this.sX.isPickable=!1,this.sY.isPickable=!1,this.sZ.isPickable=!1,this.sXZ.isPickable=!1,this.sZY.isPickable=!1,this.sYX.isPickable=!1,this.sAll.isPickable=!1;var s=t;this.sEndX=e.CreateBox("",s,this.scene),this.sEndY=this.sEndX.clone(""),this.sEndZ=this.sEndX.clone(""),this.sEndAll=n.CreatePolyhedron("sEndAll",{type:1,size:s/2},this.scene),this.sEndXZ=this.createTriangle("XZ",1.75*s,this.scene),this.sEndZY=this.sEndXZ.clone("ZY"),this.sEndYX=this.sEndXZ.clone("YX"),this.sEndXZ.rotation.x=-1.57,this.sEndZY.rotation.x=-1.57,this.sEndYX.rotation.x=-1.57,this.sEndX.parent=this.sX,this.sEndY.parent=this.sY,this.sEndZ.parent=this.sZ,this.sEndXZ.parent=this.sXZ,this.sEndZY.parent=this.sZY,this.sEndYX.parent=this.sYX,this.sEndAll.parent=this.sAll,this.sEndX.position.z=i-s/2,this.sEndY.position.z=i-s/2,this.sEndZ.position.z=i-s/2,this.sEndX.material=this.redMat,this.sEndY.material=this.greenMat,this.sEndZ.material=this.blueMat,this.sEndXZ.material=this.redMat,this.sEndZY.material=this.blueMat,this.sEndYX.material=this.greenMat,this.sEndAll.material=this.yellowMat,this.sEndX.renderingGroupId=1,this.sEndY.renderingGroupId=1,this.sEndZ.renderingGroupId=1,this.sEndXZ.renderingGroupId=1,this.sEndZY.renderingGroupId=1,this.sEndYX.renderingGroupId=1,this.sEndAll.renderingGroupId=1,this.sEndX.isPickable=!1,this.sEndY.isPickable=!1,this.sEndZ.isPickable=!1,this.sEndXZ.isPickable=!1,this.sEndZY.isPickable=!1,this.sEndYX.isPickable=!1,this.sEndAll.isPickable=!1},t.prototype.setLocalAxes=function(t){var i=t.getWorldMatrix();l.FromFloatArrayToRef(i.asArray(),0,this.localX),l.FromFloatArrayToRef(i.asArray(),4,this.localY),l.FromFloatArrayToRef(i.asArray(),8,this.localZ)},t.prototype.setLocal=function(t){this.local!=t&&(this.local=t,t||(this.theParent.rotationQuaternion=a.Identity()))},t.prototype.isLocal=function(){return this.local},t.prototype.setTransSnap=function(t){this.snapT=t},t.prototype.setRotSnap=function(t){this.snapR=t},t.prototype.setScaleSnap=function(t){this.snapS=t},t.prototype.setTransSnapValue=function(t){this.tSnap=new l(t,t,t),this.transSnap=t},t.prototype.setRotSnapValue=function(t){this.rotSnap=t},t.prototype.setScaleSnapValue=function(t){this.scaleSnap=t},t.getAngle=function(t,i,s,e){var n=t.subtract(s),h=i.subtract(s),a=l.Cross(n,h),r=Math.asin(a.length()/(n.length()*h.length()));return l.Dot(a,e)<0&&(r*=-1),r},t.prototype.createMaterials=function(i){this.redMat=t.getStandardMaterial("redMat",s.Red(),i),this.greenMat=t.getStandardMaterial("greenMat",s.Green(),i),this.blueMat=t.getStandardMaterial("blueMat",s.Blue(),i),this.whiteMat=t.getStandardMaterial("whiteMat",s.White(),i),this.yellowMat=t.getStandardMaterial("whiteMat",s.Yellow(),i)},t.prototype.disposeMaterials=function(){this.redMat.dispose(),this.greenMat.dispose(),this.blueMat.dispose(),this.whiteMat.dispose(),this.yellowMat.dispose()},t.getStandardMaterial=function(t,i,e){var n=new o(t,e);return n.emissiveColor=i,n.diffuseColor=s.Black(),n.specularColor=s.Black(),n.backFaceCulling=!1,n},t}();t.EditControl=p;var c=function(){function t(t,i){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=i-1,this.add()}return t.prototype.setCapacity=function(t){if(0==t)return void console.error("capacity should be more than zero");this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()},t.prototype.add=function(){var t=new d(this.mesh);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(t)):(this.acts.push(t),this.last++,this.current++)},t.prototype.undo=function(){this.current>0&&(this.current--,this.acts[this.current].perform(this.mesh))},t.prototype.redo=function(){this.current<this.last&&(this.current++,this.acts[this.current].perform(this.mesh))},t}();t.ActHist=c;var d=function(){function t(t){this.p=t.position.clone(),null==t.rotationQuaternion?(this.rQ=null,this.rE=t.rotation.clone()):(this.rQ=t.rotationQuaternion.clone(),this.rE=null),this.s=t.scaling.clone()}return t.prototype.perform=function(t){t.position.copyFrom(this.p),null==t.rotationQuaternion?null!=this.rE?t.rotation.copyFrom(this.rE):t.rotation.copyFrom(this.rQ.toEulerAngles()):null!=this.rQ?t.rotationQuaternion.copyFrom(this.rQ):t.rotationQuaternion.copyFrom(a.RotationYawPitchRoll(this.rE.y,this.rE.x,this.rE.z)),t.scaling.copyFrom(this.s)},t}();t.Act=d}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));