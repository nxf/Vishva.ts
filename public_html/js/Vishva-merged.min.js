var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),org;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,i,s,n){var o=this;this.inner1="<input class='colorInput' type='text' style='width:100%;height:32px;border-width:1px;border-style:solid;cursor: pointer' readonly></input>",this.inner2="<div class='colorDiag' style='align-content: center'><div  class='colorPicker cp-fancy'></div></div>",this.hexColor=i;var a=document.getElementById(t);a.innerHTML=this.inner1.concat(this.inner2),this.colorInput=a.getElementsByClassName("colorInput")[0],this.colorInput.style.backgroundColor=this.hexColor,this.colorInput.value=this.hexColor,this.colorInput.onclick=function(){o.diag.dialog("open"),o.cp.setHex(o.hexColor)};var r=a.getElementsByClassName("colorDiag")[0],h=r.getElementsByClassName("colorPicker")[0];this.cp=new ColorPicker(h,function(e,t,i){o.hexColor=e,o.colorInput.style.backgroundColor=e,o.colorInput.value=e,n(e,t,i)});var l={autoOpen:!1,resizable:!1,position:s,height:"auto",closeText:"",closeOnEscape:!1,title:e};this.diag=$(r),this.diag.dialog(l),this.diag.jpo=s}return e.prototype.open=function(e){this.diag.dialog("open"),this.setColor(e)},e.prototype.setColor=function(e){this.hexColor=e,this.cp.setHex(e),this.colorInput.style.backgroundColor=e,this.colorInput.value=e},e.prototype.getColor=function(){return this.hexColor},e}();e.ColorPickerDiag=t;!function(){function e(){this.r=0,this.g=0,this.b=0}}()}(e.gui||(e.gui={}))}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(t){!function(t){!function(t){!function(i){var s=e.ssatguru.babylonjs.vishva.gui.ColorPickerDiag,n=function(){function e(e){var t=this;this.local=!0,this.menuBarOn=!0,this.STATE_IND="state",this.dialogs=new Array,this._itemTab="---- ",this._prevCell=null,this.enableToolTips=!0,this.propsDiag=null,this.fixingDragIssue=!1,this.activePanel=-1,this.refreshingPropsDiag=!1,this.animUIInitialized=!1,this.animSelect=null,this.firstTime=!0,this.addMenuOn=!1,this.vishva=e,this.setSettings(),$(document).tooltip({open:function(e,i){t.enableToolTips||i.tooltip.stop().remove()}}),$("input").on("focus",function(){t.vishva.disableKeys()}),$("input").on("blur",function(){t.vishva.enableKeys()}),this.createJPOs(),this.createAddMenu(),this.createNavMenu(),this.createDownloadDiag(),this.createHelpDiag(),this.createAlertDiag(),this.create_sNaDiag(),this.createEditSensDiag(),this.createEditActDiag(),window.addEventListener("resize",function(e){return t.onWindowResize(e)})}return e.prototype.createJPOs=function(){this.centerBottom={at:"center bottom",my:"center bottom",of:window},this.leftCenter={at:"left center",my:"left center",of:window},this.rightCenter={at:"right center",my:"right center",of:window},this.rightTop={at:"right top",my:"right top",of:window}},e.prototype.onWindowResize=function(e){for(var t=0;t<this.dialogs.length;t++){var i=this.dialogs[t],s=i.jpo;if(null!=s){i.dialog("option","position",s);i.dialog("isOpen")&&(i.dialog("close"),i.dialog("open"))}}},e.prototype.createAddMenu=function(){var e=this,t=Object.keys(this.vishva.assets),i=document.getElementById("AddMenu");i.style.visibility="visible";for(var s=function(t){return e.onAddMenuItemClick(t)},n=0,o=t;n<o.length;n++){var a=o[n];if("sounds"!==a){var r=document.createElement("li");r.id="add-"+a,r.innerText=a,r.onclick=s,i.appendChild(r)}}},e.prototype.onAddMenuItemClick=function(e){var t=e.target,i=t.diag;if(null==i){var s=t.innerHTML;i=this.createAssetDiag(s),t.diag=i}return i.dialog("open"),!0},e.prototype.createAssetDiag=function(e){var t=document.createElement("div");t.id=e+"Div",t.setAttribute("title",e);var i=document.createElement("table");i.id=e+"Tbl";var s=this.vishva.assets[e];this.updateAssetTable(i,e,s),t.appendChild(i),document.body.appendChild(t);var n=$("#"+t.id),o={autoOpen:!1,resizable:!0,position:this.centerBottom,width:"95%",height:"auto",closeText:"",closeOnEscape:!1};return n.dialog(o),n.jpo=this.centerBottom,this.dialogs.push(n),n},e.prototype.updateAssetTable=function(t,i,s){var n=this;if(!(t.rows.length>0)){for(var o=function(e){return n.onAssetImgClick(e)},a=t.insertRow(),r=0,h=s;r<h.length;r++){var l=h[r],u=document.createElement("img");u.id=l;var c=l.split(".")[0];u.src="vishva/assets/"+i+"/"+c+"/"+c+".jpg",u.setAttribute("style",e.SMALL_ICON_SIZE+"cursor:pointer;"),u.className=i,u.onclick=o;a.insertCell().appendChild(u)}for(var p=t.insertRow(),d=0,g=s;d<g.length;d++){var l=g[d];p.insertCell().innerText=l}}},e.prototype.onAssetImgClick=function(e){var t=e.target;return"skyboxes"===t.className?this.vishva.setSky(t.id):"primitives"===t.className?this.vishva.addPrim(t.id):"water"===t.className?this.vishva.createWater():this.vishva.loadAsset(t.className,t.id),!0},e.prototype._createItemsDiag=function(){var e=this;document.getElementById("itemsRefresh").onclick=function(){e._itemsDiag.dialog("close"),e._updateItemsTable(),e._itemsDiag.dialog("open")},this._itemsDiag=$("#itemsDiv");var t={autoOpen:!1,resizable:!1,position:this.rightTop,width:"auto",height:"auto",closeText:"",closeOnEscape:!1};this._itemsDiag.dialog(t),this._itemsDiag.jpo=this.rightTop,this.dialogs.push(this._itemsDiag)},e.prototype._onItemClick=function(e){var t=e.target;t instanceof HTMLTableCellElement&&t!=this._prevCell&&(this.vishva.selectMesh(t.id),t.setAttribute("style","text-decoration: underline"),null!=this._prevCell&&this._prevCell.setAttribute("style","text-decoration: none"),this._prevCell=t)},e.prototype._clearPrevItem=function(){null!=this._prevCell&&(this._prevCell.setAttribute("style","text-decoration: none"),this._prevCell=null)},e.prototype._updateItemsTable=function(){var e=this,t=document.getElementById("itemsTable");t.onclick=function(t){return e._onItemClick(t)};for(var i=t.rows.length,s=i-1;s>=0;s--)t.deleteRow(s);for(var n,o=this.vishva.getMeshList(),a=this._getMeshChildMap(o),r=0,h=o;r<h.length;r++){var l=h[r];if(null==l.parent){var u=t.insertRow(),c=u.insertCell();c.innerText=l.name,c.id=Number(l.uniqueId).toString(),n=a[l.uniqueId],null!=n&&this._addChildren(n,t,a,this._itemTab)}}},e.prototype._addChildren=function(e,t,i,s){for(var n=0,o=e;n<o.length;n++){var a=o[n],r=t.insertRow(),h=r.insertCell();h.innerText=s+a.name,h.id=Number(a.uniqueId).toString();var l=i[a.uniqueId];null!=l&&this._addChildren(l,t,i,s+this._itemTab)}},e.prototype._getMeshChildMap=function(e){for(var t={},i=0,s=e;i<s.length;i++){var n=s[i];if(null!=n.parent){var o=t[n.parent.uniqueId];null==o&&(o=new Array,t[n.parent.uniqueId]=o),o.push(n)}}return t},e.prototype.createEnvDiag=function(){var e=this,t=$("#sunPos"),i=$("#light"),n=$("#shade"),o=$("#fog"),a=$("#fov");t.slider(this.sliderOptions(0,180,this.vishva.getSunPos())),i.slider(this.sliderOptions(0,100,100*this.vishva.getLight())),n.slider(this.sliderOptions(0,100,100*this.vishva.getShade())),o.slider(this.sliderOptions(0,100,100*this.vishva.getFog()));new s("fog color","fogCol",this.vishva.getFogColor(),this.centerBottom,function(t,i,s){e.vishva.setFogColor(t)});a.slider(this.sliderOptions(0,180,this.vishva.getFov())),document.getElementById("envSnow").onclick=function(t){e.vishva.toggleSnow()},document.getElementById("envRain").onclick=function(t){e.vishva.toggleRain()},document.getElementById("skyButton").onclick=function(e){return document.getElementById("add-skyboxes").click(),!0},document.getElementById("trnButton").onclick=function(t){return e.showAlertDiag("Sorry. To be implemneted soon"),!0};new s("ambient color","ambCol",this.vishva.getAmbientColor(),this.centerBottom,function(t,i,s){e.vishva.setAmbientColor(t)}),new s("terrain color","trnCol",this.vishva.getGroundColor(),this.centerBottom,function(t,i,s){e.vishva.setGroundColor(t)});this.envDiag=$("#envDiv");var r={autoOpen:!1,resizable:!1,position:this.rightCenter,minWidth:350,height:"auto",closeText:"",closeOnEscape:!1};this.envDiag.dialog(r),this.envDiag.jpo=this.rightCenter,this.dialogs.push(this.envDiag)},e.prototype.createSettingDiag=function(){var e=this;this.settingDiag=$("#settingDiag"),this.camCol=$("#camCol"),this.autoEditMenu=$("#autoEditMenu"),this.showToolTips=$("#showToolTips"),this.showInvis=$("#showInvis"),this.showDisa=$("#showDisa"),this.snapper=$("#snapper");var t={autoOpen:!1,resizable:!1,position:this.rightCenter,minWidth:350,height:"auto",closeText:"",closeOnEscape:!1};this.settingDiag.dialog(t),this.settingDiag.jpo=this.rightCenter,this.dialogs.push(this.settingDiag);var i={};i.text="save",i.click=function(t){e.vishva.enableCameraCollision(e.camCol.prop("checked")),e.vishva.enableAutoEditMenu(e.autoEditMenu.prop("checked")),e.enableToolTips=e.showToolTips.prop("checked"),e.showInvis.prop("checked")?e.vishva.showAllInvisibles():e.vishva.hideAllInvisibles(),e.showDisa.prop("checked")?e.vishva.showAllDisabled():e.vishva.hideAllDisabled();var i=e.vishva.snapper(e.snapper.prop("checked"));return null!=i?(e.showAlertDiag(i),!1):(e.settingDiag.dialog("close"),e.refreshPropsDiag(),!0)};var s={};s.text="Cancel",s.click=function(t){return e.settingDiag.dialog("close"),!0};var n=[i,s];this.settingDiag.dialog("option","buttons",n)},e.prototype.updateSettings=function(){this.camCol.prop("checked",this.vishva.isCameraCollisionOn()),this.autoEditMenu.prop("checked",this.vishva.isAutoEditMenuOn()),this.showToolTips.prop("checked",this.enableToolTips)},e.prototype.createDownloadDiag=function(){this.downloadLink=document.getElementById("downloadLink"),this.downloadDialog=$("#saveDiv"),this.downloadDialog.dialog(),this.downloadDialog.dialog("close")},e.prototype.createUploadDiag=function(){var e=this,t=document.getElementById("loadFileInput");document.getElementById("loadFileOk").onclick=function(t){return function(i){var s=t.files;if(0===s.length)return alert("no file slected"),null;for(var n=null,o=0;o<s.length;o++)n=s[o];return e.vishva.loadAssetFile(n),e.loadDialog.dialog("close"),!0}}(t),this.loadDialog=$("#loadDiv"),this.loadDialog.dialog(),this.loadDialog.dialog("close")},e.prototype.createHelpDiag=function(){this.helpDiag=$("#helpDiv");var e={autoOpen:!1,resizable:!1,width:500,closeOnEscape:!1,closeText:""};this.helpDiag.dialog(e)},e.prototype.createTextureDiag=function(){var e=this;this.textureDiag=$("#textureDiag");var t={autoOpen:!1,resizable:!1,width:"auto",closeOnEscape:!1,closeText:""};this.textureDiag.dialog(t),this.textureDiag.jpo=this.centerBottom,this.dialogs.push(this.textureDiag),this.textureImg=document.getElementById("textImg"),document.getElementById("changeTexture").onclick=function(){e.vishva.setMatTexture(e.matTextType.value,s.value)};for(var i,s=document.getElementById("textureList"),n=this.vishva.getTextures(),o=0,a=n;o<a.length;o++){var r=a[o];i=document.createElement("option"),i.value=r,i.innerText=r,s.appendChild(i)}},e.prototype.create_sNaDiag=function(){var e=this;$("#sNaDetails").tabs(),this.sNaDialog=$("#sNaDiag");var t={};t.autoOpen=!1,t.modal=!1,t.resizable=!1,t.width="auto",t.height="auto",t.title="Sensors and Actuators",t.closeOnEscape=!1,t.closeText="",t.dragStop=function(t,i){e.sNaDialog.dialog("close"),e.sNaDialog.dialog("open")},this.sNaDialog.dialog(t),this.sensSel=document.getElementById("sensSel"),this.actSel=document.getElementById("actSel");for(var i=this.vishva.getSensorList(),s=this.vishva.getActuatorList(),n=0,o=i;n<o.length;n++){var a=o[n],r=document.createElement("option");r.value=a,r.innerHTML=a,this.sensSel.add(r)}for(var h=0,l=s;h<l.length;h++){var u=l[h],r=document.createElement("option");r.value=u,r.innerHTML=u,this.actSel.add(r)}this.sensTbl=document.getElementById("sensTbl"),this.actTbl=document.getElementById("actTbl")},e.prototype.show_sNaDiag=function(){var e=this,t=this.vishva.getSensors();if(null==t)return void this.showAlertDiag("no mesh selected");var i=this.vishva.getActuators();if(null==i)return void this.showAlertDiag("no mesh selected");this.updateSensActTbl(t,this.sensTbl),this.updateSensActTbl(i,this.actTbl),document.getElementById("addSens").onclick=function(t){var i=e.sensSel.item(e.sensSel.selectedIndex),s=i.value;return e.vishva.addSensorbyName(s),e.updateSensActTbl(e.vishva.getSensors(),e.sensTbl),e.sNaDialog.dialog("close"),e.sNaDialog.dialog("open"),!0},document.getElementById("addAct").onclick=function(t){var i=e.actSel.item(e.actSel.selectedIndex),s=i.value;return e.vishva.addActuaorByName(s),e.updateSensActTbl(e.vishva.getActuators(),e.actTbl),e.sNaDialog.dialog("close"),e.sNaDialog.dialog("open"),!0},console.log("opening sna "),this.sNaDialog.dialog("open")},e.prototype.updateSensActTbl=function(e,t){for(var i=this,s=t.rows.length,n=s-1;n>0;n--)t.deleteRow(n);s=e.length;for(var n=0;n<s;n++){var o=t.insertRow(),a=o.insertCell();a.innerHTML=e[n].getName(),a=o.insertCell(),a.innerHTML=e[n].getProperties().signalId,a=o.insertCell();var r=document.createElement("BUTTON");r.innerHTML="edit";$(r).button();var h=n;r.id=h.toString(),r.sa=e[n],a.appendChild(r),r.onclick=function(e){var t=e.currentTarget,s=t.sa;return"SENSOR"===s.getType()?i.showEditSensDiag(s):i.showEditActDiag(s),!0},a=o.insertCell();var l=document.createElement("BUTTON");l.innerHTML="del";$(l).button(),l.id=h.toString(),l.row=o,l.sa=e[n],a.appendChild(l),l.onclick=function(e){var s=e.currentTarget,n=s.row;return t.deleteRow(n.rowIndex),i.vishva.removeSensorActuator(s.sa),!0}}},e.prototype.createEditSensDiag=function(){var e=this;this.editSensDiag=$("#editSensDiag");var t={};t.autoOpen=!1,t.modal=!0,t.resizable=!1,t.width="auto",t.title="Edit Sensor",t.closeText="",t.closeOnEscape=!1,t.open=function(){e.vishva.disableKeys()},t.close=function(){e.vishva.enableKeys()},this.editSensDiag.dialog(t)},e.prototype.showEditSensDiag=function(e){var t=this;document.getElementById("editSensDiag.sensName").innerHTML=e.getName(),this.editSensDiag.dialog("open");var i=document.getElementById("editSensDiag.parms"),s=i.firstChild;null!=s&&i.removeChild(s),console.log(e.getProperties());var n=this.formCreate(e.getProperties(),i.id);i.appendChild(n);var o={};o.text="save",o.click=function(s){return t.formRead(e.getProperties(),i.id),e.handlePropertiesChange(),t.updateSensActTbl(t.vishva.getSensors(),t.sensTbl),t.editSensDiag.dialog("close"),!0};var a=[o];this.editSensDiag.dialog("option","buttons",a)},e.prototype.createEditActDiag=function(){var e=this;this.editActDiag=$("#editActDiag");var t={};t.autoOpen=!1,t.modal=!0,t.resizable=!1,t.width="auto",t.title="Edit Actuator",t.closeText="",t.closeOnEscape=!1,t.open=function(t,i){e.vishva.disableKeys()},t.close=function(t,i){e.vishva.enableKeys()},this.editActDiag.dialog(t)},e.prototype.showEditActDiag=function(e){var t=this;document.getElementById("editActDiag.actName").innerHTML=e.getName(),this.editActDiag.dialog("open");var i=document.getElementById("editActDiag.parms"),s=i.firstChild;if(null!=s&&i.removeChild(s),"Sound"===e.getName()){e.getProperties().soundFile.values=this.vishva.getSoundFiles()}var n=this.formCreate(e.getProperties(),i.id);i.appendChild(n);var o={};o.text="save",o.click=function(s){return t.formRead(e.getProperties(),i.id),e.handlePropertiesChange(),t.updateSensActTbl(t.vishva.getActuators(),t.actTbl),t.editActDiag.dialog("close"),!0};var a=[o];this.editActDiag.dialog("option","buttons",a)},e.prototype.formCreate=function(e,t){t+=".";for(var i=document.createElement("table"),s=Object.keys(e),n=0;n<s.length;n++){var o=s[n];if(o.split("_")[0]!==this.STATE_IND){var a=i.insertRow(),r=a.insertCell();r.innerHTML=o,r=a.insertCell();var h=typeof e[o];if("object"===h&&"SelectType"===e[o].type){var l=e[o],u=l.values,c=document.createElement("select");c.id=t+o;for(var p=0;p<u.length;p++){var d=u[p],g=document.createElement("option");d===l.value&&(g.selected=!0),g.innerText=d,c.add(g)}r.appendChild(c)}else{var m=document.createElement("input");if(m.id=t+o,m.className="ui-widget-content ui-corner-all",m.value=e[o],"object"===h&&"Range"===e[o].type){var v=e[o];m.type="range",m.max=new Number(v.max).toString(),m.min=new Number(v.min).toString(),m.step=new Number(v.step).toString(),m.value=new Number(v.value).toString()}else if("string"===h||"number"===h)m.type="text",m.value=e[o];else if("boolean"===h){var f=e[o];m.type="checkbox",f&&m.setAttribute("checked","true")}r.appendChild(m)}}}return i},e.prototype.formRead=function(e,t){t+=".";for(var i=Object.keys(e),s=0;s<i.length;s++){var n=i[s];if(n.split("_")[0]!==this.STATE_IND){var o=typeof e[n];if("object"===o&&"SelectType"===e[n].type){var a=e[n],r=document.getElementById(t+n);a.value=r.value}else{var h=document.getElementById(t+n);if("object"===o&&"Range"===e[n].type){e[n].value=parseFloat(h.value)}else if("string"===o||"number"===o)if("number"===o){var l=parseFloat(h.value);isNaN(l)?e[n]=0:e[n]=l}else e[n]=h.value;else"boolean"===o&&(e[n]=h.checked)}}}},e.prototype.showPropDiag=function(){return!(null==this.propsDiag||!this.propsDiag.dialog("isOpen"))||(this.vishva.anyMeshSelected()?(null==this.propsDiag&&this.createPropsDiag(),this.propsDiag.dialog("open"),!0):void this.showAlertDiag("no mesh selected"))},e.prototype.closePropDiag=function(){this.propsDiag.dialog("close")},e.prototype.createPropsDiag=function(){var e=this,t=$("#propsAcc");t.accordion({animate:100,heightStyle:"content",collapsible:!0,activate:function(){e.activePanel=t.accordion("option","active")},beforeActivate:function(t,i){e.refreshPanel(e.getPanelIndex(i.newHeader))}}),this.propsDiag=$("#propsDiag");var i={autoOpen:!1,resizable:!1,position:this.leftCenter,minWidth:420,width:420,height:650,closeOnEscape:!1,open:function(i,s){e.fixingDragIssue?e.fixingDragIssue=!1:(e.activePanel=t.accordion("option","active"),e.refreshPanel(e.activePanel),e.refreshingPropsDiag=!1)},closeText:"",close:function(t,i){e.fixingDragIssue||e.refreshingPropsDiag||!0!==e.sNaDialog.dialog("isOpen")||e.sNaDialog.dialog("close")},dragStop:function(t,i){e.fixingDragIssue=!0,e.propsDiag.dialog("close"),e.propsDiag.dialog("open")}};this.propsDiag.dialog(i),this.propsDiag.jpo=this.leftCenter,this.dialogs.push(this.propsDiag)},e.prototype.closePropsDiag=function(){null!=this._itemsDiag&&!0===this._itemsDiag.dialog("isOpen")&&this._clearPrevItem(),null!=this.propsDiag&&this.propsDiag.dialog("close")},e.prototype.refreshPropsDiag=function(){void 0!==this.propsDiag&&null!==this.propsDiag&&!0===this.propsDiag.dialog("isOpen")&&(this.refreshingPropsDiag=!0,this.propsDiag.dialog("close"),this.propsDiag.dialog("open"))},e.prototype.refreshGeneralPanel=function(){0===this.activePanel&&this.refreshPropsDiag()},e.prototype.getPanelIndex=function(e){return"General"==e.text()?0:"Physics"==e.text()?1:"Material"==e.text()?2:"Lights"==e.text()?3:"Animations"==e.text()?4:void 0},e.prototype.refreshPanel=function(e){0===e?this.updateGeneral():3===e?this.updateLight():4===e?this.updateAnimations():1===e?this.updatePhysics():2===e&&this.updateMat(),!0===this.sNaDialog.dialog("isOpen")&&(this.sNaDialog.dialog("close"),this.show_sNaDiag())},e.prototype.initAnimUI=function(){var e=this;this.animUIInitialized=!0;var t=document.getElementById("animSkelChange"),i=document.getElementById("animSkelClone"),s=document.getElementById("animSkelView"),n=document.getElementById("animRest"),o=document.getElementById("animRangeName"),a=document.getElementById("animRangeStart"),r=document.getElementById("animRangeEnd"),h=document.getElementById("animRangeMake");this.animSkelList=document.getElementById("animSkelList"),t.onclick=function(t){e.vishva.changeSkeleton(e.animSkelList.selectedOptions[0].value)?e.updateAnimations():e.showAlertDiag("Error: unable to switch")},i.onclick=function(t){e.vishva.cloneChangeSkeleton(e.animSkelList.selectedOptions[0].value)?e.updateAnimations():e.showAlertDiag("Error: unable to clone and switch")},s.onclick=function(t){e.vishva.toggleSkelView()},n.onclick=function(t){e.vishva.animRest()},h.onclick=function(t){var i=o.value,s=parseInt(a.value);isNaN(s)&&e.showAlertDiag("from frame is not a number");var n=parseInt(r.value);isNaN(n)&&e.showAlertDiag("to frame is not a number"),e.vishva.createAnimRange(i,s,n),e.refreshAnimSelect()},this.animSelect=document.getElementById("animList"),this.animSelect.onchange=function(t){var i=e.animSelect.value;if(null!=i){var s=e.skel.getAnimationRange(i);document.getElementById("animFrom").innerText=new Number(s.from).toString(),document.getElementById("animTo").innerText=new Number(s.to).toString()}return!0},this.animRate=document.getElementById("animRate"),this.animLoop=document.getElementById("animLoop"),document.getElementById("playAnim").onclick=function(t){if(null==e.skel)return!0;var i=e.animSelect.value,s=e.animRate.value;return null!=i&&e.vishva.playAnimation(i,s,e.animLoop.checked),!0},document.getElementById("stopAnim").onclick=function(t){return null==e.skel||(e.vishva.stopAnimation(),!0)}},e.prototype.updateAnimations=function(){this.animUIInitialized||this.initAnimUI(),this.skel=this.vishva.getSkeleton();var e;null==this.skel?e="NO SKELETON":(e=this.skel.name.trim(),""===e&&(e="NO NAME"),e=e+" ("+this.skel.id+")"),document.getElementById("skelName").innerText=e,this.refreshAnimSelect(),this.refreshAnimSkelList()},e.prototype.refreshAnimSelect=function(){for(var e=this.animSelect.children,t=0|e.length,i=t-1;i>=0;i--)e[i].remove();var s=this.vishva.getAnimationRanges();if(null!=s){for(var n,o=0,a=s;o<a.length;o++){var r=a[o];n=document.createElement("option"),n.value=r.name,n.innerText=r.name,this.animSelect.appendChild(n)}null!=s[0]?(document.getElementById("animFrom").innerText=new Number(s[0].from).toString(),document.getElementById("animTo").innerText=new Number(s[0].to).toString()):(document.getElementById("animFrom").innerText="",document.getElementById("animTo").innerText="")}else document.getElementById("animFrom").innerText="",document.getElementById("animTo").innerText=""},e.prototype.refreshAnimSkelList=function(){for(var e=this.animSkelList.children,t=0|e.length,i=t-1;i>=0;i--)e[i].remove();for(var s,n=this.vishva.getSkeltons(),o=0,a=n;o<a.length;o++){var r=a[o];s=document.createElement("option"),s.value=r.id+"-"+r.name,s.innerText=r.name+" ("+r.id+")",this.animSkelList.appendChild(s)}},e.prototype.toString=function(e){return new Number(e).toFixed(2).toString()},e.prototype.initGeneral=function(){var e=this;this.genName=document.getElementById("genName"),this.genName.onchange=function(){e.vishva.setName(e.genName.value)},this.genSpace=document.getElementById("genSpace"),this.genSpace.onchange=function(){var t=e.vishva.setSpace(e.genSpace.value);null!==t&&(e.showAlertDiag(t),e.genSpace.value=e.vishva.getSpace())},void 0===this.transRefresh&&(this.transRefresh=document.getElementById("transRefresh"),this.transRefresh.onclick=function(){return e.updateTransform(),!1}),void 0===this.transBake&&(this.transBake=document.getElementById("transBake"),this.transBake.onclick=function(){return e.vishva.bakeTransforms(),e.updateTransform(),!1}),this.genOperTrans=document.getElementById("operTrans"),this.genOperRot=document.getElementById("operRot"),this.genOperScale=document.getElementById("operScale"),this.genOperFocus=document.getElementById("operFocus"),this.genOperTrans.onclick=function(){e.vishva.setTransOn()},this.genOperRot.onclick=function(){e.vishva.setRotOn()},this.genOperScale.onclick=function(){e.vishva.setScaleOn(),e.vishva.isSpaceLocal()||e.showAlertDiag("note that scaling doesnot work with global axis")},this.genOperFocus.onclick=function(){e.vishva.setFocusOnMesh()},this.genLocX=document.getElementById("loc.x"),this.genLocX.onchange=function(){e.vishva.setLocation(Number(e.genLocX.value),Number(e.genLocY.value),Number(e.genLocZ.value))},this.genLocY=document.getElementById("loc.y"),this.genLocY.onchange=function(){e.vishva.setLocation(Number(e.genLocX.value),Number(e.genLocY.value),Number(e.genLocZ.value))},this.genLocZ=document.getElementById("loc.z"),this.genLocZ.onchange=function(){e.vishva.setLocation(Number(e.genLocX.value),Number(e.genLocY.value),Number(e.genLocZ.value))},this.genRotX=document.getElementById("rot.x"),this.genRotX.onchange=function(){e.vishva.setRotation(Number(e.genRotX.value),Number(e.genRotY.value),Number(e.genRotZ.value))},this.genRotY=document.getElementById("rot.y"),this.genRotY.onchange=function(){e.vishva.setRotation(Number(e.genRotX.value),Number(e.genRotY.value),Number(e.genRotZ.value))},this.genRotZ=document.getElementById("rot.z"),this.genRotZ.onchange=function(){e.vishva.setRotation(Number(e.genRotX.value),Number(e.genRotY.value),Number(e.genRotZ.value))},this.genScaleX=document.getElementById("scl.x"),this.genScaleX.onchange=function(){e.vishva.setScale(Number(e.genScaleX.value),Number(e.genScaleY.value),Number(e.genScaleZ.value))},this.genScaleY=document.getElementById("scl.y"),this.genScaleY.onchange=function(){e.vishva.setScale(Number(e.genScaleX.value),Number(e.genScaleY.value),Number(e.genScaleZ.value))},this.genScaleZ=document.getElementById("scl.z"),this.genScaleZ.onchange=function(){e.vishva.setScale(Number(e.genScaleX.value),Number(e.genScaleY.value),Number(e.genScaleZ.value))},this.genSnapTrans=document.getElementById("snapTrans"),this.genSnapTrans.onchange=function(){var t=e.vishva.snapTrans(e.genSnapTrans.checked);null!=t&&(e.showAlertDiag(t),e.genSnapTrans.checked=!1)},this.genSnapRot=document.getElementById("snapRot"),this.genSnapRot.onchange=function(){var t=e.vishva.snapRot(e.genSnapRot.checked);null!=t&&(e.showAlertDiag(t),e.genSnapRot.checked=!1)},this.genSnapScale=document.getElementById("snapScale"),this.genSnapScale.onchange=function(){var t=e.vishva.snapScale(e.genSnapScale.checked);null!=t&&(e.showAlertDiag(t),e.genSnapScale.checked=!1)},this.genSnapTransValue=document.getElementById("snapTransValue"),this.genSnapTransValue.onchange=function(){e.vishva.setSnapTransValue(Number(e.genSnapTransValue.value))},this.genSnapRotValue=document.getElementById("snapRotValue"),this.genSnapRotValue.onchange=function(){e.vishva.setSnapRotValue(Number(e.genSnapRotValue.value))},this.genSnapScaleValue=document.getElementById("snapScaleValue"),this.genSnapScaleValue.onchange=function(){e.vishva.setSnapScaleValue(Number(e.genSnapScaleValue.value))},this.genDisable=document.getElementById("genDisable"),this.genDisable.onchange=function(){e.vishva.disableIt(e.genDisable.checked)},this.genColl=document.getElementById("genColl"),this.genColl.onchange=function(){e.vishva.enableCollision(e.genColl.checked)},this.genVisi=document.getElementById("genVisi"),this.genVisi.onchange=function(){e.vishva.makeVisibile(e.genVisi.checked)};var t=document.getElementById("undo"),i=document.getElementById("redo"),s=document.getElementById("parentMesh"),n=document.getElementById("removeParent"),o=document.getElementById("removeChildren"),a=document.getElementById("cloneMesh"),r=document.getElementById("instMesh"),h=document.getElementById("mergeMesh"),l=document.getElementById("subMesh"),u=document.getElementById("interMesh"),c=document.getElementById("downMesh"),p=document.getElementById("delMesh"),d=document.getElementById("swAv"),g=document.getElementById("swGnd"),m=document.getElementById("sNa");t.onclick=function(t){return e.vishva.undo(),!1},i.onclick=function(t){return e.vishva.redo(),!1},s.onclick=function(t){var i=e.vishva.makeParent();return null!=i&&e.showAlertDiag(i),!1},n.onclick=function(t){var i=e.vishva.removeParent();return null!=i&&e.showAlertDiag(i),!1},o.onclick=function(t){var i=e.vishva.removeChildren();return null!=i&&e.showAlertDiag(i),!1},a.onclick=function(t){var i=e.vishva.clone_mesh();return null!=i&&e.showAlertDiag(i),!1},r.onclick=function(t){var i=e.vishva.instance_mesh();return null!=i&&e.showAlertDiag(i),!1},h.onclick=function(t){var i=e.vishva.mergeMeshes();return null!=i&&e.showAlertDiag(i),!1},l.onclick=function(t){var i=e.vishva.csgOperation("subtract");return null!=i&&e.showAlertDiag(i),!1},u.onclick=function(t){var i=e.vishva.csgOperation("intersect");return null!=i&&e.showAlertDiag(i),!1},c.onclick=function(t){var i=e.vishva.saveAsset();return null==i?(e.showAlertDiag("No Mesh Selected"),!0):(e.downloadLink.href=i,$("#saveDiv").dialog("open"),!1)},p.onclick=function(t){var i=e.vishva.delete_mesh();return null!=i&&e.showAlertDiag(i),!1},d.onclick=function(t){var i=e.vishva.switchAvatar();return null!=i&&e.showAlertDiag(i),!0},g.onclick=function(t){var i=e.vishva.switchGround();return null!=i&&e.showAlertDiag(i),!0},m.onclick=function(t){return e.show_sNaDiag(),!0}},e.prototype.updateGeneral=function(){void 0===this.genName&&this.initGeneral(),this.genName.value=this.vishva.getName(),this.genSpace.value=this.vishva.getSpace(),this.updateTransform(),this.genDisable.checked=this.vishva.isDisabled(),this.genColl.checked=this.vishva.isCollideable(),this.genVisi.checked=this.vishva.isVisible()},e.prototype.updateTransform=function(){var e=this.vishva.getLocation(),t=this.vishva.getRotation(),i=this.vishva.getScale();document.getElementById("loc.x").value=this.toString(e.x),document.getElementById("loc.y").value=this.toString(e.y),document.getElementById("loc.z").value=this.toString(e.z),document.getElementById("rot.x").value=this.toString(t.x),document.getElementById("rot.y").value=this.toString(t.y),document.getElementById("rot.z").value=this.toString(t.z),document.getElementById("scl.x").value=this.toString(i.x),document.getElementById("scl.y").value=this.toString(i.y),document.getElementById("scl.z").value=this.toString(i.z)},e.prototype.initLightUI=function(){var e=this;this.lightAtt=document.getElementById("lightAtt"),this.lightType=document.getElementById("lightType"),this.lightDiff=new s("diffuse light","lightDiff","#ffffff",this.centerBottom,function(t,i,s){e.applyLight()}),this.lightSpec=new s("specular light","lightSpec","#ffffff",this.centerBottom,function(t,i,s){e.applyLight()}),this.lightInten=document.getElementById("lightInten"),this.lightRange=document.getElementById("lightRange"),this.lightRadius=document.getElementById("lightAtt"),this.lightAngle=document.getElementById("lightAngle"),this.lightExp=document.getElementById("lightExp"),this.lightGndClr=document.getElementById("lightGndClr"),this.lightDirX=document.getElementById("lightDirX"),this.lightDirY=document.getElementById("lightDirY"),this.lightDirZ=document.getElementById("lightDirZ"),this.lightAtt.onchange=function(){e.lightAtt.checked?e.applyLight():e.vishva.detachLight()},this.lightType.onchange=function(){return e.applyLight()},this.lightInten.onchange=function(){return e.applyLight()},this.lightRange.onchange=function(){return e.applyLight()},this.lightAngle.onchange=function(){return e.applyLight()},this.lightExp.onchange=function(){return e.applyLight()},this.lightDirX.onchange=function(){return e.applyLight()},this.lightDirY.onchange=function(){return e.applyLight()},this.lightDirZ.onchange=function(){return e.applyLight()}},e.prototype.updateLight=function(){void 0===this.lightAtt&&this.initLightUI();var e=this.vishva.getAttachedLight();null===e?(this.lightAtt.checked=!1,e=new t.LightParm):this.lightAtt.checked=!0,this.lightType.value=e.type,this.lightDiff.setColor(e.diffuse.toHexString()),this.lightSpec.setColor(e.specular.toHexString()),this.lightInten.value=Number(e.intensity).toString(),this.lightRange.value=Number(e.range).toString(),this.lightRadius.value=Number(e.radius).toString(),this.lightAngle.value=Number(e.angle).toString(),this.lightExp.value=Number(e.exponent).toString(),this.lightGndClr.value=e.gndClr.toHexString(),this.lightDirX.value=Number(e.direction.x).toString(),this.lightDirY.value=Number(e.direction.y).toString(),this.lightDirZ.value=Number(e.direction.z).toString()},e.prototype.applyLight=function(){if(this.lightAtt.checked){var e=new t.LightParm;e.type=this.lightType.value,e.diffuse=BABYLON.Color3.FromHexString(this.lightDiff.getColor()),
e.specular=BABYLON.Color3.FromHexString(this.lightSpec.getColor()),e.intensity=parseFloat(this.lightInten.value),e.range=parseFloat(this.lightRange.value),e.radius=parseFloat(this.lightRadius.value),e.angle=parseFloat(this.lightAngle.value),e.direction.x=parseFloat(this.lightDirX.value),e.direction.y=parseFloat(this.lightDirY.value),e.direction.z=parseFloat(this.lightDirZ.value),e.exponent=parseFloat(this.lightExp.value),e.gndClr=BABYLON.Color3.FromHexString(this.lightGndClr.value),this.vishva.attachAlight(e)}},e.prototype.initMatUI=function(){var e=this;this.matName=document.getElementById("matName"),this.matName.innerText=this.vishva.getMaterialName(),this.matVisVal=document.getElementById("matVisVal"),this.matVis=document.getElementById("matVis"),this.matColType=document.getElementById("matColType"),this.matColType.onchange=function(){var t=e.vishva.getMeshColor(e.matColType.value);e.matColDiag.setColor(t)},this.matTextType=document.getElementById("matTextType"),this.matColDiag=new s("mesh color","matCol",this.vishva.getMeshColor(this.matColType.value),this.centerBottom,function(t,i,s){var n=e.vishva.setMeshColor(e.matColType.value,t);null!==n&&e.showAlertDiag(n)}),this.matVisVal.value="1.00",this.matVis.oninput=function(){e.matVisVal.value=Number(e.matVis.value).toFixed(2),e.vishva.setMeshVisibility(parseFloat(e.matVis.value))},this.matTexture=document.getElementById("matTexture"),this.matTexture.onclick=function(){console.log("checking texture"),null==e.textureDiag&&e.createTextureDiag(),e.textureImg.src=e.vishva.getMatTexture(e.matTextType.value),console.log(e.textureImg.src),e.textureDiag.dialog("open")}},e.prototype.updateMat=function(){void 0==this.matVis&&this.initMatUI(),this.matVis.value=Number(this.vishva.getMeshVisibility()).toString(),this.matVisVal.value=Number(this.matVis.value).toFixed(2),this.matColDiag.setColor(this.vishva.getMeshColor(this.matColType.value))},e.prototype.initPhyUI=function(){var e=this;this.phyEna=document.getElementById("phyEna"),this.phyType=document.getElementById("phyType"),this.phyMass=document.getElementById("phyMass"),this.phyRes=document.getElementById("phyRes"),this.phyResVal=document.getElementById("phyResVal"),this.phyResVal.value="0.0",this.phyRes.oninput=function(){e.phyResVal.value=e.formatValue(e.phyRes.value)},this.phyFric=document.getElementById("phyFric"),this.phyFricVal=document.getElementById("phyFricVal"),this.phyFricVal.value="0.0",this.phyFric.oninput=function(){e.phyFricVal.value=e.formatValue(e.phyFric.value)};var t=document.getElementById("phyApply"),i=document.getElementById("phyTest"),s=document.getElementById("phyReset");t.onclick=function(t){return e.applyPhysics(),e.showAlertDiag("physics applied"),!1},i.onclick=function(t){return e.testPhysics(),!1},s.onclick=function(t){return e.resetPhysics(),!1}},e.prototype.formatValue=function(e){return"1"===e?"1.0":"0"===e?"0.0":e},e.prototype.updatePhysics=function(){void 0===this.phyEna&&this.initPhyUI();var e=this.vishva.getMeshPickedPhyParms();null!==e?(this.phyEna.setAttribute("checked","true"),this.phyType.value=Number(e.type).toString(),this.phyMass.value=Number(e.mass).toString(),this.phyRes.value=Number(e.restitution).toString(),this.phyResVal.value=this.formatValue(this.phyRes.value),this.phyFric.value=Number(e.friction).toString(),this.phyFricVal.value=this.formatValue(this.phyFric.value)):(this.phyEna.checked=!1,this.phyType.value="2",this.phyMass.value="1",this.phyRes.value="0",this.phyResVal.value="0.0",this.phyFric.value="0",this.phyFricVal.value="0.0")},e.prototype.applyPhysics=function(){var e;this.phyEna.checked?(e=new t.PhysicsParm,e.type=parseInt(this.phyType.value),e.mass=parseFloat(this.phyMass.value),e.restitution=parseFloat(this.phyRes.value),e.friction=parseFloat(this.phyFric.value)):e=null,this.vishva.setMeshPickedPhyParms(e)},e.prototype.testPhysics=function(){var e;e=new t.PhysicsParm,e.type=parseInt(this.phyType.value),e.mass=parseFloat(this.phyMass.value),e.restitution=parseFloat(this.phyRes.value),e.friction=parseFloat(this.phyFric.value),this.vishva.testPhysics(e)},e.prototype.resetPhysics=function(){this.vishva.resetPhysics()},e.prototype.createAlertDiag=function(){this.alertDiv=document.getElementById("alertDiv"),this.alertDialog=$("#alertDiv");var e={title:"Info",autoOpen:!1,width:"auto",minWidth:200,height:"auto",closeText:"",closeOnEscape:!1};this.alertDialog.dialog(e)},e.prototype.showAlertDiag=function(e){this.alertDiv.innerHTML="<h3>"+e+"</h3>",this.alertDialog.dialog("open")},e.prototype.sliderOptions=function(e,t,i){var s=this,n={};return n.min=e,n.max=t,n.value=i,n.slide=function(e,t){return s.handleSlide(e,t)},n},e.prototype.handleSlide=function(e,t){var i=e.target.id;if("fov"===i)this.vishva.setFov(t.value);else if("sunPos"===i)this.vishva.setSunPos(t.value);else{var s=t.value/100;"light"===i?this.vishva.setLight(s):"shade"===i?this.vishva.setShade(s):"fog"===i&&(console.log(s),this.vishva.setFog(s/100))}return!0},e.prototype.createNavMenu=function(){var e=this,t=document.getElementById("showNavMenu");t.style.visibility="visible",document.getElementById("navMenubar").style.visibility="visible";var i=$("#navMenubar"),s={my:"left center",at:"right center",of:t};i.position(s),i.show(null),t.onclick=function(t){return e.menuBarOn?i.hide("slide",100):i.show("slide",100),e.menuBarOn=!e.menuBarOn,!0};var n=JSON.parse('{"direction":"up"}'),o=document.getElementById("navAdd"),a=$("#AddMenu");a.menu(),a.hide(null),o.onclick=function(t){if(e.firstTime){var i={my:"left top",at:"left bottom",of:o};a.menu().position(i),e.firstTime=!1}return e.addMenuOn?a.menu().hide("slide",n,100):a.show("slide",n,100),e.addMenuOn=!e.addMenuOn,$(document).one("click",function(t){return e.addMenuOn&&(a.menu().hide("slide",n,100),e.addMenuOn=!1),!0}),t.cancelBubble=!0,!0},document.getElementById("downWorld").onclick=function(t){var i=e.vishva.saveWorld();return null==i||(e.downloadLink.href=i,e.downloadDialog.dialog("open"),!1)},document.getElementById("navItems").onclick=function(t){return void 0==e._itemsDiag&&e._createItemsDiag(),!1===e._itemsDiag.dialog("isOpen")&&e._updateItemsTable(),e.toggleDiag(e._itemsDiag),!1},document.getElementById("navEnv").onclick=function(t){return void 0==e.envDiag&&e.createEnvDiag(),e.toggleDiag(e.envDiag),!1},document.getElementById("navEdit").onclick=function(t){return null!=e.propsDiag&&!0===e.propsDiag.dialog("isOpen")?e.closePropDiag():e.showPropDiag(),!0},document.getElementById("navSettings").onclick=function(t){return void 0==e.settingDiag&&e.createSettingDiag(),!1===e.settingDiag.dialog("isOpen")?(e.updateSettings(),e.settingDiag.dialog("open")):e.settingDiag.dialog("close"),!1},document.getElementById("helpLink").onclick=function(t){return e.toggleDiag(e.helpDiag),!0},document.getElementById("debugLink").onclick=function(t){return e.vishva.toggleDebug(),!0}},e.prototype.toggleDiag=function(e){!1===e.dialog("isOpen")?e.dialog("open"):e.dialog("close")},e.prototype.getSettings=function(){var e=new o;return e.enableToolTips=this.enableToolTips,e},e.prototype.setSettings=function(){var e=this.vishva.getGuiSettings();null!==e&&(this.enableToolTips=e.enableToolTips)},e.LARGE_ICON_SIZE="width:128px;height:128px;",e.SMALL_ICON_SIZE="width:64px;height:64px;",e}();i.VishvaGUI=n;var o=function(){function e(){}return e}();i.GuiSettings=o;var a=function(){function e(){this.r=0,this.g=0,this.b=0}return e}();i.RGB=a;var r=function(){function e(e,t,i,s){this.type="Range",this.min=0,this.max=0,this.value=0,this.step=0,this.min=e,this.max=t,this.value=i,this.step=s}return e}();i.Range=r;var h=function(){function e(){this.type="SelectType"}return e}();i.SelectType=h}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){this.names=new Array,this.values=new Array;var e=window.location.search;e=e.substring(1);for(var t=e.split("&"),i=0;i<t.length;i++){var s=t[i],n=s.split("=");if(2===n.length){var o=n[0],a=n[1];this.names.push(o),this.values.push(a)}}}return e.prototype.getParm=function(e){var t=this.names.indexOf(e);return-1!==t?this.values[t]:null},e}();e.HREFsearch=t}(e.util||(e.util={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(t){!function(t){!function(t){var i=e.ssatguru.babylonjs.component.EditControl,s=e.ssatguru.babylonjs.component.CharacterController,n=BABYLON.Animation,o=BABYLON.ArcRotateCamera,a=BABYLON.AssetsManager,r=BABYLON.Color3,h=BABYLON.Color4,l=BABYLON.CubeTexture,u=BABYLON.CSG,c=BABYLON.DirectionalLight,p=BABYLON.DynamicTerrain,d=BABYLON.Engine,g=BABYLON.HemisphericLight,m=BABYLON.Light,v=BABYLON.Matrix,f=BABYLON.Mesh,y=BABYLON.MeshBuilder,S=BABYLON.ParticleSystem,b=BABYLON.PhysicsImpostor,k=BABYLON.Quaternion,A=BABYLON.Scene,P=BABYLON.SceneLoader,w=BABYLON.SceneSerializer,C=BABYLON.ShadowGenerator,T=BABYLON.Debug.SkeletonViewer,M=BABYLON.StandardMaterial,x=BABYLON.Tags,B=BABYLON.Texture,I=BABYLON.Vector3,N=e.ssatguru.babylonjs.vishva.gui.VishvaGUI,E=BABYLON.WaterMaterial,D=function(){function e(e,t,i,s,n){var o=this;if(this.actuator="none",this.snapTransOn=!1,this.snapRotOn=!1,this.snapScaleOn=!1,this.snapperOn=!1,this.snapTransValue=.5,this.snapRotValue=Math.PI/4,this.snapScaleValue=.5,this.ow=.01,this.spaceWorld=!1,this.skyboxTextures="vishva/internal/textures/skybox-default/default",this.avatarFolder="vishva/internal/avatar/",this.avatarFile="starterAvatars.babylon",this.groundTexture="vishva/internal/textures/ground.jpg",this.groundBumpTexture="vishva/internal/textures/ground-normal.jpg",this.groundHeightMap="vishva/internal/textures/ground_heightMap.png",this.terrainTexture="vishva/internal/textures/earth.jpg",this.terrainHeightMap="vishva/internal/textures/worldHeightMap.jpg",this.primTexture="vishva/internal/textures/Birch.jpg",this.waterTexture="vishva/internal/textures/waterbump.png",this.snowTexture="vishva/internal/textures/flare.png",this.rainTexture="vishva/internal/textures/raindrop-1.png",this.snowPart=null,this.snowing=!1,this.rainPart=null,this.raining=!1,this.SOUND_ASSET_LOCATION="vishva/assets/sounds/",this.RELATIVE_ASSET_LOCATION="",this.switchDisabled=!1,this.keysDisabled=!1,this.showBoundingBox=!1,this.cameraCollision=!0,this.autoEditMenu=!0,this.enablePhysics=!0,this.vishvaSerialized=null,this.isFocusOnAv=!0,this.cameraAnimating=!1,this.moveLimitStart=114,this.moveLimitEnd=124,this.oldAvPos=new I(0,0,0),this.fogDensity=0,this.meshesPicked=null,this.isMeshSelected=!1,this.cameraTargetPos=new I(0,0,0),this.saveAVcameraPos=new I(0,0,0),this.animFunc=function(){return o.animateCamera()},this.animFunc2=function(){return o.justReFocus()},this.showingAllInvisibles=!1,this.meshPickedPhyParms=null,this.didPhysTest=!1,this.skelViewerArr=[],this.debugVisible=!1,this.spawnPosition=new I(0,.2,0),this.editEnabled=!1,this.frames=0,this.f=0,!d.isSupported())return void alert("not supported");this.loadingMsg=document.getElementById("loadingMsg"),this.loadingMsg.style.visibility="visible",this.loadingStatus=document.getElementById("loadingStatus"),this.editEnabled=i,this.assets=s,this.key=new O,this.canvas=document.getElementById(n),this.engine=new d(this.canvas,!0),this.scene=new A(this.engine),this.scene.enablePhysics(),this.scene.clearColor=new h(0,0,0,1),this.scene.ambientColor=new r(1,1,1),this.scene.fogColor=new BABYLON.Color3(.9,.9,.85),window.addEventListener("resize",function(e){return o.onWindowResize(e)}),window.addEventListener("keydown",function(e){return o.onKeyDown(e)},!1),window.addEventListener("keyup",function(e){return o.onKeyUp(e)},!1),P.CleanBoneMatrixWeights=!0,this.scenePath=t,"empty"==e?this.onSceneLoaded(this.scene):(this.loadingStatus.innerHTML="downloading world",this.loadSceneFile(t,e+".js",this.scene))}return e.prototype.loadSceneFile=function(e,t,i){var s=this,n=new a(i),o=n.addTextFileTask("sceneLoader",e+t);o.onSuccess=function(e){return s.onTaskSuccess(e)},o.onError=function(e){return s.onTaskFailure(e)},n.load()},e.prototype.getGuiSettings=function(){return null!==this.vishvaSerialized?this.vishvaSerialized.guiSettings:null},e.prototype.onTaskSuccess=function(e){var t=this,i=e,s=JSON.parse(i.text);this.vishvaSerialized=s.VishvaSerialized,this.snas=this.vishvaSerialized.snas,this.cameraCollision=this.vishvaSerialized.settings.cameraCollision,this.autoEditMenu=this.vishvaSerialized.settings.autoEditMenu;var n="data:"+i.text;P.ShowLoadingScreen=!1,this.loadingStatus.innerHTML="loading scene",P.Append("",n,this.scene,function(e){return t.onSceneLoaded(e)})},e.prototype.onTaskFailure=function(e){alert("scene load failed")},e.prototype.setShadowProperty=function(e,t){t.useBlurExponentialShadowMap=!0,t.bias=-.3},e.prototype.onSceneLoaded=function(e){var i=this;this.loadingStatus.innerHTML="checking assets";for(var n=!1,o=!1,a=!1,h=!1,l=!1,u=!1,p=0,d=e.meshes;p<d.length;p++){var m=d[p];m.receiveShadows=!1,x.HasTags(m)&&(x.MatchesQuery(m,"Vishva.avatar")?(n=!0,this.avatar=m,this.avatar.ellipsoidOffset=new I(0,1,0)):x.MatchesQuery(m,"Vishva.sky")?(l=!0,this.skybox=m,this.skybox.isPickable=!1):x.MatchesQuery(m,"Vishva.ground")&&(h=!0,this.ground=m))}for(var v=0,f=e.skeletons;v<f.length;v++){var y=f[v];(x.MatchesQuery(y,"Vishva.skeleton")||"Vishva.skeleton"===y.name)&&(o=!0,this.avatarSkeleton=y)}o||console.error("ALARM: No Skeleton found");for(var S=0,b=e.lights;S<b.length;S++){var k=b[S];x.MatchesQuery(k,"Vishva.sun")&&(a=!0,this.sun=k)}if(a)for(var P=0,w=e.lights;P<w.length;P++){var k=w[P];if("Vishva.dl01"===k.id){this.sunDR=k,this.shadowGenerator=k.getShadowGenerator();var T=this.sunDR;this.setShadowProperty(T,this.shadowGenerator)}}else{console.log("no vishva sun found. creating sun"),this.sun=new g("Vishva.hl01",new I(1,1,0),this.scene),this.sun.groundColor=new r(.5,.5,.5),x.AddTagsTo(this.sun,"Vishva.sun"),this.sunDR=new c("Vishva.dl01",new I(-1,-1,0),this.scene),this.sunDR.position=new I(0,1048,0);var T=this.sunDR;this.shadowGenerator=new C(1024,T),this.setShadowProperty(T,this.shadowGenerator)}for(var M=0,B=e.meshes;M<B.length;M++){var m=B[M];null!=m&&m instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(m)}for(var N=0,E=e.cameras;N<E.length;N++){var D=E[N];x.MatchesQuery(D,"Vishva.camera")&&(u=!0,this.mainCamera=D,this.setCameraSettings(this.mainCamera),this.mainCamera.attachControl(this.canvas,!0))}u||(console.log("no vishva camera found. creating camera"),this.mainCamera=this.createCamera(this.scene,this.canvas),this.scene.activeCamera=this.mainCamera),this.mainCamera.checkCollisions=!0,this.mainCamera.collisionRadius=new I(.5,.5,.5),h?this.ground.receiveShadows=!0:(console.log("no vishva ground found. creating ground"),this.ground=this.createGround(this.scene)),l||(console.log("no vishva sky found. creating sky"),this.skybox=this.createSkyBox(this.scene),this.setLight(.5)),this.scene.fogMode!==A.FOGMODE_EXP&&(this.scene.fogMode=A.FOGMODE_EXP,this.scene.fogDensity=0),this.editEnabled&&(this.scene.onPointerDown=function(e,t){return i.pickObject(e,t)}),n?(this.avatarSkeleton.enableBlending(.1),this.cc=new s(this.avatar,this.mainCamera,this.scene),this.setCharacterController(this.cc),this.cc.start()):(console.log("no vishva av found. creating av"),this.createAvatar()),t.SNAManager.getSNAManager().unMarshal(this.snas,this.scene),this.snas=null,this.render()},e.prototype.render=function(){var e=this;this.scene.registerBeforeRender(function(){return e.process()}),this.scene.executeWhenReady(function(){return e.startRenderLoop()})},e.prototype.startRenderLoop=function(){var e=this;this.editEnabled?this.vishvaGUI=new N(this):this.vishvaGUI=null,this.engine.hideLoadingUI(),this.loadingMsg.style.visibility="hidden",this.engine.runRenderLoop(function(){return e.scene.render()})},e.prototype.process=function(){if(this.sunDR.position.x=this.avatar.position.x+100,this.sunDR.position.y=this.avatar.position.y+100,this.sunDR.position.z=this.avatar.position.z+0,!this.cameraAnimating){if(this.keysDisabled&&!this.key.esc)return void this.resetKeys();this.isFocusOnAv,this.isMeshSelected&&(this.key.focus&&this.setFocusOnMesh(),this.key.esc&&(this.key.esc=!1,this.removeEditControl()),this.key.trans&&this.setTransOn(),this.key.rot&&this.setRotOn(),this.key.scale&&this.setScaleOn()),this.isFocusOnAv?null==this.editControl||this.editControl.isEditing():(this.key.up||this.key.down||this.key.esc)&&(null==this.editControl?this.switchFocusToAV():this.editControl.isEditing()||this.switchFocusToAV()),this.key.esc&&this.multiUnSelectAll(),this.resetKeys()}},e.prototype.resetKeys=function(){this.key.focus=!1,this.key.esc=!1,this.key.trans=!1,this.key.rot=!1,this.key.scale=!1},e.prototype.pickObject=function(e,t){if(e.preventDefault(),2==e.button&&(this.key.alt||this.key.ctl)&&t.hit){if(this.key.ctl&&(!this.isMeshSelected||t.pickedMesh!==this.meshPicked))return void this.multiSelect(t.pickedMesh);if(this.isMeshSelected)if(t.pickedMesh===this.meshPicked){if(this.key.ctl)return;this.setFocusOnMesh()}else this.multiUnSelect(t.pickedMesh),this.switchEditControl(t.pickedMesh),this.snapperOn&&this.snapToGlobal();else this.selectForEdit(t.pickedMesh)}},e.prototype.selectForEdit=function(e){var s=this;this.multiUnSelect(e),this.isMeshSelected=!0,this.meshPicked=e,t.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl=new i(this.meshPicked,this.mainCamera,this.canvas,.75),this.editControl.addActionEndListener(function(e){s.vishvaGUI.refreshGeneralPanel()}),this.editControl.enableTranslation(),this.spaceWorld&&this.editControl.setLocal(!1),this.autoEditMenu&&this.vishvaGUI.showPropDiag(),this.snapperOn?this.setSnapperOn():(this.snapTransOn&&(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)),this.snapRotOn&&(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)),this.snapScaleOn&&(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)))},e.prototype.switchEditControl=function(e){if(!this.switchDisabled){t.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms();this.meshPicked;this.meshPicked=e,this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl.switchTo(this.meshPicked),t.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.vishvaGUI.refreshPropsDiag()}},e.prototype.switchToQuats=function(e){if(void 0===e.rotationQuaternion||null===e.rotationQuaternion){var t=e.rotation;e.rotationQuaternion=k.RotationYawPitchRoll(t.y,t.x,t.z)}},e.prototype.multiSelect_old=function(e,t){null==this.meshesPicked&&(this.meshesPicked=new Array);var i;null!=e&&((i=this.meshesPicked.indexOf(e))>=0||(this.meshesPicked.push(e),e.renderOutline=!0,e.outlineWidth=this.ow)),i=this.meshesPicked.indexOf(t),i>=0?(this.meshesPicked.splice(i,1),this.meshPicked.renderOutline=!1):(this.meshesPicked.push(t),t.renderOutline=!0,t.outlineWidth=this.ow)},e.prototype.multiSelect=function(e){null==this.meshesPicked&&(this.meshesPicked=new Array),this.multiUnSelect(e)||(this.meshesPicked.push(e),e.renderOutline=!0,e.outlineWidth=this.ow)},e.prototype.multiUnSelect=function(e){if(null==this.meshesPicked)return!1;var t=this.meshesPicked.indexOf(e);return t>=0&&(this.meshesPicked.splice(t,1),e.renderOutline=!1,!0)},e.prototype.multiUnSelectAll=function(){if(null!==this.meshesPicked){for(var e=0,t=this.meshesPicked;e<t.length;e++){t[e].renderOutline=!1}this.meshesPicked=null}},e.prototype.removeEditControl=function(){this.multiUnSelectAll(),this.isMeshSelected=!1,this.editControl.detach(),this.editControl=null,this.autoEditMenu&&this.vishvaGUI.closePropDiag(),this.vishvaGUI.closePropsDiag(),null!=this.meshPicked&&(t.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms())},e.prototype.switchFocusToAV=function(){this.mainCamera.detachControl(this.canvas),this.frames=25,this.f=this.frames,this.delta=this.saveAVcameraPos.subtract(this.mainCamera.position).scale(1/this.frames);var e=new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z);this.delta2=e.subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc)},e.prototype.focusOnMesh=function(e,t){this.mainCamera.detachControl(this.canvas),this.frames=t,this.f=t,this.delta2=e.getAbsolutePivotPoint().subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc2)},e.prototype.animateCamera=function(){new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z).subtract(this.mainCamera.target).length()>.01&&this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),this.saveAVcameraPos.subtract(this.mainCamera.position).length()>.01&&this.mainCamera.setPosition(this.mainCamera.position.add(this.delta)),--this.f<0&&(this.isFocusOnAv=!0,this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc),this.mainCamera.attachControl(this.canvas),this.cc.start())},e.prototype.justReFocus=function(){this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),--this.f<0&&(this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc2),this.mainCamera.attachControl(this.canvas))},e.prototype.onWindowResize=function(e){this.engine.resize()},e.prototype.onKeyDown=function(e){var t=e;16===t.keyCode&&(this.key.shift=!0),17===t.keyCode&&(this.key.ctl=!0),18===t.keyCode&&(this.key.alt=!0),27===t.keyCode&&(this.key.esc=!1);var i=String.fromCharCode(t.keyCode);"W"!==i&&38!==t.keyCode||(this.key.up=!0),"S"!==i&&40!==t.keyCode||(this.key.down=!0),"1"===i&&(this.key.trans=!1),"2"===i&&(this.key.rot=!1),"3"===i&&(this.key.scale=!1),"F"===i&&(this.key.focus=!1)},e.prototype.onKeyUp=function(e){var t=e;16===t.keyCode&&(this.key.shift=!1),17===t.keyCode&&(this.key.ctl=!1),18===t.keyCode&&(this.key.alt=!1),27===t.keyCode&&(this.key.esc=!0);var i=String.fromCharCode(t.keyCode);"W"!==i&&38!==t.keyCode||(this.key.up=!1),"S"!==i&&40!==t.keyCode||(this.key.down=!1),"1"===i&&(this.key.trans=!0),"2"===i&&(this.key.rot=!0),"3"===i&&(this.key.scale=!0),"F"===i&&(this.key.focus=!0)},e.prototype.createPrimMaterial=function(){this.primMaterial=new M("primMat",this.scene),this.primMaterial.diffuseTexture=new B(this.primTexture,this.scene),this.primMaterial.diffuseColor=new r(1,1,1),this.primMaterial.specularColor=new r(0,0,0)},e.prototype.setPrimProperties=function(e){null==this.primMaterial&&this.createPrimMaterial();var t=e.getBoundingInfo().boundingSphere.radiusWorld,i=new I(0,t,-(t+2)),s=I.TransformCoordinates(i,this.avatar.getWorldMatrix());e.position.addInPlace(s),e.checkCollisions=!0,this.shadowGenerator.getShadowMap().renderList.push(e),x.AddTagsTo(e,"Vishva.prim Vishva.internal"),e.id=new Number(Date.now()).toString(),e.name=e.id,e.material=this.primMaterial.clone("m"+e.name)},e.prototype.addPrim=function(e){var t=null;"plane"===e?t=this.addPlane():"box"===e?t=this.addBox():"sphere"===e?t=this.addSphere():"disc"===e?t=this.addDisc():"cylinder"===e?t=this.addCylinder():"cone"===e?t=this.addCone():"torus"===e&&(t=this.addTorus()),null!==t&&(this.isMeshSelected?this.switchEditControl(t):this.selectForEdit(t),this.animateMesh(t))},e.prototype.addPlane=function(){var e=f.CreatePlane("",1,this.scene);return this.setPrimProperties(e),e.material.backFaceCulling=!1,e},e.prototype.addBox=function(){var e=f.CreateBox("",1,this.scene);return this.setPrimProperties(e),e},e.prototype.addSphere=function(){var e=f.CreateSphere("",10,1,this.scene);return this.setPrimProperties(e),e},e.prototype.addDisc=function(){var e=f.CreateDisc("",.5,20,this.scene);return this.setPrimProperties(e),e.material.backFaceCulling=!1,e},e.prototype.addCylinder=function(){var e=f.CreateCylinder("",1,1,1,20,1,this.scene);return this.setPrimProperties(e),e},e.prototype.addCone=function(){var e=f.CreateCylinder("",1,0,1,20,1,this.scene);return this.setPrimProperties(e),e},e.prototype.addTorus=function(){var e=f.CreateTorus("",1,.25,20,this.scene);return this.setPrimProperties(e),e},e.prototype.switchGround=function(){return this.isMeshSelected?(x.RemoveTagsFrom(this.ground,"Vishva.ground"),this.ground.isPickable=!0,this.ground=this.meshPicked,this.ground.isPickable=!1,x.AddTagsTo(this.ground,"Vishva.ground"),this.removeEditControl(),null):"no mesh selected"},e.prototype.instance_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";var e,t=new Number(Date.now()).toString();return null!=this.meshPicked&&this.meshPicked instanceof BABYLON.InstancedMesh?(e=this.meshPicked.clone(t,null,!0),e.scaling.copyFrom(this.meshPicked.scaling)):e=this.meshPicked.createInstance(t),console.log(this.meshPicked),console.log(e),this.animateMesh(e),this.switchEditControl(e),this.shadowGenerator.getShadowMap().renderList.push(e),null},e.prototype.toggleCollision=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.checkCollisions=!this.meshPicked.checkCollisions},e.prototype.enableCollision=function(e){this.meshPicked.checkCollisions=e},e.prototype.isCollideable=function(){return this.meshPicked.checkCollisions},e.prototype.toggleEnable=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.setEnabled(!this.meshPicked.isEnabled())},e.prototype.disableIt=function(e){this.meshPicked.setEnabled(!e)},e.prototype.isDisabled=function(){return!this.meshPicked.isEnabled()},e.prototype.showAllDisabled=function(){for(var e=0,t=this.scene.meshes;e<t.length;e++){var i=t[e];i.isEnabled()||(i.renderOutline=!0,i.outlineWidth=this.ow)}},e.prototype.hideAllDisabled=function(){for(var e=0,t=this.scene.meshes;e<t.length;e++){var i=t[e];i.isEnabled()||(i.renderOutline=!1)}},e.prototype.makeVisibile=function(e){if(!this.isMeshSelected)return"no mesh selected";var t=this.meshPicked;e?x.HasTags(t)&&x.MatchesQuery(t,"invisible")&&(x.RemoveTagsFrom(this.meshPicked,"invisible"),this.meshPicked.visibility=1,this.meshPicked.isPickable=!0,this.showingAllInvisibles&&(t.renderOutline=!1)):(x.AddTagsTo(this.meshPicked,"invisible"),this.showingAllInvisibles?(this.meshPicked.visibility=.5,t.renderOutline=!0,t.outlineWidth=this.ow,this.meshPicked.isPickable=!0):(this.meshPicked.visibility=0,this.meshPicked.isPickable=!1))},e.prototype.isVisible=function(){return!x.HasTags(this.meshPicked)||!x.MatchesQuery(this.meshPicked,"invisible")},e.prototype.showAllInvisibles=function(){this.showingAllInvisibles=!0;for(var e=0;e<this.scene.meshes.length;e++){var t=this.scene.meshes[e];x.HasTags(t)&&x.MatchesQuery(t,"invisible")&&(t.visibility=.5,t.renderOutline=!0,t.outlineWidth=this.ow,t.isPickable=!0)}},e.prototype.hideAllInvisibles=function(){this.showingAllInvisibles=!1;for(var e=0;e<this.scene.meshes.length;e++)for(var e=0;e<this.scene.meshes.length;e++){var t=this.scene.meshes[e];x.HasTags(t)&&x.MatchesQuery(t,"invisible")&&(t.visibility=0,t.renderOutline=!1,t.isPickable=!1)}},e.prototype.makeParent=function(){if(!this.isMeshSelected)return"no mesh selected";if(null==this.meshesPicked||0===this.meshesPicked.length)return"select atleast two mesh. use 'ctl' and mosue right click to select multiple meshes";this.meshPicked.computeWorldMatrix(!0);for(var e,t=v.Invert(this.meshPicked.getWorldMatrix()),i=0;i<this.meshesPicked.length;i++){var s=this.meshesPicked[i];s.computeWorldMatrix(!0),s===this.meshPicked.parent&&(e=this.meshPicked.getWorldMatrix(),e.decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null),s!==this.meshPicked&&(s.renderOutline=!1,e=s.getWorldMatrix().multiply(t),e.decompose(s.scaling,s.rotationQuaternion,s.position),s.parent=this.meshPicked)}return this.meshPicked.renderOutline=!1,this.meshesPicked=null,null},e.prototype.removeParent=function(){return this.isMeshSelected?null==this.meshPicked.parent?"this mesh has no parent":(this.meshPicked.getWorldMatrix().decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null,"parent removed"):"no mesh selected"},e.prototype.removeChildren=function(){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked,t=e.getChildren();if(0===t.length)return"this mesh has no children";for(var i,s=0,n=0;n<t.length;n++){var o=t[n];i=o.getWorldMatrix(),i.decompose(o.scaling,o.rotationQuaternion,o.position),o.parent=null,s++}return s+" children removed"},e.prototype.clone_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";var e,t=new Array;if(null!=this.meshesPicked)for(var i=0,s=this.meshesPicked;i<s.length;i++){var n=s[i];n!==this.meshPicked&&(null!=n&&n instanceof BABYLON.InstancedMesh||(e=this.clonetheMesh(n),t.push(e)))}return e=this.clonetheMesh(this.meshPicked),null!=this.meshesPicked&&(t.push(e),this.meshesPicked=t),this.switchEditControl(e),null},e.prototype.clonetheMesh=function(e){var t=new Number(Date.now()).toString(),i=e.clone(t,null,!0);return i.scaling.copyFrom(e.scaling),delete i.sensors,delete i.actuators,this.animateMesh(i),e.renderOutline=!1,this.shadowGenerator.getShadowMap().renderList.push(i),i},e.prototype.animateMesh=function(e){var t=e.scaling.clone().scaleInPlace(1.5),i=e.scaling.clone();n.CreateAndStartAnimation("boxscale",e,"scaling",10,2,t,i,0)},e.prototype.delete_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";if(null!=this.meshesPicked){for(var e=0,t=this.meshesPicked;e<t.length;e++){var i=t[e];i!==this.meshPicked&&this.deleteTheMesh(i)}this.meshesPicked=null}return this.deleteTheMesh(this.meshPicked),this.meshPicked=null,this.removeEditControl(),null},e.prototype.deleteTheMesh=function(e){t.SNAManager.getSNAManager().removeSNAs(e);var i=this.shadowGenerator.getShadowMap().renderList,s=i.indexOf(e);s>=0&&i.splice(s,1),e.dispose()},e.prototype.mergeMeshes_old=function(){if(null!=this.meshesPicked){for(var e=0,t=this.meshesPicked;e<t.length;e++){if(t[e]instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);var i=this.meshesPicked,s=f.MergeMeshes(i,!1);this.meshesPicked.pop();this.meshPicked.position.multiplyByFloats(-1,-1,-1);return s.setPivotPoint(this.meshPicked.position.clone()),s.position=this.meshPicked.position.clone(),this.switchEditControl(s),this.animateMesh(s),null}return"please select two or more mesh"},e.prototype.mergeMeshes=function(){if(null!=this.meshesPicked){for(var e=0,t=this.meshesPicked;e<t.length;e++){var i=t[e];if(i instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);for(var s=new Array(this.meshesPicked.length),n=0,o=0,a=this.meshesPicked;o<a.length;o++){var i=a[o];s[n]=i.position.clone(),n++,i.position.subtractInPlace(this.meshPicked.position)}var r=this.meshesPicked,h=f.MergeMeshes(r,!1);n=0;for(var l=0,u=this.meshesPicked;l<u.length;l++){var i=u[l];i.position=s[n],n++}return this.meshesPicked.pop(),h.position=this.meshPicked.position.clone(),this.switchEditControl(h),this.animateMesh(h),this.shadowGenerator.getShadowMap().renderList.push(h),this.multiUnSelectAll(),null}return"select two or more mesh"},e.prototype.csgOperation=function(e){if(null!=this.meshesPicked){if(this.meshesPicked.length>2)return"please select only two mesh";var t=u.FromMesh(this.meshPicked),i=u.FromMesh(this.meshesPicked[0]),s=void 0;if("subtract"===e)s=i.subtract(t);else if("intersect"===e)s=i.intersect(t);else{if("union"!==e)return"invalid operation";s=i.union(t)}var n=new Number(Date.now()).toString(),o=s.toMesh(n,this.meshesPicked[0].material,this.scene,!1);return this.switchEditControl(o),this.animateMesh(o),null}return"please select two mesh"},e.prototype.physTypes=function(){console.log("BoxImpostor "+b.BoxImpostor),console.log("SphereImpostor "+b.SphereImpostor),console.log("PlaneImpostor "+b.PlaneImpostor),console.log("CylinderImpostor "+b.CylinderImpostor),
console.log("MeshImpostor "+b.MeshImpostor),console.log("ParticleImpostor "+b.ParticleImpostor),console.log("HeightmapImpostor "+b.HeightmapImpostor)},e.prototype.getMeshPickedPhyParms=function(){return this.meshPickedPhyParms},e.prototype.setMeshPickedPhyParms=function(e){this.meshPickedPhyParms=e},e.prototype.savePhyParms=function(){void 0===this.meshPicked.physicsImpostor||null===this.meshPicked.physicsImpostor?this.meshPickedPhyParms=null:(this.meshPickedPhyParms=new R,this.meshPickedPhyParms.type=this.meshPicked.physicsImpostor.type,this.meshPickedPhyParms.mass=this.meshPicked.physicsImpostor.getParam("mass"),this.meshPickedPhyParms.friction=this.meshPicked.physicsImpostor.getParam("friction"),this.meshPickedPhyParms.restitution=this.meshPicked.physicsImpostor.getParam("restitution"),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},e.prototype.restorePhyParms=function(){this.resetPhysics(),null!=this.meshPickedPhyParms&&(this.meshPicked.physicsImpostor=new b(this.meshPicked,this.meshPickedPhyParms.type),this.meshPicked.physicsImpostor.setParam("mass",this.meshPickedPhyParms.mass),this.meshPicked.physicsImpostor.setParam("friction",this.meshPickedPhyParms.friction),this.meshPicked.physicsImpostor.setParam("restitution",this.meshPickedPhyParms.restitution),this.meshPickedPhyParms=null)},e.prototype.testPhysics=function(e){this.resetPhysics(),this.didPhysTest=!0,this.savePos=this.meshPicked.position.clone(),this.saveRot=this.meshPicked.rotationQuaternion.clone(),this.meshPicked.physicsImpostor=new b(this.meshPicked,e.type),this.meshPicked.physicsImpostor.setParam("mass",e.mass),this.meshPicked.physicsImpostor.setParam("friction",e.friction),this.meshPicked.physicsImpostor.setParam("restitution",e.restitution)},e.prototype.resetPhysics=function(){this.didPhysTest&&(this.didPhysTest=!1,this.meshPicked.position.copyFrom(this.savePos),this.meshPicked.rotationQuaternion.copyFrom(this.saveRot),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},e.prototype.setMeshVisibility=function(e){this.meshPicked.visibility=e},e.prototype.getMeshVisibility=function(){return this.meshPicked.visibility},e.prototype.setMeshColor=function(e,t){if(this.meshPicked.material instanceof BABYLON.MultiMaterial)return"This is multimaterial. Not supported for now";if(!(this.meshPicked.material instanceof BABYLON.StandardMaterial))return"This is not a standard material. Not supported for now";var i=this.meshPicked.material,s=r.FromHexString(t);if("diffuse"===e)i.diffuseColor=s;else if("emissive"===e)i.emissiveColor=s;else if("specular"===e)i.specularColor=s;else{if("ambient"!==e)return"invalid color type ["+e+"]";i.ambientColor=s}return null},e.prototype.getMaterialName=function(){return this.isMeshSelected?this.meshPicked.material.name:""},e.prototype.getMatTexture=function(e){var t=this.meshPicked.material;return"diffuse"==e&&null!=t.diffuseTexture?t.diffuseTexture.name:"ambient"==e&&null!=t.ambientTexture?t.ambientTexture.name:"opacity"==e&&null!=t.opacityTexture?t.opacityTexture.name:"reflection"==e&&null!=t.reflectionTexture?t.reflectionTexture.name:"emissive"==e&&null!=t.emissiveTexture?t.emissiveTexture.name:"specular"==e&&null!=t.specularTexture?t.specularTexture.name:"bump"==e&&null!=t.bumpTexture?t.bumpTexture.name:""},e.prototype.setMatTexture=function(e,t){var i=(this.meshPicked.material,this.getTextureByName(t));if(null!=i){var s=this.meshPicked.material;"diffuse"==e?s.diffuseTexture=i:"ambient"==e?s.ambientTexture=i:"opacity"==e?s.opacityTexture=i:"reflection"==e?s.reflectionTexture=i:"emissive"==e?s.emissiveTexture=i:"specular"==e?s.specularTexture=i:"bump"==e&&(s.bumpTexture=i)}},e.prototype.getTextures=function(){for(var e=this.scene.textures,t=[],i=0,s=e;i<s.length;i++){var n=s[i];t.push(n.name)}return t},e.prototype.getTextureByName=function(e){for(var t=this.scene.textures,i=0,s=t;i<s.length;i++){var n=s[i];if(n.name==e)return n}return null},e.prototype.getMeshColor=function(e){if(this.meshPicked.material instanceof BABYLON.MultiMaterial)return"#000000";if(!(this.meshPicked.material instanceof BABYLON.StandardMaterial))return"#000000";var t=this.meshPicked.material;return"diffuse"===e?void 0!==t.diffuseColor?t.diffuseColor.toHexString():"#000000":"emissive"===e?void 0!==t.emissiveColor?t.emissiveColor.toHexString():"#000000":"specular"===e?void 0!==t.specularColor?t.specularColor.toHexString():"#000000":"ambient"===e?void 0!==t.ambientColor?t.ambientColor.toHexString():"#000000":(console.error("invalid color type ["+e+"]"),null)},e.prototype.getMeshList=function(){for(var e=new Array,t=0,i=this.scene.meshes;t<i.length;t++){var s=i[t];s!=this.ground&&s!=this.avatar&&s!=this.skybox&&"EditControl"!=s.name&&e.push(s)}return e},e.prototype.selectMesh=function(e){var t=this.scene.getMeshByUniqueID(Number(e));this.isMeshSelected?this.switchEditControl(t):this.selectForEdit(t)},e.prototype.getAttachedLight=function(){var e=this.meshPicked.getDescendants();if(0===e.length)return null;for(var t=null,i=0,s=e;i<s.length;i++){var n=s[i];if(n instanceof m){t=n;break}}if(null===t)return null;var o=new V;return o.diffuse=t.diffuse,o.specular=t.specular,o.range=t.range,o.radius=t.radius,o.intensity=t.intensity,t instanceof BABYLON.SpotLight&&(o.type="Spot",o.angle=t.angle,o.exponent=t.exponent),t instanceof BABYLON.PointLight&&(o.type="Point"),t instanceof BABYLON.DirectionalLight&&(o.type="Dir"),t instanceof BABYLON.HemisphericLight&&(o.type="Hemi",o.direction=t.direction,o.gndClr=t.groundColor),o},e.prototype.attachAlight=function(e){this.detachLight();var t=null,i=this.meshPicked.name+"-light";"Spot"===e.type?t=new BABYLON.SpotLight(i,I.Zero(),new I(0,-1,0),e.angle*Math.PI/180,e.exponent,this.scene):"Point"===e.type?t=new BABYLON.PointLight(i,I.Zero(),this.scene):"Dir"===e.type?t=new BABYLON.DirectionalLight(i,new I(0,-1,0),this.scene):"Hemi"===e.type&&(t=new BABYLON.HemisphericLight(i,e.direction,this.scene),t.groundColor=e.gndClr),null!==t&&(t.diffuse=e.diffuse,t.specular=e.specular,t.range=e.range,t.radius=e.radius,t.intensity=e.intensity,t.parent=this.meshPicked)},e.prototype.detachLight=function(){var e=this.meshPicked.getDescendants();if(0!==e.length){for(var t=null,i=0,s=e;i<s.length;i++){var n=s[i];if(n instanceof m){t=n;break}}null!==t&&(t.parent=null,t.setEnabled(!1),t.dispose())}},e.prototype.setTransOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableTranslation()},e.prototype.isTransOn=function(){return this.editControl.isTranslationEnabled()},e.prototype.setRotOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableRotation()},e.prototype.isRotOn=function(){return this.editControl.isRotationEnabled()},e.prototype.setScaleOn=function(){this.editControl.setLocal(!0),this.editControl.enableScaling()},e.prototype.isScaleOn=function(){return this.editControl.isScalingEnabled()},e.prototype.setFocusOnMesh=function(){this.isFocusOnAv&&(this.cc.stop(),this.saveAVcameraPos.copyFrom(this.mainCamera.position),this.isFocusOnAv=!1),this.focusOnMesh(this.meshPicked,25)},e.prototype.setSpace=function(e){return console.log("setSPace parm "+e),this.snapperOn?"Cannot switch space when snapper is on":("local"===e?this.setSpaceLocal(!0):this.setSpaceLocal(!1),null)},e.prototype.getSpace=function(){return this.isSpaceLocal()?"local":"world"},e.prototype.setSpaceLocal=function(e){return null==this.editControl||this.editControl.isScalingEnabled()||this.editControl.setLocal(e),this.spaceWorld=!e,null},e.prototype.isSpaceLocal=function(){return!this.spaceWorld},e.prototype.undo=function(){null!=this.editControl&&this.editControl.undo()},e.prototype.redo=function(){null!=this.editControl&&this.editControl.redo()},e.prototype.snapTrans=function(e){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapTransOn=e,null!=this.editControl&&(this.snapTransOn?(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)):this.editControl.setTransSnap(!1))},e.prototype.isSnapTransOn=function(){return this.snapTransOn},e.prototype.setSnapTransValue=function(e){isNaN(e)||this.editControl.setTransSnapValue(e)},e.prototype.snapRot=function(e){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapRotOn=e,null!=this.editControl&&(this.snapRotOn?(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)):this.editControl.setRotSnap(!1))},e.prototype.isSnapRotOn=function(){return this.snapRotOn},e.prototype.setSnapRotValue=function(e){if(!isNaN(e)){var t=e*Math.PI/180;this.editControl.setRotSnapValue(t)}},e.prototype.isSnapScaleOn=function(){return this.snapScaleOn},e.prototype.setSnapScaleValue=function(e){isNaN(e)||this.editControl.setScaleSnapValue(e)},e.prototype.snapScale=function(e){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapScaleOn=e,null!=this.editControl&&(this.snapScaleOn?(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)):this.editControl.setScaleSnap(!1))},e.prototype.snapper=function(e){!this.spaceWorld&&e&&(this.spaceWorld=!0),this.snapperOn=e,null!=this.editControl&&(this.snapperOn?this.setSnapperOn():this.setSnapperOff())},e.prototype.setSnapperOn=function(){this.editControl.setRotSnap(!0),this.editControl.setTransSnap(!0),this.editControl.setScaleSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue),this.editControl.setTransSnapValue(this.snapTransValue),this.editControl.setScaleSnapValue(this.snapScaleValue),this.snapToGlobal()},e.prototype.setSnapperOff=function(){this.editControl.setRotSnap(!1),this.editControl.setTransSnap(!1),this.editControl.setScaleSnap(!1)},e.prototype.isSnapperOn=function(){return this.snapperOn},e.prototype.snapToGlobal=function(){if(this.isMeshSelected){var e=Math.round(this.meshPicked.position.x/this.snapTransValue)*this.snapTransValue,t=Math.round(this.meshPicked.position.y/this.snapTransValue)*this.snapTransValue,i=Math.round(this.meshPicked.position.z/this.snapTransValue)*this.snapTransValue;this.meshPicked.position=new I(e,t,i);var s=this.meshPicked.rotationQuaternion.toEulerAngles(),n=Math.round(s.x/this.snapRotValue)*this.snapRotValue,o=Math.round(s.y/this.snapRotValue)*this.snapRotValue,a=Math.round(s.z/this.snapRotValue)*this.snapRotValue;this.meshPicked.rotationQuaternion=k.RotationYawPitchRoll(o,n,a)}},e.prototype.getSoundFiles=function(){return this.assets.sounds},e.prototype.anyMeshSelected=function(){return this.isMeshSelected},e.prototype.getName=function(){return this.meshPicked.name},e.prototype.setName=function(e){this.meshPicked.name=e},e.prototype.getLocation=function(){return this.meshPicked.position},e.prototype.setLocation=function(e,t,i){isNaN(e)||isNaN(t)||isNaN(i)||this.isMeshSelected&&(this.meshPicked.position.x=e,this.meshPicked.position.y=t,this.meshPicked.position.z=i)},e.prototype.setRotation=function(e,t,i){isNaN(e)||isNaN(t)||isNaN(i)||this.isMeshSelected&&k.RotationYawPitchRollToRef(t*Math.PI/180,e*Math.PI/180,i*Math.PI/180,this.meshPicked.rotationQuaternion)},e.prototype.setScale=function(e,t,i){isNaN(e)||isNaN(t)||isNaN(i)||this.isMeshSelected&&(this.meshPicked.scaling.x=e,this.meshPicked.scaling.y=t,this.meshPicked.scaling.z=i)},e.prototype.getRotation=function(){var e=this.meshPicked.rotationQuaternion.toEulerAngles(),t=180/Math.PI;return e.multiplyByFloats(t,t,t)},e.prototype.getScale=function(){return this.meshPicked.scaling},e.prototype.bakeTransforms=function(){var e=this.meshPicked.position.clone();this.meshPicked.position.copyFromFloats(0,0,0),this.meshPicked.bakeCurrentTransformIntoVertices(),this.meshPicked.position=e,this.meshPicked.computeWorldMatrix(!0)},e.prototype.getSkelName=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton.name},e.prototype.getSkeleton=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton},e.prototype.getSkeltons=function(){return this.scene.skeletons},e.prototype.changeSkeleton=function(e){var t=!1,i=this.scene.skeletons;console.log("trying to swicth to "+e);for(var s=0,n=i;s<n.length;s++){var o=n[s];if(o.id+"-"+o.name===e){console.log("found skeleton. swicthing. "),this.meshPicked.skeleton=o,t=!0;break}}return t},e.prototype.cloneChangeSkeleton=function(e){for(var t=!1,i=this.scene.skeletons,s=0,n=i;s<n.length;s++){var o=n[s];if(o.id+"-"+o.name===e){console.log("found skeleton. swicthing. ");var a=new Number(Date.now()).toString(),r=o.clone(o.name,a);this.meshPicked.skeleton=r,t=!0;break}}return t},e.prototype.toggleSkelView=function(){if(null!=this.meshPicked.skeleton){var e=this.findSkelViewer(this.skelViewerArr,this.meshPicked);null===e?(e=new T(this.meshPicked.skeleton,this.meshPicked,this.scene),e.isEnabled=!0,this.skelViewerArr.push(e)):(this.delSkelViewer(this.skelViewerArr,e),e.dispose(),e=null)}},e.prototype.findSkelViewer=function(e,t){for(var i=0,s=e;i<s.length;i++){var n=s[i];if(n.mesh===t)return n}return null},e.prototype.delSkelViewer=function(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},e.prototype.animRest=function(){null!==this.meshPicked.skeleton&&void 0!==this.meshPicked.skeleton&&(this.scene.stopAnimation(this.meshPicked.skeleton),this.meshPicked.skeleton.returnToRest())},e.prototype.createAnimRange=function(e,t,i){this.meshPicked.skeleton.deleteAnimationRange(e,!1),this.meshPicked.skeleton.createAnimationRange(e,t,i)},e.prototype.getAnimationRanges=function(){var e=this.meshPicked.skeleton;if(null!==e&&void 0!==e){return e.getAnimationRanges()}return null},e.prototype.printAnimCount=function(e){for(var t=e.bones,i=0,s=t;i<s.length;i++){var n=s[i];console.log(n.name+","+n.animations.length+" , "+n.animations[0].getHighestFrame()),console.log(n.animations[0])}},e.prototype.playAnimation=function(e,t,i){var s=this.meshPicked.skeleton;if(null!=s){var n=parseFloat(t);isNaN(n)&&(n=1),s.beginAnimation(e,i,n)}},e.prototype.stopAnimation=function(){null!=this.meshPicked.skeleton&&this.scene.stopAnimation(this.meshPicked.skeleton)},e.prototype.getSensorList=function(){return t.SNAManager.getSNAManager().getSensorList()},e.prototype.getActuatorList=function(){return t.SNAManager.getSNAManager().getActuatorList()},e.prototype.getSensorParms=function(e){return t.SNAManager.getSNAManager().getSensorParms(e)},e.prototype.getActuatorParms=function(e){return t.SNAManager.getSNAManager().getActuatorParms(e)},e.prototype.getSensors=function(){if(!this.isMeshSelected)return null;var e=this.meshPicked.sensors;return null==e&&(e=new Array),e},e.prototype.getActuators=function(){if(!this.isMeshSelected)return null;var e=this.meshPicked.actuators;return null==e&&(e=new Array),e},e.prototype.addSensorbyName=function(e){return this.isMeshSelected?t.SNAManager.getSNAManager().createSensorByName(e,this.meshPicked,null):null},e.prototype.addActuaorByName=function(e){return this.isMeshSelected?t.SNAManager.getSNAManager().createActuatorByName(e,this.meshPicked,null):null},e.prototype.add_sensor=function(e,i){if(!this.isMeshSelected)return"no mesh selected";if("Touch"!==e)return"No such sensor";new t.SensorTouch(this.meshPicked,i);return null},e.prototype.addActuator=function(e,i){if(!this.isMeshSelected)return"no mesh selected";if("Rotator"===e)new t.ActuatorRotator(this.meshPicked,i);else{if("Mover"!==e)return"No such actuator";new t.ActuatorMover(this.meshPicked,i)}return null},e.prototype.removeSensor=function(e){if(!this.isMeshSelected)return"no mesh selected";var t=this.meshPicked.sensors;if(null==t)return"no sensor found";var i=t[e];return null==i?"no sensor found":(i.dispose(),null)},e.prototype.removeActuator=function(e){if(!this.isMeshSelected)return"no mesh selected";var t=this.meshPicked.actuators;if(null==t)return"no actuator found";var i=t[e];return null==i?"no actuator found":(i.dispose(),null)},e.prototype.removeSensorActuator=function(e){e.dispose()},e.prototype.setSunPos=function(e){var t=Math.PI*(180-e)/180,i=-Math.cos(t),s=-Math.sin(t);this.sunDR.direction=new I(i,s,0),this.sun.direction=new I(-i,-s,0)},e.prototype.getSunPos=function(){var e=this.sunDR.direction,t=e.x,i=e.y,s=Math.sqrt(t*t+i*i);return 180*Math.acos(t/s)/Math.PI},e.prototype.setLight=function(e){this.sun.intensity=e,this.sunDR.intensity=e,this.skybox.visibility=2*e},e.prototype.getLight=function(){return this.sun.intensity},e.prototype.setShade=function(e){var t=e;t=1-t,this.sun.groundColor=new r(t,t,t)},e.prototype.getShade=function(){return 1-this.sun.groundColor.r},e.prototype.setFog=function(e){this.scene.fogDensity=e},e.prototype.getFog=function(){return this.scene.fogDensity},e.prototype.setFogColor=function(e){this.scene.fogColor=r.FromHexString(e)},e.prototype.getFogColor=function(){return this.scene.fogColor.toHexString()},e.prototype.setFov=function(e){var t=e;this.mainCamera.fov=3.14*t/180},e.prototype.getFov=function(){return 180*this.mainCamera.fov/3.14},e.prototype.setSky=function(e){var t=this.skybox.material;t.reflectionTexture.dispose();var i="vishva/assets/skyboxes/"+e+"/"+e;t.reflectionTexture=new l(i,this.scene),t.reflectionTexture.coordinatesMode=B.SKYBOX_MODE},e.prototype.getSky=function(){var e=this.skybox.material,t=e.reflectionTexture.name,i=t.lastIndexOf("/");return t.substring(i+1)},e.prototype.getAmbientColor=function(){return this.scene.ambientColor.toHexString()},e.prototype.setAmbientColor=function(e){this.scene.ambientColor=r.FromHexString(e)},e.prototype.setGroundColor_old=function(e){var t=e,i=t[0]/255,s=t[1]/255,n=t[2]/255,o=new r(i,s,n);this.ground.material.diffuseColor=o},e.prototype.setGroundColor=function(e){this.ground.material.diffuseColor=r.FromHexString(e)},e.prototype.getGroundColor=function(){return this.ground.material.diffuseColor.toHexString()},e.prototype.getGroundColor_old=function(){var e=new Array(3),t=this.ground.material;return null!=t.diffuseColor?(e[0]=255*t.diffuseColor.r,e[1]=255*t.diffuseColor.g,e[2]=255*t.diffuseColor.b,e):null},e.prototype.toggleDebug=function(){this.debugVisible?this.scene.debugLayer.hide():this.scene.debugLayer.show(),this.debugVisible=!this.debugVisible},e.prototype.saveAsset=function(){if(!this.isMeshSelected)return null;var e=this.meshPicked.clone(this.meshPicked.name,null);e.position=I.Zero(),e.rotation=I.Zero();var t=w.SerializeMesh(e,!1);e.dispose();var i=JSON.stringify(t),s=new File([i],"AssetFile.babylon");return URL.createObjectURL(s)},e.prototype.saveWorld=function(){if(null!=this.editControl)return alert("cannot save during edit"),null;this.removeInstancesFromShadow(),this.renameMeshIds(),this.cleanupSkels(),this.resetSkels(this.scene),this.cleanupMats(),this.renameWorldTextures();var e=new t.VishvaSerialized;e.settings.cameraCollision=this.cameraCollision,e.settings.autoEditMenu=this.autoEditMenu,e.guiSettings=this.vishvaGUI.getSettings(),e.misc.activeCameraTarget=this.mainCamera.target,e.snas=t.SNAManager.getSNAManager().serializeSnAs(this.scene);var i=w.Serialize(this.scene);this.changeSoundUrl(i),i.VishvaSerialized=e;var s=JSON.stringify(i),n=new File([s],"WorldFile.babylon");return this.addInstancesToShadow(),URL.createObjectURL(n)},e.prototype.removeInstancesFromShadow=function(){for(var e=this.scene.meshes,t=0,i=e;t<i.length;t++){var s=i[t];if(null!=s&&s instanceof BABYLON.InstancedMesh){var n=this.shadowGenerator.getShadowMap().renderList,o=n.indexOf(s);o>=0&&n.splice(o,1)}}},e.prototype.addInstancesToShadow=function(){for(var e=0,t=this.scene.meshes;e<t.length;e++){var i=t[e];null!=i&&i instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(i)}},e.prototype.renameMeshIds=function(){for(var e=0,t=0,i=this.scene.meshes;t<i.length;t++){i[t].id=new Number(e).toString(),e++}},e.prototype.resetSkels=function(e){for(var t=0,i=0,s=e.skeletons;i<s.length;i++){var n=s[i];n.id=new Number(t).toString(),t++,n.returnToRest()}},e.prototype.renameWorldTextures=function(){var e=this.scene.materials;this.renameWorldMaterials(e);for(var t=this.scene.multiMaterials,i=0,s=t;i<s.length;i++){var n=s[i];this.renameWorldMaterials(n.subMaterials)}},e.prototype.renameWorldMaterials=function(e){for(var t,i=0,s=e;i<s.length;i++){var n=s[i];null!=n&&n instanceof BABYLON.StandardMaterial&&(t=n,this.rename(t.diffuseTexture),this.rename(t.reflectionTexture),this.rename(t.opacityTexture),this.rename(t.specularTexture),this.rename(t.bumpTexture),this.rename(t.ambientTexture))}},e.prototype.rename=function(e){null!=e&&".."!==e.name.substring(0,2)&&(e.name=this.RELATIVE_ASSET_LOCATION+e.name)},e.prototype.changeSoundUrl=function(e){var t=e.sounds;if(null!=t)for(var i=t,s=0,n=i;s<n.length;s++){var o=n[s];o.url=this.SOUND_ASSET_LOCATION+o.url}},e.prototype.cleanupMats=function(){for(var e=this.scene.meshes,t=new Array,i=new Array,s=0,n=e;s<n.length;s++){var o=n[s];if(null!=o.material)if(null!=o.material&&o.material instanceof BABYLON.MultiMaterial){var a=o.material;i.push(a);for(var r=a.subMaterials,h=0;h<r.length;h++){var l=r[h];t.push(l)}}else t.push(o.material)}for(var u=this.scene.materials,c=u.length,p=c-1;p>=0;p--)-1===t.indexOf(u[0|p])&&u[0|p].dispose();var d=this.scene.multiMaterials;c=d.length;for(var p=c-1;p>=0;p--)-1===i.indexOf(d[0|p])&&d[0|p].dispose()},e.prototype.cleanupSkels=function(){for(var e=this.scene.meshes,t=new Array,i=0,s=e;i<s.length;i++){var n=s[i];null!=n.skeleton&&t.push(n.skeleton)}for(var o=this.scene.skeletons,a=o.length,r=a-1;r>=0;r--)-1===t.indexOf(o[0|r])&&o[0|r].dispose()},e.prototype.loadAssetFile=function(e){var t=this,i=e.name.split(".")[0];P.ImportMesh("","vishva/assets/"+i+"/",e.name,this.scene,function(e,i,s){return t.onMeshLoaded(e,i,s)})},e.prototype.loadAsset=function(e,t){var i=this;this.assetType=e,this.file=t;var s=t.split(".")[0];P.ImportMesh("","vishva/assets/"+e+"/"+s+"/",t,this.scene,function(e,t,s){return i.onMeshLoaded(e,t,s)})},e.prototype.onMeshLoaded=function(e,t,i){var s=this.getBoundingRadius(e);console.log("meshes "+e.length),console.log("skels "+i.length);for(var n=0,o=i;n<o.length;n++){var a=o[n];this.scene.stopAnimation(a)}for(var r=0,h=e;r<h.length;r++){var l=h[r];if(l.isPickable=!0,l.checkCollisions=!0,null==l.parent){var u=new I(0,0,-(s+2)),c=I.TransformCoordinates(u,this.avatar.getWorldMatrix());l.position.addInPlace(c)}if(this.shadowGenerator.getShadowMap().renderList.push(l),null!=l.material)if(l.material instanceof BABYLON.MultiMaterial)for(var p=l.material,d=p.subMaterials,g=0,m=d;g<m.length;g++){var v=m[g];l.material.backFaceCulling=!1,l.material.alpha=1,null!=v&&v instanceof BABYLON.StandardMaterial&&this.renameAssetTextures(v)}else{l.material.backFaceCulling=!1,l.material.alpha=1;var f=l.material;this.renameAssetTextures(f)}null!=l.skeleton&&(this.scene.stopAnimation(l.skeleton),this.fixAnimationRanges(l.skeleton))}if(e.length>0){var y=e[e.length-1];this.isMeshSelected?this.switchEditControl(y):this.selectForEdit(y),this.animateMesh(y)}},e.prototype.renameAssetTextures=function(e){console.log("renameAssetTextures"),this.renameAssetTexture(e.diffuseTexture),this.renameAssetTexture(e.reflectionTexture),this.renameAssetTexture(e.opacityTexture),this.renameAssetTexture(e.specularTexture),this.renameAssetTexture(e.bumpTexture)},e.prototype.renameAssetTexture=function(e){if(null!=e){var t=e.name;0!==t.indexOf("vishva/")&&0!==t.indexOf("../")&&(e.name="vishva/assets/"+this.assetType+"/"+this.file.split(".")[0]+"/"+t)}},e.prototype.getBoundingRadius=function(e){for(var t=0,i=0,s=e;i<s.length;i++){var n=s[i];console.log("=========="),console.log(n.name),console.log(n.absolutePosition),console.log(n.absolutePosition.length()),null!=n.parent&&console.log("parent "+n.parent.name);var o=n.getBoundingInfo(),a=o.boundingSphere.radiusWorld;if(console.log(o.boundingSphere.radiusWorld),isFinite(a)){var r=a+n.absolutePosition.length();t<r&&(t=r)}}return console.log("max radius "+t),t},e.prototype.loadWorldFile=function(e){var t=this;this.sceneFolderName=e.name.split(".")[0];var i=new FileReader;i.onload=function(e){return t.onSceneFileRead(e)},i.readAsText(e)},e.prototype.onSceneFileRead=function(e){var t=this;return this.sceneData="data:"+e.target.result,this.engine.stopRenderLoop(),this.scene.onDispose=function(){return t.onSceneDispose()},this.scene.dispose(),null},e.prototype.onSceneDispose=function(){var e=this;this.scene=null,this.avatarSkeleton=null,this.avatar=null,P.Load("worlds/"+this.sceneFolderName+"/",this.sceneData,this.engine,function(t){return e.onSceneLoaded(t)})},e.prototype.createWater=function(){console.log("creating water");var e=f.CreateGround("waterMesh",512,512,32,this.scene,!1),t=new E("water",this.scene);t.backFaceCulling=!0,t.bumpTexture=new B(this.waterTexture,this.scene),t.bumpTexture.name=this.RELATIVE_ASSET_LOCATION+t.bumpTexture.name,t.windForce=-5,t.waveHeight=.5,t.colorBlendFactor=0,t.bumpHeight=.1,t.waveLength=.1,t.addToRenderList(this.skybox),e.material=t},e.prototype.addWater=function(){if(!this.isMeshSelected)return"no mesh selected";var e=new E("water",this.scene);e.bumpTexture=new B(this.waterTexture,this.scene),e.windForce=.1,e.waveHeight=.1,e.colorBlendFactor=0,e.bumpHeight=0,e.waveLength=0,e.addToRenderList(this.skybox),this.meshPicked.material=e},e.prototype.switchAvatar=function(){return this.isMeshSelected?this.isAvatar(this.meshPicked)?(this.cc.stop(),t.SNAManager.getSNAManager().enableSnAs(this.avatar),this.avatar.rotationQuaternion=k.RotationYawPitchRoll(this.avatar.rotation.y,this.avatar.rotation.x,this.avatar.rotation.z),this.avatar.isPickable=!0,x.RemoveTagsFrom(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(x.RemoveTagsFrom(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name=""),this.avatar=this.meshPicked,this.avatarSkeleton=this.avatar.skeleton,x.AddTagsTo(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(x.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.avatarSkeleton.enableBlending(.1)),this.cc.setAvatar(this.avatar),this.cc.setAvatarSkeleton(this.avatarSkeleton),this.avatar.checkCollisions=!0,this.avatar.ellipsoid=new I(.5,1,.5),this.avatar.ellipsoidOffset=new I(0,1,0),this.avatar.isPickable=!1,this.avatar.rotation=this.avatar.rotationQuaternion.toEulerAngles(),this.avatar.rotationQuaternion=null,this.saveAVcameraPos=this.mainCamera.position,this.isFocusOnAv=!0,this.removeEditControl(),t.SNAManager.getSNAManager().disableSnAs(this.avatar),this.cc.setAvatar(this.avatar),this.cc.setAvatarSkeleton(this.avatarSkeleton),this.cc.start(),null):"cannot use this as avatar":"no mesh selected"},e.prototype.isAvatar=function(e){return null!=e.skeleton},e.prototype.createGround=function(e){var t=new M("groundMat",e);t.diffuseTexture=new B(this.groundTexture,e),t.bumpTexture=new B(this.groundBumpTexture,e),t.diffuseTexture.uScale=6,t.diffuseTexture.vScale=6,t.bumpTexture.uScale=100,t.bumpTexture.vScale=100,t.diffuseColor=new r(.9,.6,.4),t.specularColor=new r(0,0,0);var i=f.CreateGround("ground",256,256,1,e);return i.material=t,i.checkCollisions=!0,i.isPickable=!1,x.AddTagsTo(i,"Vishva.ground Vishva.internal"),i.freezeWorldMatrix(),i.receiveShadows=!0,this.enablePhysics&&(i.physicsImpostor=new BABYLON.PhysicsImpostor(i,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.1},this.scene)),this.ground=i,i},e.prototype.createGround_htmap=function(e){var t=this,i=this.createGroundMaterial(e);y.CreateGroundFromHeightMap("ground",this.groundHeightMap,{width:10240,height:10240,minHeight:0,maxHeight:1e3,subdivisions:32,onReady:function(e){console.log("ground created"),e.material=i,e.checkCollisions=!0,e.isPickable=!1,x.AddTagsTo(e,"Vishva.ground Vishva.internal"),e.receiveShadows=!0,e.freezeWorldMatrix(),t.ground=e}},e)},e.prototype.createGroundMaterial=function(e){var t=new M("groundMat",e);return t.diffuseTexture=new B(this.groundTexture,e),t.bumpTexture=new B(this.groundBumpTexture,e),t.diffuseTexture.uScale=100,t.diffuseTexture.vScale=100,t.bumpTexture.uScale=100,t.bumpTexture.vScale=100,t.diffuseColor=new r(.9,.6,.4),t.specularColor=new r(0,0,0),t},e.prototype.onDataMapReady=function(e,t,i){var s=new Float32Array(e.length);p.ComputeNormalsFromMapToRef(e,t,i,s);var n={mapData:e,mapSubX:t,mapSubZ:i,mapNormals:s,terrainSub:120},o=new BABYLON.DynamicTerrain("t",n,this.scene),a=new M("tm",this.scene);a.diffuseTexture=new B(this.groundTexture,this.scene),a.diffuseTexture.uScale=6,a.diffuseTexture.vScale=6,a.bumpTexture=new B(this.groundBumpTexture,this.scene),a.bumpTexture.uScale=64,a.bumpTexture.vScale=64,a.specularColor=r.Black(),a.diffuseColor=new r(.9,.6,.4),o.mesh.material=a,o.createUVMap(),o.update(!0),o.mesh.checkCollisions=!0,this.ground=o.mesh,x.AddTagsTo(this.ground,"Vishva.ground Vishva.internal")},e.prototype.creatDynamicTerrain=function(){var e=this,t={width:1024,height:1024,subX:512,subZ:512,minHeight:0,maxHeight:10,offsetX:0,offsetZ:0,onReady:function(t,i,s){e.onDataMapReady(t,i,s)}},i=new Float32Array(786432);p.CreateMapFromHeightMapToRef(this.groundHeightMap,t,i,this.scene)},e.prototype.createSkyBox=function(e){var t=new M("skyBox",e);t.backFaceCulling=!1,t.disableLighting=!0,t.diffuseColor=new r(0,0,0),t.specularColor=new r(0,0,0),t.reflectionTexture=new l(this.skyboxTextures,e),t.reflectionTexture.coordinatesMode=B.SKYBOX_MODE;var i=f.CreateBox("skyBox",1e4,e);return i.material=t,i.infiniteDistance=!0,i.renderingGroupId=0,i.isPickable=!1,x.AddTagsTo(i,"Vishva.sky Vishva.internal"),i},e.prototype.toggleSnow=function(){null===this.snowPart&&(this.snowPart=this.createSnowPart()),this.snowing?this.snowPart.stop():(this.snowPart.start(),this.raining&&(this.rainPart.stop(),this.raining=!1)),this.snowing=!this.snowing},e.prototype.createSnowPart=function(){var e=new S("snow",1e3,this.scene);return e.particleTexture=new BABYLON.Texture(this.snowTexture,this.scene),e.emitter=new f("snowEmitter",this.scene,this.mainCamera),e.maxEmitBox=new I(10,10,10),e.minEmitBox=new I(-10,10,-10),e.emitRate=1e3,e.updateSpeed=.005,e.minLifeTime=1,e.maxLifeTime=5,e.minSize=.1,e.maxSize=.5,e.color1=new BABYLON.Color4(1,1,1,1),e.color2=new BABYLON.Color4(1,1,1,1),e.colorDead=new BABYLON.Color4(0,0,0,0),e.gravity=new BABYLON.Vector3(0,-9.81,0),e},e.prototype.toggleRain=function(){null===this.rainPart&&(this.rainPart=this.createRainPart()),this.raining?this.rainPart.stop():(this.rainPart.start(),this.snowing&&(this.snowPart.stop(),this.snowing=!1)),this.raining=!this.raining},e.prototype.createRainPart=function(){var e=new S("rain",4e3,this.scene);return e.particleTexture=new BABYLON.Texture(this.rainTexture,this.scene),e.emitter=new I(0,40,0),e.maxEmitBox=new I(100,40,100),e.minEmitBox=new I(-100,40,-100),e.emitRate=1e3,e.updateSpeed=.02,e.minLifeTime=5,e.maxLifeTime=10,e.minSize=.1,e.maxSize=.8,e.color1=new BABYLON.Color4(1,1,1,.5),e.color2=new BABYLON.Color4(0,0,1,1),e.colorDead=new BABYLON.Color4(0,0,0,0),e.gravity=new BABYLON.Vector3(0,-9.81,0),e},e.prototype.createCamera=function(e,t){var i=new o("v.c-camera",1,1.4,4,new I(0,1e3,0),e);return this.setCameraSettings(i),i.attachControl(t,!0),null!==this.avatar&&void 0!==this.avatar&&(i.target=new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z),i.alpha=-this.avatar.rotation.y-4.69),i.checkCollisions=this.cameraCollision,i.collisionRadius=new I(.5,.5,.5),x.AddTagsTo(i,"Vishva.camera"),i},e.prototype.createAvatar=function(){var e=this;P.ImportMesh("",this.avatarFolder,this.avatarFile,this.scene,function(t,i,s){return e.onAvatarLoaded(t,i,s)})},e.prototype.onAvatarLoaded=function(e,t,i){this.avatar=e[0],this.shadowGenerator.getShadowMap().renderList.push(this.avatar);for(var n=e.length,o=1;o<n;o++)e[o].checkCollisions=!1,e[o].dispose();this.avatarSkeleton=i[0],n=i.length;for(var o=1;o<n;o++)i[o].dispose();this.fixAnimationRanges(this.avatarSkeleton),this.avatar.skeleton=this.avatarSkeleton,this.avatarSkeleton.enableBlending(.1),this.avatar.position=this.spawnPosition,this.avatar.checkCollisions=!0,this.avatar.ellipsoid=new I(.5,1,.5),this.avatar.ellipsoidOffset=new I(0,1,0),this.avatar.isPickable=!1,x.AddTagsTo(this.avatar,"Vishva.avatar"),
x.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.mainCamera.alpha=-this.avatar.rotation.y-4.69;var a=this.avatar.material;if(null!=a.diffuseTexture){var h=a.diffuseTexture.name;a.diffuseTexture.name=this.avatarFolder+h,a.backFaceCulling=!0,a.ambientColor=new r(0,0,0)}this.cc=new s(this.avatar,this.mainCamera,this.scene),this.setCharacterController(this.cc),this.cc.setCameraElasticity(!0),this.cc.start()},e.prototype.setCharacterController=function(e){this.mainCamera.lowerRadiusLimit=1,this.mainCamera.upperRadiusLimit=100,e.setCameraTarget(new BABYLON.Vector3(0,1.5,0)),e.setIdleAnim("idle",.1,!0),e.setTurnLeftAnim("turnLeft",.5,!0),e.setTurnRightAnim("turnRight",.5,!0),e.setWalkBackAnim("walkBack",.5,!0),e.setJumpAnim("jump",4,!1),e.setFallAnim("fall",2,!1),e.setSlideBackAnim("slideBack",1,!1)},e.prototype.fixAnimationRanges=function(e){for(var t=e.getAnimationRanges(),i=0,s=t;i<s.length;i++){s[i].from++}},e.prototype.setCameraSettings=function(e){e.lowerRadiusLimit=.25,e.keysLeft=[],e.keysRight=[],e.keysUp=[],e.keysDown=[],e.panningInertia=.1,e.inertia=.1,e.panningSensibility=250,e.angularSensibilityX=250,e.angularSensibilityY=250},e.prototype.backfaceCulling=function(e){var t;for(t=0;t<e.length;++t)e[t].backFaceCulling=!1},e.prototype.disableKeys=function(){this.keysDisabled=!0,this.cc.stop()},e.prototype.enableKeys=function(){this.keysDisabled=!1,this.isFocusOnAv&&this.cc.start()},e.prototype.enableCameraCollision=function(e){this.cameraCollision=e,this.mainCamera.checkCollisions=e,this.cc.cameraCollisionChanged()},e.prototype.isCameraCollisionOn=function(){return this.cameraCollision},e.prototype.enableAutoEditMenu=function(e){this.autoEditMenu=e},e.prototype.isAutoEditMenuOn=function(){return this.autoEditMenu},e}();t.Vishva=D;var O=function(){function e(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.trans=!1,this.rot=!1,this.scale=!1,this.esc=!1,this.shift=!1,this.ctl=!1,this.alt=!1,this.focus=!1}return e}();t.Key=O;var L=function(){function e(e,t,i){this.exist=!1,this.name=e,this.l=t,this.r=i}return e}();t.AnimData=L;var R=function(){function e(){}return e}();t.PhysicsParm=R;var V=function(){function e(){this.type="Spot",this.diffuse=r.White(),this.specular=r.White(),this.intensity=1,this.range=5,this.radius=5,this.angle=45,this.exponent=1,this.gndClr=r.White(),this.direction=I.Zero()}return e}();t.LightParm=V}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.Vector3,i=function(){function e(){this.settings=new s,this.misc=new n}return e}();e.VishvaSerialized=i;var s=function(){function e(){this.cameraCollision=!0,this.autoEditMenu=!1}return e}();e.SettingsSerialized=s;var n=function(){function e(){this.activeCameraTarget=t.Zero()}return e}();e.MiscSerialized=n}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.Tags,i=function(){function e(){this.sensorList=[],this.actuatorList=[],this.actuatorMap={},this.sensorMap={},this.snaDisabledList=new Array,this.sig2actMap=new Object,this.prevUID=""}return e.getSNAManager=function(){return null==e.sm&&(e.sm=new e),e.sm},e.prototype.addActuator=function(e,t){this.actuatorList.push(e),this.actuatorMap[e]=t},e.prototype.addSensor=function(e,t){this.sensorList.push(e),this.sensorMap[e]=t},e.prototype.setConfig=function(e){this.sensors=e.sensors,this.actuators=e.actuators,this.sensorList=Object.keys(this.sensors),this.actuatorList=Object.keys(this.actuators)},e.prototype.getSensorList=function(){return this.sensorList},e.prototype.getActuatorList=function(){return this.actuatorList},e.prototype.createSensorByName=function(e,t,i){return new(0,this.sensorMap[e])(t,i)},e.prototype.createActuatorByName=function(e,t,i){return new(0,this.actuatorMap[e])(t,i)},e.prototype.getSensorParms=function(e){return this.sensors[e].parms},e.prototype.getActuatorParms=function(e){return this.sensors[e].parms},e.prototype.emitSignal=function(e){if(""!==e.trim())for(var t=this.sig2actMap[e],i=0,s=t;i<s.length;i++){var n=s[i];n.start(e)}},e.prototype.processQueue=function(e){var t=e.actuators;if(null!=t)for(var i=0,s=t;i<s.length;i++){var n=s[i];n.processQueue()}},e.prototype.disableSnAs=function(e){this.snaDisabledList.push(e);var t=e.actuators;if(null!=t)for(var i=0,s=t;i<s.length;i++){var n=s[i];n.actuating&&n.stop()}},e.prototype.enableSnAs=function(e){var t=this.snaDisabledList.indexOf(e);-1!==t&&this.snaDisabledList.splice(t,1);var i=e.actuators;if(null!=i)for(var s=0,n=i;s<n.length;s++){var o=n[s];o.properties.autoStart&&o.start(o.properties.signalId)}},e.prototype.removeSNAs=function(e){var t=e.actuators;if(null!=t)for(var i=t.length,s=i-1;s>=0;s--)t[s].dispose();var n=e.sensors;if(null!=n)for(var i=n.length,s=i-1;s>=0;s--)n[s].dispose();var s=this.snaDisabledList.indexOf(e);-1!==s&&this.snaDisabledList.splice(s,1)},e.prototype.subscribe=function(e,t){var i=this.sig2actMap[t];if(null==i){var s=new Array;s.push(e),this.sig2actMap[t]=s}else{var s=i;s.push(e)}},e.prototype.unSubscribe=function(e,t){var i=this.sig2actMap[t];if(null!=i){var s=i,n=s.indexOf(e);-1!==n&&s.splice(n,1)}},e.prototype.unSubscribeAll=function(){},e.prototype.serializeSnAs=function(e){for(var t,i,n=new Array,o=e.meshes,a=0,r=o;a<r.length;a++){var h=r[a];i=null;var l=h.actuators;if(null!=l){i=this.getMeshVishvaUid(h);for(var u=0,c=l;u<c.length;u++){var p=c[u];t=new s,t.name=p.getName(),t.type=p.getType(),t.meshId=i,t.properties=p.getProperties(),n.push(t)}}var d=h.sensors;if(null!=d){null==i&&(i=this.getMeshVishvaUid(h));for(var g=0,m=d;g<m.length;g++){var v=m[g];t=new s,t.name=v.getName(),t.type=v.getType(),t.meshId=i,t.properties=v.getProperties(),n.push(t)}}}return n},e.prototype.unMarshal=function(e,t){var i=[];if(null!=e){for(var s=0,n=e;s<n.length;s++){var o=n[s],a=t.getMeshesByTags(o.meshId)[0];null==a&&null!=(a=t.getMeshByName(o.meshId))&&i.indexOf(a)<0&&i.push(a),null!=a?"SENSOR"===o.type?this.createSensorByName(o.name,a,o.properties):"ACTUATOR"===o.type&&this.createActuatorByName(o.name,a,o.properties):console.error("Didnot find mesh for tag "+o.meshId)}for(var r=0,h=i;r<h.length;r++){var l=h[r];l.name=l.name.split(".Vishva.uid.")[0]}}},e.prototype.getMeshVishvaUid=function(e){if(!(e instanceof BABYLON.InstancedMesh)&&t.HasTags(e))for(var i=t.GetTags(e,!0).split(" "),s=0,n=i;s<n.length;s++){var o=n[s],a=o.indexOf("Vishva.uid.");if(a>=0)return o}var r;for(r="Vishva.uid."+new Number(Date.now()).toString();r===this.prevUID;)r="Vishva.uid."+new Number(Date.now()).toString();return this.prevUID=r,e instanceof BABYLON.InstancedMesh?(e.name=e.name+"."+r,e.name):(t.AddTagsTo(e,r),r)},e}();e.SNAManager=i;var s=function(){function e(){}return e}();e.SNAserialized=s;var n=function(){function e(e,t){this.actions=new Array,this.properties=t,this.mesh=e;var i=this.mesh.sensors;null==i&&(i=new Array,e.sensors=i),i.push(this)}return e.prototype.dispose=function(){var e=this.mesh.sensors;if(null!=e){var t=e.indexOf(this);-1!==t&&e.splice(t,1)}this.removeActions(),this.cleanUp()},e.prototype.getSignalId=function(){return this.properties.signalId},e.prototype.setSignalId=function(e){this.properties.signalId=e},e.prototype.emitSignal=function(e){i.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0||i.getSNAManager().emitSignal(this.properties.signalId)},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(e){this.properties=e},e.prototype.handlePropertiesChange=function(){this.removeActions(),this.onPropertiesChange()},e.prototype.getType=function(){return"SENSOR"},e.prototype.removeActions=function(){if(this.mesh.actionManager){for(var e,t=this.mesh.actionManager.actions,i=0,s=this.actions;i<s.length;i++){var n=s[i];e=t.indexOf(n),t.splice(e,1)}0===t.length&&(this.mesh.actionManager.dispose(),this.mesh.actionManager=null)}},e}();e.SensorAbstract=n;var o=function(){function e(e,t){this.actuating=!1,this.ready=!0,this.queued=0,this.disposed=!1,this.disabled=!1,this.properties=t,this.mesh=e,this.handlePropertiesChange();var i=this.mesh.actuators;null==i&&(i=new Array,this.mesh.actuators=i),i.push(this)}return e.prototype.start=function(e){if(this.disposed)return!1;if(!this.ready)return!1;if(i.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0)return!1;if(e==this.signalDisable)return void(this.disabled=!0);if(e==this.signalEnable){if(this.disabled=!1,0==this.queued)return;this.queued--}return this.actuating||this.disabled?(this.properties.loop||this.queued++,!0):(i.getSNAManager().emitSignal(this.properties.signalStart),this.actuating=!0,this.actuate(),!0)},e.prototype.processQueue=function(){this.queued>0&&(this.queued--,this.start(this.signalId))},e.prototype.getType=function(){return"ACTUATOR"},e.prototype.getMesh=function(){return this.mesh},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(e){this.properties=e,this.handlePropertiesChange()},e.prototype.getSignalId=function(){return this.properties.signalId},e.prototype.handlePropertiesChange=function(){null!=this.properties.signalId&&""!=this.properties.signalId&&(null==this.signalId?(this.signalId=this.properties.signalId,i.getSNAManager().subscribe(this,this.signalId)):this.signalId!==this.properties.signalId&&(i.getSNAManager().unSubscribe(this,this.signalId),this.signalId=this.properties.signalId,i.getSNAManager().subscribe(this,this.signalId))),null!=this.properties.signalEnable&&""!=this.properties.signalEnable&&(null==this.signalEnable?(this.signalEnable=this.properties.signalEnable,i.getSNAManager().subscribe(this,this.signalEnable)):this.signalEnable!==this.properties.signalEnable&&(i.getSNAManager().unSubscribe(this,this.signalEnable),this.signalEnable=this.properties.signalEnable,i.getSNAManager().subscribe(this,this.signalEnable))),null!=this.properties.signalDisable&&""!=this.properties.signalDisable&&(null==this.signalDisable?(this.signalDisable=this.properties.signalDisable,i.getSNAManager().subscribe(this,this.signalDisable)):this.signalDisable!==this.properties.signalDisable&&(i.getSNAManager().unSubscribe(this,this.signalDisable),this.signalDisable=this.properties.signalDisable,i.getSNAManager().subscribe(this,this.signalDisable))),this.onPropertiesChange()},e.prototype.onActuateEnd=function(){return i.getSNAManager().emitSignal(this.properties.signalEnd),this.actuating=!1,this.queued>0?(this.queued--,this.start(this.signalId),null):this.properties.loop?(this.start(this.signalId),null):null},e.prototype.dispose=function(){this.disposed=!0,i.getSNAManager().unSubscribe(this,this.properties.signalId);var e=this.mesh.actuators;if(null!=e){this.stop();var t=e.indexOf(this);-1!==t&&e.splice(t,1)}this.cleanUp(),this.mesh=null},e}();e.ActuatorAbstract=o;var a=function(){function e(){this.signalId="0",this.signalEnable="",this.signalDisable=""}return e}();e.SNAproperties=a;var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.signalStart="",t.signalEnd="",t.autoStart=!1,t.loop=!1,t.toggle=!0,t.notReversed=!0,t}return __extends(t,e),t}(a);e.ActProperties=r}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={}));var org;!function(e){!function(t){!function(t){!function(t){var i=e.ssatguru.babylonjs.vishva.gui.SelectType,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.animationRange=new i,t.rate=1,t}return __extends(t,e),t}(t.ActProperties);t.AnimatorProp=s;var n=function(e){function t(t,i){var n=this;n=null!=i?e.call(this,t,i)||this:e.call(this,t,new s)||this;var o=n.properties,a=t.skeleton;if(null!=a){for(var r=a.getAnimationRanges,h=r.call(a),l=new Array(h.length),u=0,c=0;c<h.length;c++){var p=h[c];l[u]=p.name,u++}o.animationRange.values=l}else o.animationRange.values=[""];return n}return __extends(t,e),t.prototype.actuate=function(){var e=this,t=this.properties;null!=this.mesh.skeleton&&this.mesh.skeleton.beginAnimation(t.animationRange.value,!1,t.rate,function(){return e.onActuateEnd()})},t.prototype.stop=function(){},t.prototype.isReady=function(){return!0},t.prototype.getName=function(){return"Animator"},t.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},t.prototype.cleanUp=function(){this.properties.loop=!1},t}(t.ActuatorAbstract);t.ActuatorAnimator=n}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Animator",org.ssatguru.babylonjs.vishva.ActuatorAnimator);var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.Animation,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.timeToCloak=1,t}return __extends(t,e),t}(e.ActProperties);e.ActCloakerProp=i;var s=function(e){function s(t,s){var n=this;return n=null!=s?e.call(this,t,s)||this:e.call(this,t,new i)||this,n.s=1,n.e=0,n}return __extends(s,e),s.prototype.actuate=function(){var e=this,i=this.properties;i.toggle?(i.notReversed?(this.s=1,this.e=0):(this.s=0,this.e=1),i.notReversed=!i.notReversed):(this.s=1,this.e=0),this.a=t.CreateAndStartAnimation("cloaker",this.mesh,"visibility",60,60*i.timeToCloak,this.s,this.e,0,null,function(){return e.onActuateEnd()})},s.prototype.stop=function(){var e=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return e.onActuateEnd()},0))},s.prototype.isReady=function(){return!0},s.prototype.getName=function(){return"Cloaker"},s.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},s.prototype.cleanUp=function(){this.properties.loop=!1},s}(e.ActuatorAbstract);e.ActuatorCloaker=s}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Cloaker",org.ssatguru.babylonjs.vishva.ActuatorCloaker);var org;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.ActProperties);e.ActDisablerProp=t;var i=function(e){function i(i,s){return null!=s?e.call(this,i,s)||this:e.call(this,i,new t)||this}return __extends(i,e),i.prototype.actuate=function(){var e=!1;this.properties.toggle?(e=!this.properties.notReversed,this.properties.notReversed=!this.properties.notReversed):e=!1,this.mesh.setEnabled(e),this.disableChilds(this.mesh,e),this.onActuateEnd()},i.prototype.disableChilds=function(e,t){for(var i=e.getDescendants(!1),s=0,n=i;s<n.length;s++){n[s].setEnabled(t)}},i.prototype.stop=function(){this.mesh.setEnabled(!0)},i.prototype.isReady=function(){return!0},i.prototype.getName=function(){return"Disabler"},i.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},i.prototype.cleanUp=function(){this.properties.loop=!1},i}(e.ActuatorAbstract);e.ActuatorDisabler=i}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Disabler",org.ssatguru.babylonjs.vishva.ActuatorDisabler);var org;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.ActProperties);e.ActEnablerProp=t;var i=function(e){function i(i,s){return null!=s?e.call(this,i,s)||this:e.call(this,i,new t)||this}return __extends(i,e),i.prototype.actuate=function(){var e=!0;this.properties.toggle&&(e=this.properties.notReversed,this.properties.notReversed=!this.properties.notReversed),this.mesh.setEnabled(e),this.enableChilds(this.mesh,e),this.onActuateEnd()},i.prototype.enableChilds=function(e,t){for(var i=e.getDescendants(!1),s=0,n=i;s<n.length;s++){n[s].setEnabled(t)}},i.prototype.stop=function(){this.mesh.setEnabled(!0)},i.prototype.isReady=function(){return!0},i.prototype.getName=function(){return"Enabler"},i.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},i.prototype.cleanUp=function(){this.properties.loop=!1},i}(e.ActuatorAbstract);e.ActuatorEnabler=i}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Enabler",org.ssatguru.babylonjs.vishva.ActuatorEnabler);var org;!function(e){!function(t){!function(t){!function(t){var i=BABYLON.Light,s=e.ssatguru.babylonjs.vishva.gui.SelectType,n=function(e){function t(){var t=e.call(this)||this;return t.switchType=new s,t.switchType.values=["OnSwitch","OffSwitch"],t.switchType.value="OnSwitch",t}return __extends(t,e),t}(t.ActProperties);t.ActLightProp=n;var o=function(e){function t(t,i){return null!=i?e.call(this,t,i)||this:e.call(this,t,new n)||this}return __extends(t,e),t.prototype.actuate=function(){var e=this.getLights(this.mesh);if(0==e.length)return void this.onActuateEnd();var t,i=this.properties;t="OnSwitch"==i.switchType.value,this.properties.toggle&&(this.properties.notReversed||(t=!t),this.properties.notReversed=!this.properties.notReversed),this.switchLights(e,t),this.onActuateEnd()},t.prototype.switchLights=function(e,t){for(var i=0,s=e;i<s.length;i++){s[i].setEnabled(t)}},t.prototype.getLights=function(e){for(var t=e.getDescendants(!1),s=[],n=0,o=t;n<o.length;n++){var a=o[n];a instanceof i&&s.push(a)}return s},t.prototype.stop=function(){var e=this.properties;e.switchType.value,this.switchLights(this.getLights(this.mesh),!0)},t.prototype.isReady=function(){return!0},t.prototype.getName=function(){return"Light"},t.prototype.onPropertiesChange=function(){this.properties.autoStart&&this.start(this.properties.signalId)},t.prototype.cleanUp=function(){this.properties.loop=!1},t}(t.ActuatorAbstract);t.ActuatorLight=o}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Light",org.ssatguru.babylonjs.vishva.ActuatorLight);var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.Animation,i=BABYLON.Vector3,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=1,t.y=1,t.z=1,t.duration=1,t.local=!1,t}return __extends(t,e),t}(e.ActProperties);e.ActMoverParm=s;var n=function(e){function n(t,i){return null!=i?e.call(this,t,i)||this:e.call(this,t,new s)||this}return __extends(n,e),n.prototype.actuate=function(){var e,s,n=this,o=this.properties,a=this.mesh.position.clone();if(o.local){var r=this.mesh.getWorldMatrix(),h=new i(o.x*(1/this.mesh.scaling.x),o.y*(1/this.mesh.scaling.y),o.z*(1/this.mesh.scaling.z));s=i.TransformCoordinates(h,r).subtract(this.mesh.position)}else s=new i(o.x,o.y,o.z);o.toggle?(e=o.notReversed?a.add(s):a.subtract(s),o.notReversed=!o.notReversed):e=a.add(s),this.a=t.CreateAndStartAnimation("move",this.mesh,"position",60,60*o.duration,a,e,0,null,function(){return n.onActuateEnd()})},n.prototype.getName=function(){return"Mover"},n.prototype.stop=function(){var e=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return e.onActuateEnd()},0))},n.prototype.cleanUp=function(){},n.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},n.prototype.isReady=function(){return!0},n.prototype.newInstance=function(e,t){return new n(e,t)},n}(e.ActuatorAbstract);e.ActuatorMover=n}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Mover",org.ssatguru.babylonjs.vishva.ActuatorMover);var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.Animation,i=BABYLON.Axis,s=BABYLON.Quaternion,n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=0,t.y=90,t.z=0,t.duration=1,t}return __extends(t,e),t}(e.ActProperties);e.ActRotatorParm=n;var o=function(e){function o(t,i){return null!=i?e.call(this,t,i)||this:e.call(this,t,new n)||this}return __extends(o,e),o.prototype.actuate=function(){var e,n=this,o=this.properties,a=this.mesh.rotationQuaternion.clone(),r=s.RotationAxis(i.X,o.x*Math.PI/180),h=s.RotationAxis(i.Y,o.y*Math.PI/180),l=s.RotationAxis(i.Z,o.z*Math.PI/180),u=s.RotationYawPitchRoll(o.y*Math.PI/180,o.x*Math.PI/180,o.z*Math.PI/180);e=o.toggle?o.notReversed?a.multiply(u):a.multiply(s.Inverse(u)):a.multiply(r).multiply(h).multiply(l),o.notReversed=!o.notReversed;this.mesh.position.y,this.mesh.position.y;this.a=t.CreateAndStartAnimation("rotate",this.mesh,"rotationQuaternion",60,60*o.duration,a,e,0,null,function(){return n.onActuateEnd()})},o.prototype.getName=function(){return"Rotator"},o.prototype.stop=function(){var e=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return e.onActuateEnd()},0))},o.prototype.cleanUp=function(){},o.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},o.prototype.isReady=function(){return!0},o}(e.ActuatorAbstract);e.ActuatorRotator=o}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Rotator",org.ssatguru.babylonjs.vishva.ActuatorRotator);var org;!function(e){!function(t){!function(t){!function(t){var i=e.ssatguru.babylonjs.vishva.gui.SelectType,s=e.ssatguru.babylonjs.vishva.gui.Range,n=BABYLON.Sound,o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.soundFile=new i,t.attachToMesh=!1,t.volume=new s(0,1,1,.1),t}return __extends(t,e),t}(t.ActProperties);t.ActSoundProp=o;var a=function(e){function t(t,i){return null!=i?e.call(this,t,i)||this:e.call(this,t,new o)||this}return __extends(t,e),t.prototype.actuate=function(){var e=this;this.properties.toggle?(this.properties.notReversed?this.sound.play():window.setTimeout(function(){return e.onActuateEnd()},0),this.properties.notReversed=!this.properties.notReversed):this.sound.play()},t.prototype.onPropertiesChange=function(){var e=this,t=this.properties;null!=t.soundFile.value&&(null==this.sound||t.soundFile.value!==this.sound.name?(null!=this.sound&&(this.stop(),this.sound.dispose()),this.ready=!1,this.sound=new n(t.soundFile.value,"vishva/assets/sounds/"+t.soundFile.value,this.mesh.getScene(),function(t){return function(){e.updateSound(t)}}(t))):(this.stop(),this.updateSound(t)))},t.prototype.updateSound=function(e){var t=this;if(this.ready=!0,e.attachToMesh&&this.sound.attachToMesh(this.mesh),this.sound.onended=function(){return t.onActuateEnd()},this.sound.setVolume(e.volume.value),e.autoStart){this.start(this.properties.signalId)||this.queued++}},t.prototype.getName=function(){return"Sound"},t.prototype.stop=function(){var e=this;null!=this.sound&&this.sound.isPlaying&&(this.sound.stop(),window.setTimeout(function(){return e.onActuateEnd()},0))},t.prototype.cleanUp=function(){},t.prototype.isReady=function(){return this.ready},t}(t.ActuatorAbstract);t.ActuatorSound=a}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Sound",org.ssatguru.babylonjs.vishva.ActuatorSound);var org;!function(e){!function(t){!function(t){!function(t){var i=BABYLON.ActionManager,s=BABYLON.ExecuteCodeAction,n=e.ssatguru.babylonjs.vishva.gui.SelectType,o=function(e){function t(){var t=e.call(this)||this;return t.clickType=new n,t.clickType.values=["leftClick","middleClick","rightClick","doubleClick"],t.clickType.value="leftClick",t}return __extends(t,e),t}(t.SNAproperties);t.SenClickProp=o;var a=function(e){function t(t,i){var s=this;return s=null!=i?e.call(this,t,i)||this:e.call(this,t,new o)||this,s.onPropertiesChange(),s}return __extends(t,e),t.prototype.getName=function(){return"Click"},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperties=function(e){this.properties=e},t.prototype.cleanUp=function(){},t.prototype.onPropertiesChange=function(){var e=this;null==this.mesh.actionManager&&(this.mesh.actionManager=new i(this.mesh.getScene()));var t,n=this.properties;"doubleClick"==n.clickType.value?t=i.OnDoublePickTrigger:"rightClick"==n.clickType.value?t=i.OnRightPickTrigger:"leftClick"==n.clickType.value?t=i.OnLeftPickTrigger:"middleClick"==n.clickType.value&&(t=i.OnCenterPickTrigger);var o=new s(t,function(t){e.emitSignal(t)});this.mesh.actionManager.registerAction(o),this.actions.push(o)},t}(t.SensorAbstract);t.SensorClick=a}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Click",org.ssatguru.babylonjs.vishva.SensorClick);var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.ActionManager,i=BABYLON.ExecuteCodeAction,s=BABYLON.Tags,n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEnter=!1,t.onExit=!1,t}return __extends(t,e),t}(e.SNAproperties);e.SenContactProp=n;var o=function(e){function o(t,i){var s=this;return s=null!=i?e.call(this,t,i)||this:e.call(this,t,new n)||this,s.onPropertiesChange(),s}return __extends(o,e),o.prototype.getName=function(){return"Contact"},o.prototype.getProperties=function(){return this.properties},o.prototype.setProperties=function(e){this.properties=e},o.prototype.cleanUp=function(){},o.prototype.onPropertiesChange=function(){var e=this,s=this.properties,n=this.mesh.getScene();null==this.mesh.actionManager&&(this.mesh.actionManager=new t(n));var o=n.getMeshesByTags("Vishva.avatar")[0];if(s.onEnter){var a=new i({trigger:t.OnIntersectionEnterTrigger,parameter:{mesh:o,usePreciseIntersection:!1}},function(t){return e.emitSignal(t)});this.mesh.actionManager.registerAction(a),this.actions.push(a)}if(s.onExit){var a=new i({trigger:t.OnIntersectionExitTrigger,parameter:{mesh:o,usePreciseIntersection:!1}},function(t){return e.emitSignal(t)});this.mesh.actionManager.registerAction(a),this.actions.push(a)}},o.prototype.findAV=function(e){for(var t=0;t<e.meshes.length;t++){var i=e.meshes[t];if(s.HasTags(i)&&s.MatchesQuery(i,"Vishva.avatar"))return i}return null},o}(e.SensorAbstract);e.SensorContact=o}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Contact",org.ssatguru.babylonjs.vishva.SensorContact);var org;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.interval=1e3,t.plusMinus=0,t}return __extends(t,e),t}(e.SNAproperties);e.SenTimerProp=t;var i=function(e){function i(i,s){var n=this;return n=null!=s?e.call(this,i,s)||this:e.call(this,i,new t)||this,n.onPropertiesChange(),n}return __extends(i,e),i.prototype.getName=function(){return"Timer"},i.prototype.getProperties=function(){return this.properties},i.prototype.setProperties=function(e){this.properties=e},i.prototype.cleanUp=function(){window.clearTimeout(this.timerId)},i.prototype.processUpdateSpecific_old=function(){var e=this,t=this.properties;this.timerId&&window.clearInterval(this.timerId),this.timerId=window.setInterval(function(){e.emitSignal()},t.interval)},i.prototype.onPropertiesChange=function(){var e=this,t=this.properties;this.timerId&&window.clearTimeout(this.timerId),this.timerId=window.setTimeout(function(){e.signalEmitter()},t.interval)},i.prototype.signalEmitter=function(){var e=this,t=this.properties;this.emitSignal(),window.clearTimeout(this.timerId);var i=t.interval,s=t.plusMinus;if(s>0){var n=i-s;n<0&&(n=0),i=this.getRandomInt(n,i+s)}this.timerId=window.setTimeout(function(){e.signalEmitter()},i)},i.prototype.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},i}(e.SensorAbstract);e.SensorTimer=i}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Timer",org.ssatguru.babylonjs.vishva.SensorTimer);var org;!function(e){!function(e){!function(e){!function(e){var t=BABYLON.ActionManager,i=BABYLON.ExecuteCodeAction,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SNAproperties);e.SenTouchProp=s;var n=function(e){function n(n,o){var a=this;a=null!=o?e.call(this,n,o)||this:e.call(this,n,new s)||this,null==a.mesh.actionManager&&(a.mesh.actionManager=new t(a.mesh.getScene()));var r=new i(t.OnPickUpTrigger,function(e){0===e.sourceEvent.button&&a.emitSignal(e)});return a.mesh.actionManager.registerAction(r),a.actions.push(r),a}return __extends(n,e),n.prototype.getName=function(){return"Touch"},n.prototype.getProperties=function(){return this.properties},n.prototype.setProperties=function(e){this.properties=e},n.prototype.cleanUp=function(){},n.prototype.onPropertiesChange=function(){},n}(e.SensorAbstract);e.SensorTouch=n}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Touch",org.ssatguru.babylonjs.vishva.SensorTouch);